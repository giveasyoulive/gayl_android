{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/extension/lib/shared/util.js","webpack:///./src/extension/lib/config.production.js","webpack:///./src/extension/lib/web-ext/runtime.js","webpack:///./src/extension/lib/shared/messages.js","webpack:///./src/extension/lib/shared/get-browser-name.js","webpack:///./src/extension/lib/web-ext/tabs.js","webpack:///./src/extension/lib/shared/message.js","webpack:///./src/extension/lib/shared/get-mobile-os.js","webpack:///./src/extension/lib/config.common.js","webpack:///./src/extension/lib/shared/visit-url.js","webpack:///./src/extension/lib/storage.js","webpack:///./node_modules/urijs/src/URI.js","webpack:///./src/extension/lib/gayl-api-client.js","webpack:///./src/extension/lib/shared/store-status.js","webpack:///./src/extension/lib/shared/close-popup.js","webpack:///./node_modules/urijs/src/SecondLevelDomains.js","webpack:///./node_modules/urijs/src/IPv6.js","webpack:///./node_modules/urijs/src/punycode.js","webpack:///./src/extension/lib/web-ext/storage.js","webpack:///./src/extension/lib/web-ext/permissions.js","webpack:///./src/extension/lib/web-ext/index.js","webpack:///./src/extension/lib/browser-tabs.js","webpack:///./src/extension/lib/web-ext/cookies.js","webpack:///./src/extension/lib/shared/visit-clickthrough.js","webpack:///./src/extension/lib/shared/check-permissions.js","webpack:///./src/extension/lib/navigation-tracker.js","webpack:///./src/extension/lib/cache.js","webpack:///./src/extension/lib/request.js","webpack:///(webpack)/buildin/module.js","webpack:///./src/extension/lib/web-ext/windows.js","webpack:///./src/extension/lib/web-ext/web-navigation.js","webpack:///./src/extension/lib/web-ext/web-request.js","webpack:///./src/extension/lib/web-ext/browser-action.js","webpack:///./src/extension/lib/notification-listener.js","webpack:///./src/extension/lib/shared/open-tab.js","webpack:///./src/extension/lib/installation-listener.js","webpack:///./src/extension/lib/shared/set-browser-icon.js","webpack:///./src/extension/lib/extension-core.js","webpack:///./src/extension/background.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","r","value","n","__esModule","object","property","prototype","hasOwnProperty","p","s","Config","getBrowserName","getMobileOs","isArray","obj","toString","isSerp","url","patterns","length","match","isGiveasyouLive","test","dom","tagName","classNames","textContent","el","document","createElement","forEach","className","classList","add","contentScriptInitialise","contentScriptConstructor","condition","window","top","createError","type","err","Error","findParentWithClassName","currElement","element","contains","parentNode","arr","callback","getTimestamp","Date","now","getDayAndYear","getDay","getYear","getGaylUrl","path","gaylUrl","hasLeadingSlash","indexOf","getLastItem","hasProperties","props","prop","img","src","alt","insertAfter","newNode","referenceNode","insertBefore","nextSibling","isAndroidApp","isClickthrough","isGiveasyouLiveEmail","isMajorVersionUpdate","previousVersion","newVersion","previousVersionParts","split","newVersionParts","isString","isRetailerPage","isUndefined","input","undefined","logObject","out","key","markFavourites","stores","userFavourites","favouriteStoreIds","map","favourite","id","store","isFavourite","includes","removeChildren","node","hasChildNodes","firstChild","removeChild","text","createTextNode","toBoolean","str","truncateCauseName","cause","limit","len","truncatedName","substring","svgDom","createElementNS","whenDocumentReady","readyState","addEventListener","CommonConfig","assign","apiBase","apiBaseV2","env","gaylDomain","runtime","chrome","browser","POPUP_LOADING_ACCOUNT_OPTIONS","POPUP_LOADING_CAUSE_INFO","POPUP_LOADING_FAVOURITES","POPUP_LOADING_GLOBAL","POPUP_LOADING_SIMILAR_STORES","POPUP_LOADING_POPULAR_STORES","POPUP_LOADING_STORE_SEARCH","POPUP_NO_FAVOURITES","POPUP_NO_SIMILAR_STORES","POPUP_NO_SEARCH_RESULTS","ERROR_TIMEOUT_POPUP","ERROR_ACCOUNT_OPTION_LOAD","STORE_CONFIRMATION_DIALOG_QUESTION","STORE_CONFIRMATION_DIALOG_EARN_NEW_CUSTOMERS","STORE_CONFIRMATION_DIALOG_EARN","STORE_CONFIRMATION_DIALOG_YES","STORE_THANK_YOU_OK","STORE_THANK_YOU_INTRO","STORE_THANK_YOU_BODY_NEW_CUSTOMERS","STORE_THANK_YOU_BODY","SERP_BUTTON_TEXT","SERP_LINK_TEXT","API_ERROR_MESSAGES","InvalidCredentials","REQUEST_ERROR_MESSAGES","0","GENERIC_ERROR_MESSAGE","userAgentStr","ua","navigator","userAgent","tabs","customQuery","queryInfo","Promise","resolve","reject","query","customGet","tabId","lastError","MessageSubject","RETAILER_CONFIRMATION","RETAILER_THANKYOU","HIDE_CONFIRMATION","REMOVE_ALL","GET_SERP_RULES_RESPONSE","CHECK_SERP_URLS_RESPONSE","RETAILER_CONFIRM","RETAILER_REJECT","GET_SERP_RULES","CHECK_SERP_URLS","Message","subject","payload","this","isValidSubject","BROWSER_AUTH_HEADERS","Chrome","Firefox","Edge","Safari","apiAuthHeader","browserName","authHeader","extensionId","safari","ignoredSchemes","ignoredUrls","permissionsUrl","processingDelayMs","requestTimeoutMs","sentryDsn","thankYouDialogVisibleMs","uninstallUrl","version","getManifest","closePopup","options","shouldClosePopup","console","error","log","update","storageProvider","local","Storage","keys","items","getAll","getOrElse","loadingFn","self","then","data","result","setSingle","catch","set","dataToSet","remove","clear","__WEBPACK_AMD_DEFINE_FACTORY__","__WEBPACK_AMD_DEFINE_ARRAY__","__WEBPACK_AMD_DEFINE_RESULT__","root","factory","apply","punycode","IPv6","SLD","_URI","URI","base","_urlSupplied","arguments","_baseSupplied","TypeError","location","href","absoluteTo","hasOwn","escapeRegEx","string","replace","getType","String","slice","filterArrayValues","lookup","splice","arrayContains","list","_type","arraysEqual","one","two","sort","trimSlashes","escapeForDumbFirefox36","escape","strictEncodeURIComponent","encodeURIComponent","_parts","protocol","username","password","hostname","urn","port","fragment","preventInvalidHostname","duplicateQueryParameters","escapeQuerySpace","protocol_expression","idn_expression","punycode_expression","ip4_expression","ip6_expression","find_uri_expression","findUri","start","end","trim","parens","defaultPorts","http","https","ftp","gopher","ws","wss","hostProtocols","invalid_hostname_characters","domAttributes","a","blockquote","link","script","form","area","iframe","embed","source","track","audio","video","getDomAttribute","nodeName","toLowerCase","encode","decode","decodeURIComponent","iso8859","unescape","unicode","characters","pathname","expression","%24","%26","%2B","%2C","%3B","%3D","%3A","%40","/","?","#","reserved","%2F","%3F","%23","%5B","%5D","%21","%27","%28","%29","%2A","urnpath",":","encodeQuery","escaped","decodeQuery","e","_part","generateAccessor","_group","generateSegmentedPathFunction","_sep","_codingFuncName","_innerCodingFuncName","actualCodingFunc","segments","join","generateSimpleAccessor","v","build","generatePrefixAccessor","_key","charAt","decodePath","decodeUrnPath","recodePath","recodeUrnPath","encodeReserved","parse","parts","pos","parseAuthority","parseHost","bracketPos","t","firstColon","firstSlash","nextColon","ensureValidHostname","ensureValidPort","parseUserinfo","lastIndexOf","shift","parseQuery","splits","push","buildAuthority","buildHost","buildUserinfo","buildQuery","unique","buildQueryParameter","addQuery","concat","setQuery","removeQuery","hasQuery","withinArray","Boolean","joinPaths","nonEmptySegments","_segments","segment","uri","normalize","commonPath","Math","min","withinString","_start","_end","_trim","_parens","_attributeOpen","lastIndex","exec","index","ignoreHtml","attributeOpen","max","search","parensEnd","parensMatch","parensMatchEnd","ignore","hasHostname","rejectEmptyHostname","toASCII","Number","isInteger","noConflict","removeAll","unconflicted","URITemplate","SecondLevelDomains","deferBuild","_deferred_build","_string","clone","valueOf","hash","res","_object","is","what","ip","ip4","ip6","sld","idn","relative","has","_protocol","_port","_hostname","scheme","x","origin","authority","host","userinfo","resource","subdomain","domain","sub","RegExp","tld","ReferenceError","directory","filename","decodePathSegment","mutatedDirectory","normalizePath","suffix","separator","absolute","pop","unshift","segmentCoded","q","setSearch","addSearch","removeSearch","hasSearch","normalizeProtocol","normalizeQuery","normalizeFragment","normalizeHostname","normalizePort","best","_was_relative","_path","_parent","_pos","_leadingParents","normalizePathname","normalizeSearch","normalizeHash","readable","toUnicode","qp","kv","basedir","resolved","properties","relativeTo","relativeParts","baseParts","common","relativePath","basePath","parents","equals","one_map","two_map","one_query","two_query","checked","Request","util","Cache","DEFAULT_OPTIONS","headers","Authorization","findStoreByUrlCache","findStoreByUrlAnonymousCache","findSimilarStoresCache","urlBlacklistCache","adsCache","serpRulesCache","userStateCache","GaylApiClient","login","email","endpoint","post","cookieLogin","deviceSecurityCode","cookieLogout","getState","cachedResponse","useCache","resp","getSerpRules","rules","listUserStores","listPopularStores","popularStores","listAccountOptions","filtered","accountOptions","option","listFavouriteStores","addFavouriteStore","storeId","removeFavouriteStore","findStoreByQuery","findStoreByUrl","urls","lastUrl","warn","searchType","findStoreByUrlAnonymous","findSimilarStores","getUrlBlacklist","getAds","ads","checkSerpUrls","getReferAFriendMetaData","TRACKING","TRACKED","BLANK","NOT_SUPPORTED","extension","popovers","hide","close","_SecondLevelDomains","ac","ae","af","al","ao","ar","at","au","ba","bb","bh","bn","bo","br","bs","bz","ca","ck","cn","co","cr","cy","do","dz","ec","eg","er","es","et","fj","fk","fr","gg","gh","gn","gr","gt","gu","hk","hu","il","in","iq","ir","it","je","jo","jp","ke","kh","ki","km","kn","kr","kw","ky","kz","lb","lk","lr","lv","ly","ma","mc","me","mg","mk","ml","mn","mo","mt","mv","mw","mx","my","nf","ng","ni","np","nr","om","pe","ph","pk","pl","pr","ps","pw","ro","rs","sb","sc","sh","sl","st","sv","sz","tr","tt","tw","mu","mz","na","nz","pa","pt","py","qa","re","ru","rw","sa","sd","se","sg","sn","sy","th","tj","tn","tz","ug","uk","us","uy","ve","vi","vn","ye","yu","za","zm","com","net","org","de","tldOffset","sldOffset","sldList","_IPv6","address","total","j","_best","_current","current","inzeroes","nodeType","freeGlobal","global","maxInt","tMin","tMax","skew","damp","initialBias","initialN","delimiter","regexPunycode","regexNonASCII","regexSeparators","errors","overflow","not-basic","invalid-input","baseMinusTMin","floor","stringFromCharCode","fromCharCode","RangeError","array","fn","mapDomain","ucs2decode","extra","output","counter","charCodeAt","ucs2encode","basicToDigit","codePoint","digitToBasic","digit","flag","adapt","delta","numPoints","firstTime","k","basic","oldi","w","baseMinusT","inputLength","bias","handledCPCount","basicLength","currentValue","handledCPCountPlusOne","qMinusT","ucs2","storage","permissions","permissionsToCheck","browserAction","cookies","webRequest","webNavigation","windows","NavigationTracker","StoreStatus","BrowserTabs","activeTab","Map","discoverAllTabs","addTabs","bind","BrowserTab","currentStore","activeStore","status","navigation","pendingProcess","tab","windowId","active","setActiveTab","find","ids","delete","hasActiveTab","isActiveTab","findByStoreId","currentTabId","findAllByStoreId","found","updateTabsWithMatchingStore","currentTab","executeOnce","clearTimeout","setTimeout","from","browserTab","isSameTab","isCurrentStore","currentStatus","hasStore","copy","srcTab","targetTab","visitUrl","origins","hasPermission","oldUrls","last","first","currentUrls","urlOnly","trackerItem","isEmpty","wasDirectClick","firstWasClickthrough","firstWasEmail","wasClickthrough","idx","item","DEFAULT_CACHE_TIMEOUT","expiryTimeMs","entries","entry","_added","Messages","STATUS_OK","fetch","req","XMLHttpRequest","onreadystatechange","requestStart","DONE","dataType","responseText","JSON","handleStatusOk","statusCode","message","errorMessage","error_code","tryParseErrorMessageFromResponse","handleStatusNotOk","handleRequest","open","timeout","header","setRequestHeader","addHeaders","send","stringify","webpackPolyfill","deprecate","paths","children","onFocusChanged","addListener","config","[object Object]","connectNative","onMessage","response","token","expirationDate","application","activeBrowserWindow","openTab","create","onInstalled","onExtensionInstalled","details","reason","onExtensionInstalledFirstTime","onExtensionUpdated","welcomeUrl","installedVersion","updateUrl","ICON_IMAGE_PATH","ICON_IMAGE_SIZES","prefix","size","getURL","setIcon","relativeIconPath","Api","checkPermissions","setBrowserIcon","visitClickthrough","user","api","bindEventHandlers","setUninstallUrl","onClickSafariExtensionIcon","onBeforeRequest","types","onBeforeRedirect","onCreated","onTabCreated","onRemoved","onTabRemoved","onActivated","onTabActivated","onWindowFocusChanged","onUpdated","onTabUpdated","onCommitted","onNavigationCommitted","changeInfo","tabInfo","frameId","addedTabId","removedTabId","command","target","popover","contentWindow","reload","showPopover","requestDetails","parentFrameId","shouldIgnoreRequestSafari","startsWith","removeInfo","updateIcon","currentWindow","isBlacklisted","isGoogleChromeNewTab","isIgnoredScheme","isCurrentFrame","request","shouldProcessUrl","oldUrl","newUrl","getAndUpdateUserState","checkRetailerSupported","findStoreByUrlResponse","handleRetailerResponse","onError","loggedIn","persistState","clearUserState","getStateResponse","errorFn","api_error","http_error_timeout_or_cancelled","tab_deleted","no_navigated_urls","currentTabUrl","folder","navigatedUrls","isLoggedIn","handleRetailerNotSupported","extractStore","existingTabWithStore","standDown","allowToolbar","handleStatusTracking","handleStatusBlank","handleUnknownStatus","showThankYou","showThankYouForTabs","showConfirmationDialog","sendMessageToContentScript","hideConfirmationDialog","sendMessage","sender","sendResponse","isTrusted","onConfirmation","extensionSource","onRejection","deepLink","hideConfirmationDialogForTabs","setUninstallURL","ExtensionCore","InstallationListener","NotificationListener","gaylExtension"],"mappings":"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","file":"background.bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 49);\n","/**\n * \tUtility functions for various parts of the extension.\n *\n * \t@author Daniel Moffat\n */\n\nvar Config = require('../config.development.js');\nvar getBrowserName = require('./get-browser-name.js');\nvar getMobileOs = require('./get-mobile-os.js');\n\n/**\n * @return true if the given object has all of the properties specified in the props array.\n */\nfunction hasProperties(object, props) {\n\tif(!props || !props.length) {\n\t\treturn true;\n\t}\n\tprops.forEach(function(prop) {\n\t\tif(!object.hasOwnProperty(prop)) {\n\t\t\treturn false;\n\t\t}\n\t});\n\treturn true;\n}\n\n/**\n * @return True if the given string equals \"true\"\n */\nfunction toBoolean(str) {\n\treturn str === 'true'\n}\n\n/**\n * @return True if the given input is undefined. (Declared, but not defined.)\n */\nfunction isUndefined(input) {\n\treturn input === undefined;\n}\n\n/**\n * @return True if the given 'obj' is an array.\n */\nfunction isArray(obj) {\n\treturn Object.prototype.toString.call(obj) === '[object Array]';\n}\n\n/**\n * @return True if the given 'obj' is a string.\n */\nfunction isString(obj) {\n\treturn Object.prototype.toString.call(obj) === '[object String]';\n}\n\n/**\n *\tHelper method for iterating NodeList objects (or other objects that pretend to be arrays).\n *\tIn Chrome NodeList.prototype.forEach exists, but not in other browsers.\n *\n * \tInvokes 'callback' for each item in 'arr'.\n *\n */\nfunction forEach(arr, callback) {\n\tfor (var i = 0; i < arr.length; i++) {\n\t\tcallback(arr[i]);\n\t}\n}\n\n/**\n *  @return The first parent node which has the given 'className', or null if no parent is found.\n */\nfunction findParentWithClassName(currElement, className) {\n\tvar element = currElement;\n\twhile(!element.classList.contains(className)) {\n\t\telement = element.parentNode;\n\t\tif(element === null) { // No parent node, can't go any further.\n\t\t\treturn null;\n\t\t}\n\t}\n\treturn element;\n}\n\n/**\n * \tGiven a list of stores, will set the 'isFavourite' property on each store if they are also in\n * \t'userFavourites' (which is also a list of stores.).\n */\nfunction markFavourites(stores, userFavourites) {\n\tvar stores = stores || [];\n\tvar userFavourites = userFavourites || [];\n\tvar favouriteStoreIds = userFavourites.map(function(favourite) { return favourite.id } );\n\tstores.forEach(function(store) {\n\t\tstore.isFavourite = favouriteStoreIds.includes(store.id);\n\t});\n\treturn stores;\n}\n\n/**\n *\tWill invoke 'callback' when the document is ready.\n *\n * \tThis might be invoked when the document is still in a 'loading' state, so we need to check the ready state\n *  and either bind the callback to the 'DOMContentLoaded' event or just execute it straight away.\n */\nfunction whenDocumentReady(callback) {\n\tif(document.readyState === 'loading') { // Document not loaded yet.\n\t\tdocument.addEventListener('DOMContentLoaded', function() {\n\t\t\tcallback();\n\t\t});\n\t\treturn;\n\t}\n\n\t// Document already interactive\n\tcallback();\n}\n\n/**\n * @return An error object, with the given type as the 'type' property.\n */\nfunction createError(type) {\n\tvar err = new Error();\n\terr.type = type;\n\treturn err;\n}\n\n/**\n * @return True if the given 'url' matches that of a SERP (e.g. Google, Bing, Yahoo etc.)\n */\nfunction isSerp(url) {\n\tif(!url) return false;\n\n\tvar patterns = [\n\t\t/^(http|https):\\/\\/www.google.(co.uk|com)/g,\n\t\t/^(http|https):\\/\\/www.bing.com\\/search/g,\n\t\t/^(http|https):\\/\\/uk.search.yahoo.com\\/search/g\n\t];\n\n\tfor (var i = 0; i < patterns.length; i++) {\n\t\tif(url.match(patterns[i])) {\n\t\t\treturn true;\n\t\t}\n\t}\n\n\treturn false;\n}\n\n/**\n * @return True if the given url is a clickthrough URL\n */\nfunction isClickthrough(url) {\n\tif(!url) return false;\n\treturn url.indexOf('statistics/gayl/clickthrough') > 0;\n}\n\n/**\n * @return True if the given url is the GAYL website.\n */\nfunction isGiveasyouLive(url) {\n\tvar re = /https?:\\/\\/(.*)giveasyoulive.(com|uk)/g;\n\treturn re.test(url);\n}\n\n/**\n * @return True if the given url is a GAYL email URL.\n */\nfunction isGiveasyouLiveEmail(url) {\n\tif(!url) return false;\n\treturn url.indexOf('giveasyoulive-emails.com') > 0;\n}\n\n/**\n * @return True if the given URL is a retailer page, which is assumed\n * if !isGiveasyouLive and !isSerp, we don't have a more reliable (and quick)\n * method to test if a URL is a retailers.\n */\nfunction isRetailerPage(url) {\n\treturn !isGiveasyouLive(url) && !isSerp(url);\n}\n\n/**\n *\tIntialises a content script.\n *\n *  If the browser is Safari, the content script will only be initialised if condition is true.\n *  For all other browsers, the content script will be intialised straight away.\n *\n *  'condition' is needed because Safari doesn't support the whitelist/blocklist in their manifest file yet.\n */\nfunction contentScriptInitialise(contentScriptConstructor, condition) {\n\tif(window.top === window) {\n\t\tif(getBrowserName() === \"Safari\") {\n\t\t\tif(condition) {\n\t\t\t\tnew contentScriptConstructor();\n\t\t\t}\n\t\t} else {\n\t\t\tnew contentScriptConstructor();\n\t\t}\n\t}\n}\n\n/**\n * Helper function for creating DOM nodes in a non-verbose way.\n * @param  tagName, the name of the tag to create\n * @param  classNames, a single class name, or an array of class names to add to the node\n * @param  textContent The text content of the node.\n *\n * e.g.\n * dom('div', ['foo', 'bar'], 'Hello world!')\n * => <div class=\"foo bar\">Hello world!</div>\n */\nfunction dom(tagName, classNames, textContent) {\n\tvar el = document.createElement(tagName);\n\tif(isArray(classNames)) {\n\t\tclassNames.forEach(function(className) {\n\t\t\tif(className) {\n\t\t\t\tel.classList.add(className);\n\t\t\t}\n\t\t});\n\t} else {\n\t\tif(classNames) {\n\t\t\tel.classList.add(classNames);\n\t\t}\n\t}\n\n\tif(textContent) {\n\t\tel.textContent = textContent;\n\t}\n\n\treturn el;\n}\n\n/**\n * Helper function for creating <svg> elements (and their children, e.g. <path>, <circle>...).\n * You cannot just use dom for this. The resulting elements don't get rendered by the browser.\n */\nfunction svgDom(tagName, classNames) {\n\tvar el = document.createElementNS('http://www.w3.org/2000/svg', tagName);\n\tif(!classNames) return el;\n\n\tif(isArray(classNames)) {\n\t\tclassNames.forEach(function(className) {\n\t\t\tif(className) {\n\t\t\t\tel.classList.add(className);\n\t\t\t}\n\t\t})\n\t} else {\n\t\tel.classList.add(className);\n\t}\n\treturn el;\n}\n\n/**\n * Helper function for creating <img> elements\n * @param  src The image source\n * @param  alt The alt text\n */\nfunction img(src, alt, classNames) {\n\tvar i = dom('img', classNames);\n\ti.src = src;\n\ti.alt = alt;\n\treturn i;\n}\n\nfunction removeChildren(node) {\n\t// Make sure we have a valid node reference and it has children\n\tif(!node || !node.hasChildNodes()) {\n\t\treturn;\n\t}\n\n\twhile(node.firstChild) {\n\t\tnode.removeChild(node.firstChild);\n\t}\n}\n\n/**\n * Helper function for creating text nodes.\n */\nfunction text(text) {\n\treturn document.createTextNode(text);\n}\n\n/**\n * @return True if the new version is a major version upgrade from the previous version. A major\n * version upgrade is when any of the first two version numbers are greater than the previous version\n *\n * e.g:\n * isMajorVersionUpdate(\"6.0.0.0\", \"7.0.0.0\")\n * => true\n *\n * isMajorVersionUpdate(\"6.0.0.0\", \"6.1.0.0\")\n * => true\n *\n * isMajorVersionUpdate(\"6.0.0.0\", \"6.0.1.0\")\n * => false\n */\nfunction isMajorVersionUpdate(previousVersion, newVersion) {\n\tif(!newVersion) { return false; }\n\tif(!previousVersion && newVersion) { return true; }\n\tvar previousVersionParts = previousVersion.split(\".\");\n\tvar newVersionParts = newVersion.split(\".\");\n\n\tfor(var i = 0; i < previousVersionParts.length; i++) {\n\t\tif(newVersionParts[i] > previousVersionParts[i]) {\n\t\t\treturn true;\n\t\t}\n\n\t\t// Only check the first two numbers, the last two are minor versions\n\t\tif(i === 1) {\n\t\t\treturn false;\n\t\t}\n\t}\n}\n\n/**\n * @return UNIX timestamp for the current date.\n */\nfunction getTimestamp() {\n\treturn Date.now();\n}\n\n/**\n * @return The current day and year joined with a '-', e.g. For 1st Jan 2018, you'd get '1-2018'\n */\nfunction getDayAndYear() {\n\tvar d = new Date();\n\n\treturn (d.getDay() + 1) + '-' + (d.getYear() + 1900);\n}\n\n/**\n * Given an object, will return its string representation. Doesn't work very well if the value is an object / array.\n * e.g. logObject({foo: 'bar', baz: 'boo'})\n * => 'foo:bar,baz:boo'\n */\nfunction logObject(obj) {\n\tif(!obj) return '';\n\tvar out = '';\n\n\tfor(var key in obj) {\n\t\tif(obj.hasOwnProperty(key)) {\n\t\t\tout += (key + ':' + obj[key] + ',')\n\t\t}\n\t}\n\n\treturn out;\n}\n\n/**\n * Given an array, will return last item\n * @return The last item, or null if the given array is not an actual array or doesn't\n * contain any items.\n */\nfunction getLastItem(arr) {\n\tif(!isArray(arr)) {\n\t\treturn null;\n\t}\n\n\tif(arr.length == 0) {\n\t\treturn null;\n\t}\n\n\treturn arr[arr.length - 1];\n}\n\n/**\n * @param path Path to the resource on the GAYL website. A leading slash will be added if not already present.\n * @return The absolute URL to the path\n * e.g.\tgetGaylUrl('/foo/bar')\n * => 'https://www.giveasyoulive.com/foo/bar' for prod\n * => 'https://www.giveasyoulive.uk/foo/bar' for test\n */\nfunction getGaylUrl(path) {\n\tif(!path) return Config.gaylUrl;\n\tvar hasLeadingSlash = path.indexOf('/') === 0;\n\n\treturn Config.gaylUrl + (hasLeadingSlash ? '' : '/') + path;\n}\n\n/**\n * Inserts the given newNode after the given referenceNode\n */\nfunction insertAfter(newNode, referenceNode) {\n    referenceNode.parentNode.insertBefore(newNode, referenceNode.nextSibling);\n}\n\n// Given a cause object, will add a \"truncatedName\" property\nfunction truncateCauseName(cause, limit) {\n\tvar len = cause.name.length;\n\tvar suffix = '...';\n\n\tif(len < limit) {\n\t\tcause.truncatedName = cause.name;\n\t} else {\n\t\tcause.truncatedName = cause.name.substring(0, limit - suffix.length) + suffix;\n\t}\n\n\treturn cause;\n}\n\nfunction isAndroidApp() {\n\treturn getBrowserName() === 'Firefox' && getMobileOs() === 'Android';\n}\n\nmodule.exports = {\n\tcontentScriptInitialise,\n\tcreateError,\n\tdom,\n\tfindParentWithClassName,\n\tforEach,\n\tgetTimestamp,\n\tgetDayAndYear,\n\tgetGaylUrl,\n\tgetLastItem,\n\thasProperties,\n\timg,\n\tinsertAfter,\n\tisAndroidApp,\n\tisArray,\n\tisClickthrough,\n\tisGiveasyouLive,\n\tisGiveasyouLiveEmail,\n\tisMajorVersionUpdate,\n\tisSerp,\n\tisString,\n\tisRetailerPage,\n\tisUndefined,\n\tlogObject,\n\tmarkFavourites,\n\tremoveChildren,\n\ttext,\n\ttoBoolean,\n\ttruncateCauseName,\n\tsvgDom,\n\twhenDocumentReady\n};","/**\n * \tProduction configuration\n *\n * \t@author Daniel Moffat\n */\n\nconst CommonConfig = require('./config.common.js');\nconst GAYL_DOMAIN = \"giveasyoulive.com\";\n\nmodule.exports = Object.assign({ ...CommonConfig }, {\n\tapiBase: `https://www.${GAYL_DOMAIN}/api/v1/`,\n\tapiBaseV2: `https://www.${GAYL_DOMAIN}/api/v2/`,\n\tenv: 'production',\n\tgaylDomain: GAYL_DOMAIN,\n\tgaylUrl: `https://www.${GAYL_DOMAIN}`,\n});","/**\n *\tWebExtensions runtime API polyfill.\n *\n * \t@author Daniel Moffat\n */\nvar runtime;\n\n// Firefox / Chrome\nif('undefined' !== typeof chrome && chrome.runtime) {\n\truntime = chrome.runtime;\n}\n\n// Microsoft Edge\nif('undefined' !== typeof browser && browser.runtime) {\n\truntime = browser.runtime;\n}\n\nmodule.exports = runtime;","/**\n * \tExtension messages.\n *\n * \tThese are generally added to the DOM using element.textContent = message, so you can't use\n * \tHTML in them - if you need to use HTML, code will need to written for the template the text is used in.\n *\n * \tSome of them also have placeholders available, e.g. $$causeName$$\n *\n *  @author Daniel Moffat\n */\n\nmodule.exports = {\n\t/**\n\t * General popup messages\n\t */\n\tPOPUP_LOADING_ACCOUNT_OPTIONS: 'Loading account...',\n\tPOPUP_LOADING_CAUSE_INFO: 'Loading cause...',\n\tPOPUP_LOADING_FAVOURITES: 'Loading favourites...',\n\tPOPUP_LOADING_GLOBAL: 'Loading...please wait.',\n\tPOPUP_LOADING_SIMILAR_STORES: 'Loading similar stores...',\n\tPOPUP_LOADING_POPULAR_STORES: 'Loading popular stores...',\n\tPOPUP_LOADING_STORE_SEARCH: 'Searching...',\n\tPOPUP_NO_FAVOURITES: 'No favourite stores yet. Why not try adding some?',\n\tPOPUP_NO_SIMILAR_STORES: 'No similar stores were found for this retailer.',\n\t// $$query$$ will be replaced with the users search query and wrapped in a <strong> tag.\n\tPOPUP_NO_SEARCH_RESULTS: 'No results found for $$query$$.',\n\n\t/**\n\t * Popup error messages\n\t */\n\n\tERROR_TIMEOUT_POPUP: 'An error occured, please close, and re-open this popup. If the problem persists, please let us know @ help@everyclick.com',\n\tERROR_ACCOUNT_OPTION_LOAD: 'Failed to load, please re-open to try again.',\n\n\t/**\n\t * Retailer page (aka retailer content script) messages\n\t */\n\t// $$causeName$$ will be replaced with the users current cause name\n\tSTORE_CONFIRMATION_DIALOG_QUESTION: 'Would you like your purchase to raise a donation for $$causeName$$?',\n\tSTORE_CONFIRMATION_DIALOG_EARN_NEW_CUSTOMERS: 'Earn up to $$maxStoreRate$$ with $$storeName$$ if you\\'re a new customer',\n\tSTORE_CONFIRMATION_DIALOG_EARN: 'Earn up to $$maxStoreRate$$ with $$storeName$$',\n\tSTORE_CONFIRMATION_DIALOG_YES: 'Raise a donation',\n\tSTORE_THANK_YOU_OK: 'OK, got it',\n\tSTORE_THANK_YOU_INTRO: 'Thank you.',\n\n\t// Thank you message for retailers which only pay commission for new customers only\n\tSTORE_THANK_YOU_BODY_NEW_CUSTOMERS: 'If you\\'re a new customer, purchases can raise up to $$maxStoreRate$$ of your total purchase for $$causeName$$.',\n\n\t// Thank you message for the other retailers\n\tSTORE_THANK_YOU_BODY: 'Purchases can raise up to $$maxStoreRate$$ of your total purchase for $$causeName$$.',\n\n\t/**\n\t * SERP messages\n\t */\n\tSERP_BUTTON_TEXT: 'Shop & raise up to $$maxStoreRate$$ >',\n\tSERP_LINK_TEXT: 'Donates up to $$maxStoreRate$$',\n\n\t/**\n\t * Custom API error messages\n\t */\n\tAPI_ERROR_MESSAGES: {\n\t\t'InvalidCredentials': 'Invalid email or password.'\n\t},\n\n\t/**\n\t * XmlHttpRequest status code error messages.\n\t */\n\n\tREQUEST_ERROR_MESSAGES: {\n\t\t// This happens when:\n\t\t// - User has dodgy / slow internet connection\n\t\t// - Our API took way too long to respond\n\t\t0: 'The request timed out, please try again.'\n\n\t},\n\n\t/**\n\t * Everything else\n\t */\n\n\t// Generic error message that's used when a more appropriate message isn't available. This should only ever be seen\n\t// for errors which haven't been catered for / expected - which explains why it's so unhelpful.\n\tGENERIC_ERROR_MESSAGE: 'An error occurred.'\n};","/**\n * \tDetects which browser the extension is currently running in.\n *\n * \tCode is pretty much directly lifted from the 'bowser' lib: https://github.com/lancedikson/bowser/blob/master/src/bowser.js\n *\n * \t@author Daniel Moffat\n */\n\nfunction getBrowserName(userAgentStr) {\n\tvar ua = userAgentStr || navigator.userAgent;\n\n\tif(/edg([ea]|ios)/i.test(ua)) {\n\t\treturn 'Edge';\n\t} else if(/chrome|crios|crmo/i.test(ua)) {\n\t\treturn 'Chrome';\n\t} else if(/safari|applewebkit/i.test(ua)) {\n\t\treturn 'Safari';\n\t} else if(/firefox|iceweasel|fxios/i.test(ua)) {\n\t\treturn 'Firefox';\n\t} else {\n\t\t// No match\n\t\treturn null;\n\t}\n}\n\nmodule.exports = getBrowserName;","/**\n * \tWebExtensions tabs API polyfill.\n *\n * \t@author Daniel Moffat\n */\n\nvar runtime = require('./runtime.js');\n\nvar tabs;\n\n// Firefox / Chrome\nif('undefined' !== typeof chrome && chrome.tabs) {\n\ttabs = chrome.tabs;\n}\n\n// Microsoft Edge\nif('undefined' !== typeof browser && browser.tabs) {\n\ttabs = browser.tabs;\n}\n\n/**\n *  Implementation of the tabs.get/tabs.query APIs is different between browsers, some take a callback and others return promises.\n *  This normalises those implementations so they work consistently. We use a different property name for these altered methods\n *  as certain browsers (Microsoft Edge) do not allow you to modify the properties.\n */\n\ntabs.customQuery = function customQuery(queryInfo) {\n\treturn new Promise(function(resolve, reject) {\n\t\ttabs.query(queryInfo, function(tabs) {\n\t\t\tresolve(tabs);\n\t\t});\n\t});\n};\n\ntabs.customGet = function customGet(tabId) {\n\treturn new Promise(function(resolve, reject) {\n\t\ttabs.get(tabId, function() {\n\t\t\tif(runtime.lastError) {\n\t\t\t\treject();\n\t\t\t} else {\n\t\t\t\tresolve(tabId);\n\t\t\t}\n\t\t});\n\t});\n}\n\nmodule.exports = tabs;","/**\n * \tModel for messages that are sent between extension components (i.e. background page, content scripts, etc).\n *\n * \t@author Daniel Moffat\n */\n\n/**\n * Defines the various message subjects and what they mean.\n */\nvar MessageSubject = {\n\t/**\n\t * Background page => Content script\n\t */\n\n\t// Inject the confirmation UI into the retailer page\n\tRETAILER_CONFIRMATION: 'RETAILER_CONFIRMATION',\n\n\t// Inject the thank you UI into the retailer page\n\tRETAILER_THANKYOU: 'RETAILER_THANKYOU',\n\n\t// Hide the confirmation UI\n\tHIDE_CONFIRMATION: 'HIDE_CONFIRMATION',\n\n\t// Remove all injected dialogs from the page\n\tREMOVE_ALL: 'REMOVE_ALL',\n\n\t// Contains the SERP rules\n\tGET_SERP_RULES_RESPONSE: 'GET_SERP_RULES_RESPONSE',\n\n\t// Contains the extracted SERP URLs and whether they are supported on our site or not.\n\tCHECK_SERP_URLS_RESPONSE: 'CHECK_SERP_URLS_RESPONSE',\n\n\t/**\n\t *\tContent script => Background page\n\t */\n\n\t// User wants to activate this retailer\n\tRETAILER_CONFIRM: 'RETAILER_CONFIRM',\n\n\t// User doesn't want to activate this retailer\n\tRETAILER_REJECT: 'RETAILER_REJECT',\n\n\t// Request SERP rules\n\tGET_SERP_RULES: 'GET_SERP_RULES',\n\n\t// Check extracted SERP URLs\n\tCHECK_SERP_URLS: 'CHECK_SERP_URLS'\n};\n\nfunction Message(subject, payload) {\n\tvar payload = payload || {};\n\t// Only allows certain messages that we're certain can be handled.\n\tif(this.isValidSubject(subject)) {\n\t\t// Tells the other end what this message is for.\n\t\tthis.subject = subject;\n\t}\n\n\t// Some data sent with this message\n\tthis.payload = payload;\n}\n\nMessage.prototype.isValidSubject = function(subject) {\n\tif(!MessageSubject[subject]) {\n\t\tthrow new Error(\"Unknown message subject: \" + subject);\n\t}\n\treturn true;\n}\n\nmodule.exports = {\n\tMessage,\n\tMessageSubject\n};","/**\n * \tDetects which mobile operating system is used\n *\n * \t@author Gareth Evans\n */\n\nfunction getMobileOS(userAgentStr) {\n\tvar ua = userAgentStr || navigator.userAgent;\n\n    if(/windows phone/i.test(ua)) {\n\t\treturn 'Windows';\n\t} else if(/android/i.test(ua)) {\n\t\treturn 'Android';\n\t} else if(/iPad|iPhone|iPod/i.test(ua)) {\n\t\treturn 'iOS';\n\t} else {\n\t\t// No match\n\t\treturn null;\n\t}\n}\n\nmodule.exports = getMobileOS;","/**\n * \tCommon extension configuration, shared between both production / development builds.\n *\n * \t@author Daniel Moffat.\n */\n\nvar getBrowserName = require('./shared/get-browser-name.js');\nvar runtime = require('./web-ext/runtime.js');\n\n // Map of browser name => auth header\n var BROWSER_AUTH_HEADERS = {\n \t'Chrome': 'R0FZTF9CUk9XU0VSX0VYVF9DSFJPTUU6MnZMTG4qSkpyX3ZEOT1hKg==',\n \t'Firefox': 'R0FZTF9CUk9XU0VSX0VYVF9GSVJFRk9YOnRBM3lOWEJQWmR1YyVHTG0=',\n \t'Edge': 'R0FZTF9CUk9XU0VSX0VYVF9FREdFOmZ2Qmg4VHdMUDRHelNTQFI=',\n \t'Safari': 'R0FZTF9CUk9XU0VSX0VYVF9TQUZBUkk6LTZyRHZBJGREeHFHOW45Pw==',\n };\n\nmodule.exports = {\n\t// Auth header used for API calls\n\tapiAuthHeader: function() {\n\t\tvar browserName = getBrowserName();\n\t\tvar authHeader = BROWSER_AUTH_HEADERS[browserName];\n\t\tif(!authHeader) {\n\t\t\tthrow new Error('Cannot find auth header for ' + browserName);\n\t\t}\n\t\treturn 'Basic ' + authHeader;\n\t},\n\textensionId: function(){\n\t\t// Edge actually has this property on their window object, so we need\n\t\t// to check if 'runtime' property exists to see if it's actually Chrome...\n\t\tif(typeof chrome !== 'undefined' && chrome.runtime) {\n\t\t\treturn chrome.runtime.id;\n\t\t}\n\n\t\t// Safari doesn't have it's own extension ID, so we have to create a fake one.\n\t\tif(typeof safari !== 'undefined') {\n\t\t\treturn 'synthetic';\n\t\t}\n\n\t\treturn browser.runtime.id\n\t},\n\n\t// Schemes that shouldn't be processed by the extension\n\tignoredSchemes: [\n\t\t'about',\n\t\t'chrome',\n\t\t'chrome-extension',\n\t\t'file',\n\t\t'view-source',\n\t\t'wyciwyg',\n\t\t'favorites'\n\t],\n\n\t// URLs that shouldn't be processed by the extension\n\tignoredUrls: '(?:shareasale.com|paypal.(?:co.uk|com)|successfultogether.co.uk|tradedoubler.com|clkuk.pvnsolutions.com|paidonresults.net|linksynergy.com|doubleclick.net|affiliatefuture.com|omguk.com|healthtrader.com|digitalriver.com|veinteractive.com|track.webgains.com|jdoqocy.com)',\n\n\t// Where the instructions live for changing your browser extension permissions.\n\tpermissionsUrl: 'https://help.giveasyoulive.com/hc/en-us/articles/360017448352-New-Chrome-update-Donation-Reminder',\n\n\t// How long to wait (ms) before processing the navigation committed event.\n\tprocessingDelayMs: 1000,\n\n\t// How long to wait (ms) before cancelling pending HTTP requests\n\trequestTimeoutMs: 7000,\n\n\t// Sentry DSN (Data Source Name) - https://docs.sentry.io/quickstart/#configure-the-dsn\n\tsentryDsn: 'https://7a19d517524a4954bb10e4bc21e4a4a9@sentry.io/1270266',\n\n\t// How long to show the thank you dialog (ms) before hiding.\n\tthankYouDialogVisibleMs: 7000,\n\n\t// The webpage a user is sent to after uninstalling\n\tuninstallUrl: 'https://r1.dotmailer-surveys.com/7e21zb6c-623a1ufe',\n\n\t// Function that returns the currently installed version of the Donation Reminder.\n\tversion: function() {\n\t\treturn runtime.getManifest().version;\n\t}\n};","/**\n * \tProvides a cross-browser way to visit a URL from the Donation reminder popup window.\n *\n * \t@author Daniel Moffat\n */\n\nvar tabs = require('../web-ext/tabs.js');\nvar closePopup = require('./close-popup.js');\n\n/**\n * \tOptions looks like this:\n * \t{\n * \t\t// Whether to close the popup window after visiting the URL\n\t\t\"closePopup\": false,\n\t\t// The tab ID to visit the URL in\n\t\t\"tabId\": 1234,\n\t\t// The URL to visit\n\t\t\"url\": \"http://www.google.com\"\n \t}\n */\nfunction visitUrl(options) {\n\tvar shouldClosePopup = options.closePopup || false;\n\tvar tabId = options.tabId || null;\n\tvar url = options.url || null;\n\n\tif(!url || !tabId) {\n\t\tconsole.error('No URL or tabId found.');\n\t}\n\n\tconsole.log('visitUrl(' + tabId + ', ' + url + ')');\n\ttabs.update(tabId, {\n\t\turl: url\n\t});\n\n\tif(shouldClosePopup) {\n\t\tclosePopup();\n\t}\n}\n\nmodule.exports = visitUrl;","/**\n * This is responsible for storing persistent data. It's basically just a wrapper\n * around the underlying WebExtensions 'storage' API that uses promises\n *\n * Uses promises rather than callbacks to make client code easier to follow.\n *\n * Currently used keys:\n * - deviceSecurityCode, token that tells the back end this user has logged in already\n * - cause, information about the currently logged in user's cause.\n * - user, information about the currently logged in user.\n * - popularStores, contains a list of popular stores\n * - accountOptions, contains a list of available account options\n * - favouriteStores, contains a list of favourite stores for the currently logged in user\n *\n * todo: Need to see what happens when the quota for storage has been hit - we're not storing huge amounts of information\n * currently (the data is a fixed size and there is a certain count of them) but could be a problem if we start collecting more stuff.\n *\n * @author Daniel Moffat\n */\n\n// The underlying storage mechanism, this differs based on the browser.\nvar storageProvider = require('./web-ext/storage.js').local;\n\n// When errors occur, they are set here\nvar lastError = require('./web-ext/runtime.js').lastError;\n\nvar Storage = {\n\t/**\n\t * \tRetrieve a single key / multiple keys from the storage.\n\t *  @param keys The keys (array) or key (string) to get.\n\t *  @return A map of key => data.\n\t */\n\tget: function(keys) {\n\t\treturn new Promise(function(resolve, reject) {\n\t\t\tstorageProvider.get(keys, function(items) {\n\t\t\t\tif(lastError || !items) {\n\t\t\t\t\treject(lastError);\n\t\t\t\t} else {\n\t\t\t\t\tresolve(items)\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t},\n\n\t/**\n\t * \tGets every key from the storage.\n\t *  @return A map of key => data.\n\t */\n\tgetAll: function() {\n\t\treturn this.get(null);\n\t},\n\n\t/**\n\t *\tGet a single key (does not support multiple) from the storage. If 'key' doesn't exist, 'loadingFn' will be invoked and its result\n\t *\twill be saved in the storage.\n\t *\n\t * \t@param loadingFn A function that returns a Promise (https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)\n\t * \t@param key The key to get from storage\n\t * \t@return The data for key\n\t *\n\t *  todo: check loadingFn is a function + returns a promise\n\t *\n\t */\n\tgetOrElse: function(key, loadingFn) {\n\t\tvar self = this;\n\t\treturn new Promise(function(resolve, reject) {\n\t\t\t// Attempt to get the key\n\t\t\tself.get([key]).then(function(data) {\n\n\t\t\t\t// No key found, call loading function + add to storage\n\t\t\t\tif(!data[key]) {\n\t\t\t\t\treturn loadingFn().then(function(result) {\n\t\t\t\t\t\tself.setSingle(key, result).then(function(data) {\n\t\t\t\t\t\t\tresolve(data[key]);\n\t\t\t\t\t\t});\n\t\t\t\t\t}).catch(function(err) { // Propagate the error\n\t\t\t\t\t\treject(err);\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\t// Key found, just return the data\n\t\t\t\t\tresolve(data[key]);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t},\n\n\t/**\n\t * \tSet multiple values in the storage.\n\t *\n\t * \t@param map A map of key to store as => data to store.\n\t * \t@return The persisted data, in the same format it came in with.\n\t */\n\tset: function(map) {\n\t\treturn new Promise(function(resolve, reject) {\n\t\t\tstorageProvider.set(map, function() {\n\t\t\t\tlastError ? reject(lastError) : resolve(map);\n\t\t\t});\n\t\t});\n\t},\n\n\t/**\n\t * Set a single value in the storage.\n\t * @param key   The key to store\n\t * @param value The data to store.\n\t * @return A map with a single key and data.\n\t */\n\tsetSingle: function(key, value) {\n\t\t// Why create an object? You can't have dynamic property names in an object literal\n\t\tvar dataToSet = {};\n\t\tdataToSet[key] = value;\n\t\treturn this.set(dataToSet);\n\t},\n\n\t/**\n\t * \tRemoves the given keys from the storage.\n\t * \t@param keys An array of keys to delete, or a single string key.\n\t */\n\tremove: function(keys) {\n\t\treturn new Promise(function(resolve, reject) {\n\t\t\tstorageProvider.remove(keys, function() {\n\t\t\t\tlastError ? reject(lastError) : resolve();\n\t\t\t});\n\t\t});\n\t},\n\n\t/**\n\t * \tRemoves ALL keys from storage.\n\t */\n\tclear: function() {\n\t\treturn new Promise(function(resolve, reject) {\n\t\t\tstorageProvider.clear(function() {\n\t\t\t\tlastError ? reject(lastError) : resolve();\n\t\t\t});\n\t\t});\n\t}\n}\n\nmodule.exports = Storage;","/*!\n * URI.js - Mutating URLs\n *\n * Version: 1.19.1\n *\n * Author: Rodney Rehm\n * Web: http://medialize.github.io/URI.js/\n *\n * Licensed under\n *   MIT License http://www.opensource.org/licenses/mit-license\n *\n */\n(function (root, factory) {\n  'use strict';\n  // https://github.com/umdjs/umd/blob/master/returnExports.js\n  if (typeof module === 'object' && module.exports) {\n    // Node\n    module.exports = factory(require('./punycode'), require('./IPv6'), require('./SecondLevelDomains'));\n  } else if (typeof define === 'function' && define.amd) {\n    // AMD. Register as an anonymous module.\n    define(['./punycode', './IPv6', './SecondLevelDomains'], factory);\n  } else {\n    // Browser globals (root is window)\n    root.URI = factory(root.punycode, root.IPv6, root.SecondLevelDomains, root);\n  }\n}(this, function (punycode, IPv6, SLD, root) {\n  'use strict';\n  /*global location, escape, unescape */\n  // FIXME: v2.0.0 renamce non-camelCase properties to uppercase\n  /*jshint camelcase: false */\n\n  // save current URI variable, if any\n  var _URI = root && root.URI;\n\n  function URI(url, base) {\n    var _urlSupplied = arguments.length >= 1;\n    var _baseSupplied = arguments.length >= 2;\n\n    // Allow instantiation without the 'new' keyword\n    if (!(this instanceof URI)) {\n      if (_urlSupplied) {\n        if (_baseSupplied) {\n          return new URI(url, base);\n        }\n\n        return new URI(url);\n      }\n\n      return new URI();\n    }\n\n    if (url === undefined) {\n      if (_urlSupplied) {\n        throw new TypeError('undefined is not a valid argument for URI');\n      }\n\n      if (typeof location !== 'undefined') {\n        url = location.href + '';\n      } else {\n        url = '';\n      }\n    }\n\n    if (url === null) {\n      if (_urlSupplied) {\n        throw new TypeError('null is not a valid argument for URI');\n      }\n    }\n\n    this.href(url);\n\n    // resolve to base according to http://dvcs.w3.org/hg/url/raw-file/tip/Overview.html#constructor\n    if (base !== undefined) {\n      return this.absoluteTo(base);\n    }\n\n    return this;\n  }\n\n  function isInteger(value) {\n    return /^[0-9]+$/.test(value);\n  }\n\n  URI.version = '1.19.1';\n\n  var p = URI.prototype;\n  var hasOwn = Object.prototype.hasOwnProperty;\n\n  function escapeRegEx(string) {\n    // https://github.com/medialize/URI.js/commit/85ac21783c11f8ccab06106dba9735a31a86924d#commitcomment-821963\n    return string.replace(/([.*+?^=!:${}()|[\\]\\/\\\\])/g, '\\\\$1');\n  }\n\n  function getType(value) {\n    // IE8 doesn't return [Object Undefined] but [Object Object] for undefined value\n    if (value === undefined) {\n      return 'Undefined';\n    }\n\n    return String(Object.prototype.toString.call(value)).slice(8, -1);\n  }\n\n  function isArray(obj) {\n    return getType(obj) === 'Array';\n  }\n\n  function filterArrayValues(data, value) {\n    var lookup = {};\n    var i, length;\n\n    if (getType(value) === 'RegExp') {\n      lookup = null;\n    } else if (isArray(value)) {\n      for (i = 0, length = value.length; i < length; i++) {\n        lookup[value[i]] = true;\n      }\n    } else {\n      lookup[value] = true;\n    }\n\n    for (i = 0, length = data.length; i < length; i++) {\n      /*jshint laxbreak: true */\n      var _match = lookup && lookup[data[i]] !== undefined\n        || !lookup && value.test(data[i]);\n      /*jshint laxbreak: false */\n      if (_match) {\n        data.splice(i, 1);\n        length--;\n        i--;\n      }\n    }\n\n    return data;\n  }\n\n  function arrayContains(list, value) {\n    var i, length;\n\n    // value may be string, number, array, regexp\n    if (isArray(value)) {\n      // Note: this can be optimized to O(n) (instead of current O(m * n))\n      for (i = 0, length = value.length; i < length; i++) {\n        if (!arrayContains(list, value[i])) {\n          return false;\n        }\n      }\n\n      return true;\n    }\n\n    var _type = getType(value);\n    for (i = 0, length = list.length; i < length; i++) {\n      if (_type === 'RegExp') {\n        if (typeof list[i] === 'string' && list[i].match(value)) {\n          return true;\n        }\n      } else if (list[i] === value) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  function arraysEqual(one, two) {\n    if (!isArray(one) || !isArray(two)) {\n      return false;\n    }\n\n    // arrays can't be equal if they have different amount of content\n    if (one.length !== two.length) {\n      return false;\n    }\n\n    one.sort();\n    two.sort();\n\n    for (var i = 0, l = one.length; i < l; i++) {\n      if (one[i] !== two[i]) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  function trimSlashes(text) {\n    var trim_expression = /^\\/+|\\/+$/g;\n    return text.replace(trim_expression, '');\n  }\n\n  URI._parts = function() {\n    return {\n      protocol: null,\n      username: null,\n      password: null,\n      hostname: null,\n      urn: null,\n      port: null,\n      path: null,\n      query: null,\n      fragment: null,\n      // state\n      preventInvalidHostname: URI.preventInvalidHostname,\n      duplicateQueryParameters: URI.duplicateQueryParameters,\n      escapeQuerySpace: URI.escapeQuerySpace\n    };\n  };\n  // state: throw on invalid hostname\n  // see https://github.com/medialize/URI.js/pull/345\n  // and https://github.com/medialize/URI.js/issues/354\n  URI.preventInvalidHostname = false;\n  // state: allow duplicate query parameters (a=1&a=1)\n  URI.duplicateQueryParameters = false;\n  // state: replaces + with %20 (space in query strings)\n  URI.escapeQuerySpace = true;\n  // static properties\n  URI.protocol_expression = /^[a-z][a-z0-9.+-]*$/i;\n  URI.idn_expression = /[^a-z0-9\\._-]/i;\n  URI.punycode_expression = /(xn--)/i;\n  // well, 333.444.555.666 matches, but it sure ain't no IPv4 - do we care?\n  URI.ip4_expression = /^\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}$/;\n  // credits to Rich Brown\n  // source: http://forums.intermapper.com/viewtopic.php?p=1096#1096\n  // specification: http://www.ietf.org/rfc/rfc4291.txt\n  URI.ip6_expression = /^\\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:)))(%.+)?\\s*$/;\n  // expression used is \"gruber revised\" (@gruber v2) determined to be the\n  // best solution in a regex-golf we did a couple of ages ago at\n  // * http://mathiasbynens.be/demo/url-regex\n  // * http://rodneyrehm.de/t/url-regex.html\n  URI.find_uri_expression = /\\b((?:[a-z][\\w-]+:(?:\\/{1,3}|[a-z0-9%])|www\\d{0,3}[.]|[a-z0-9.\\-]+[.][a-z]{2,4}\\/)(?:[^\\s()<>]+|\\(([^\\s()<>]+|(\\([^\\s()<>]+\\)))*\\))+(?:\\(([^\\s()<>]+|(\\([^\\s()<>]+\\)))*\\)|[^\\s`!()\\[\\]{};:'\".,<>?«»“”‘’]))/ig;\n  URI.findUri = {\n    // valid \"scheme://\" or \"www.\"\n    start: /\\b(?:([a-z][a-z0-9.+-]*:\\/\\/)|www\\.)/gi,\n    // everything up to the next whitespace\n    end: /[\\s\\r\\n]|$/,\n    // trim trailing punctuation captured by end RegExp\n    trim: /[`!()\\[\\]{};:'\".,<>?«»“”„‘’]+$/,\n    // balanced parens inclusion (), [], {}, <>\n    parens: /(\\([^\\)]*\\)|\\[[^\\]]*\\]|\\{[^}]*\\}|<[^>]*>)/g,\n  };\n  // http://www.iana.org/assignments/uri-schemes.html\n  // http://en.wikipedia.org/wiki/List_of_TCP_and_UDP_port_numbers#Well-known_ports\n  URI.defaultPorts = {\n    http: '80',\n    https: '443',\n    ftp: '21',\n    gopher: '70',\n    ws: '80',\n    wss: '443'\n  };\n  // list of protocols which always require a hostname\n  URI.hostProtocols = [\n    'http',\n    'https'\n  ];\n\n  // allowed hostname characters according to RFC 3986\n  // ALPHA DIGIT \"-\" \".\" \"_\" \"~\" \"!\" \"$\" \"&\" \"'\" \"(\" \")\" \"*\" \"+\" \",\" \";\" \"=\" %encoded\n  // I've never seen a (non-IDN) hostname other than: ALPHA DIGIT . - _\n  URI.invalid_hostname_characters = /[^a-zA-Z0-9\\.\\-:_]/;\n  // map DOM Elements to their URI attribute\n  URI.domAttributes = {\n    'a': 'href',\n    'blockquote': 'cite',\n    'link': 'href',\n    'base': 'href',\n    'script': 'src',\n    'form': 'action',\n    'img': 'src',\n    'area': 'href',\n    'iframe': 'src',\n    'embed': 'src',\n    'source': 'src',\n    'track': 'src',\n    'input': 'src', // but only if type=\"image\"\n    'audio': 'src',\n    'video': 'src'\n  };\n  URI.getDomAttribute = function(node) {\n    if (!node || !node.nodeName) {\n      return undefined;\n    }\n\n    var nodeName = node.nodeName.toLowerCase();\n    // <input> should only expose src for type=\"image\"\n    if (nodeName === 'input' && node.type !== 'image') {\n      return undefined;\n    }\n\n    return URI.domAttributes[nodeName];\n  };\n\n  function escapeForDumbFirefox36(value) {\n    // https://github.com/medialize/URI.js/issues/91\n    return escape(value);\n  }\n\n  // encoding / decoding according to RFC3986\n  function strictEncodeURIComponent(string) {\n    // see https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/encodeURIComponent\n    return encodeURIComponent(string)\n      .replace(/[!'()*]/g, escapeForDumbFirefox36)\n      .replace(/\\*/g, '%2A');\n  }\n  URI.encode = strictEncodeURIComponent;\n  URI.decode = decodeURIComponent;\n  URI.iso8859 = function() {\n    URI.encode = escape;\n    URI.decode = unescape;\n  };\n  URI.unicode = function() {\n    URI.encode = strictEncodeURIComponent;\n    URI.decode = decodeURIComponent;\n  };\n  URI.characters = {\n    pathname: {\n      encode: {\n        // RFC3986 2.1: For consistency, URI producers and normalizers should\n        // use uppercase hexadecimal digits for all percent-encodings.\n        expression: /%(24|26|2B|2C|3B|3D|3A|40)/ig,\n        map: {\n          // -._~!'()*\n          '%24': '$',\n          '%26': '&',\n          '%2B': '+',\n          '%2C': ',',\n          '%3B': ';',\n          '%3D': '=',\n          '%3A': ':',\n          '%40': '@'\n        }\n      },\n      decode: {\n        expression: /[\\/\\?#]/g,\n        map: {\n          '/': '%2F',\n          '?': '%3F',\n          '#': '%23'\n        }\n      }\n    },\n    reserved: {\n      encode: {\n        // RFC3986 2.1: For consistency, URI producers and normalizers should\n        // use uppercase hexadecimal digits for all percent-encodings.\n        expression: /%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/ig,\n        map: {\n          // gen-delims\n          '%3A': ':',\n          '%2F': '/',\n          '%3F': '?',\n          '%23': '#',\n          '%5B': '[',\n          '%5D': ']',\n          '%40': '@',\n          // sub-delims\n          '%21': '!',\n          '%24': '$',\n          '%26': '&',\n          '%27': '\\'',\n          '%28': '(',\n          '%29': ')',\n          '%2A': '*',\n          '%2B': '+',\n          '%2C': ',',\n          '%3B': ';',\n          '%3D': '='\n        }\n      }\n    },\n    urnpath: {\n      // The characters under `encode` are the characters called out by RFC 2141 as being acceptable\n      // for usage in a URN. RFC2141 also calls out \"-\", \".\", and \"_\" as acceptable characters, but\n      // these aren't encoded by encodeURIComponent, so we don't have to call them out here. Also\n      // note that the colon character is not featured in the encoding map; this is because URI.js\n      // gives the colons in URNs semantic meaning as the delimiters of path segements, and so it\n      // should not appear unencoded in a segment itself.\n      // See also the note above about RFC3986 and capitalalized hex digits.\n      encode: {\n        expression: /%(21|24|27|28|29|2A|2B|2C|3B|3D|40)/ig,\n        map: {\n          '%21': '!',\n          '%24': '$',\n          '%27': '\\'',\n          '%28': '(',\n          '%29': ')',\n          '%2A': '*',\n          '%2B': '+',\n          '%2C': ',',\n          '%3B': ';',\n          '%3D': '=',\n          '%40': '@'\n        }\n      },\n      // These characters are the characters called out by RFC2141 as \"reserved\" characters that\n      // should never appear in a URN, plus the colon character (see note above).\n      decode: {\n        expression: /[\\/\\?#:]/g,\n        map: {\n          '/': '%2F',\n          '?': '%3F',\n          '#': '%23',\n          ':': '%3A'\n        }\n      }\n    }\n  };\n  URI.encodeQuery = function(string, escapeQuerySpace) {\n    var escaped = URI.encode(string + '');\n    if (escapeQuerySpace === undefined) {\n      escapeQuerySpace = URI.escapeQuerySpace;\n    }\n\n    return escapeQuerySpace ? escaped.replace(/%20/g, '+') : escaped;\n  };\n  URI.decodeQuery = function(string, escapeQuerySpace) {\n    string += '';\n    if (escapeQuerySpace === undefined) {\n      escapeQuerySpace = URI.escapeQuerySpace;\n    }\n\n    try {\n      return URI.decode(escapeQuerySpace ? string.replace(/\\+/g, '%20') : string);\n    } catch(e) {\n      // we're not going to mess with weird encodings,\n      // give up and return the undecoded original string\n      // see https://github.com/medialize/URI.js/issues/87\n      // see https://github.com/medialize/URI.js/issues/92\n      return string;\n    }\n  };\n  // generate encode/decode path functions\n  var _parts = {'encode':'encode', 'decode':'decode'};\n  var _part;\n  var generateAccessor = function(_group, _part) {\n    return function(string) {\n      try {\n        return URI[_part](string + '').replace(URI.characters[_group][_part].expression, function(c) {\n          return URI.characters[_group][_part].map[c];\n        });\n      } catch (e) {\n        // we're not going to mess with weird encodings,\n        // give up and return the undecoded original string\n        // see https://github.com/medialize/URI.js/issues/87\n        // see https://github.com/medialize/URI.js/issues/92\n        return string;\n      }\n    };\n  };\n\n  for (_part in _parts) {\n    URI[_part + 'PathSegment'] = generateAccessor('pathname', _parts[_part]);\n    URI[_part + 'UrnPathSegment'] = generateAccessor('urnpath', _parts[_part]);\n  }\n\n  var generateSegmentedPathFunction = function(_sep, _codingFuncName, _innerCodingFuncName) {\n    return function(string) {\n      // Why pass in names of functions, rather than the function objects themselves? The\n      // definitions of some functions (but in particular, URI.decode) will occasionally change due\n      // to URI.js having ISO8859 and Unicode modes. Passing in the name and getting it will ensure\n      // that the functions we use here are \"fresh\".\n      var actualCodingFunc;\n      if (!_innerCodingFuncName) {\n        actualCodingFunc = URI[_codingFuncName];\n      } else {\n        actualCodingFunc = function(string) {\n          return URI[_codingFuncName](URI[_innerCodingFuncName](string));\n        };\n      }\n\n      var segments = (string + '').split(_sep);\n\n      for (var i = 0, length = segments.length; i < length; i++) {\n        segments[i] = actualCodingFunc(segments[i]);\n      }\n\n      return segments.join(_sep);\n    };\n  };\n\n  // This takes place outside the above loop because we don't want, e.g., encodeUrnPath functions.\n  URI.decodePath = generateSegmentedPathFunction('/', 'decodePathSegment');\n  URI.decodeUrnPath = generateSegmentedPathFunction(':', 'decodeUrnPathSegment');\n  URI.recodePath = generateSegmentedPathFunction('/', 'encodePathSegment', 'decode');\n  URI.recodeUrnPath = generateSegmentedPathFunction(':', 'encodeUrnPathSegment', 'decode');\n\n  URI.encodeReserved = generateAccessor('reserved', 'encode');\n\n  URI.parse = function(string, parts) {\n    var pos;\n    if (!parts) {\n      parts = {\n        preventInvalidHostname: URI.preventInvalidHostname\n      };\n    }\n    // [protocol\"://\"[username[\":\"password]\"@\"]hostname[\":\"port]\"/\"?][path][\"?\"querystring][\"#\"fragment]\n\n    // extract fragment\n    pos = string.indexOf('#');\n    if (pos > -1) {\n      // escaping?\n      parts.fragment = string.substring(pos + 1) || null;\n      string = string.substring(0, pos);\n    }\n\n    // extract query\n    pos = string.indexOf('?');\n    if (pos > -1) {\n      // escaping?\n      parts.query = string.substring(pos + 1) || null;\n      string = string.substring(0, pos);\n    }\n\n    // extract protocol\n    if (string.substring(0, 2) === '//') {\n      // relative-scheme\n      parts.protocol = null;\n      string = string.substring(2);\n      // extract \"user:pass@host:port\"\n      string = URI.parseAuthority(string, parts);\n    } else {\n      pos = string.indexOf(':');\n      if (pos > -1) {\n        parts.protocol = string.substring(0, pos) || null;\n        if (parts.protocol && !parts.protocol.match(URI.protocol_expression)) {\n          // : may be within the path\n          parts.protocol = undefined;\n        } else if (string.substring(pos + 1, pos + 3) === '//') {\n          string = string.substring(pos + 3);\n\n          // extract \"user:pass@host:port\"\n          string = URI.parseAuthority(string, parts);\n        } else {\n          string = string.substring(pos + 1);\n          parts.urn = true;\n        }\n      }\n    }\n\n    // what's left must be the path\n    parts.path = string;\n\n    // and we're done\n    return parts;\n  };\n  URI.parseHost = function(string, parts) {\n    if (!string) {\n      string = '';\n    }\n\n    // Copy chrome, IE, opera backslash-handling behavior.\n    // Back slashes before the query string get converted to forward slashes\n    // See: https://github.com/joyent/node/blob/386fd24f49b0e9d1a8a076592a404168faeecc34/lib/url.js#L115-L124\n    // See: https://code.google.com/p/chromium/issues/detail?id=25916\n    // https://github.com/medialize/URI.js/pull/233\n    string = string.replace(/\\\\/g, '/');\n\n    // extract host:port\n    var pos = string.indexOf('/');\n    var bracketPos;\n    var t;\n\n    if (pos === -1) {\n      pos = string.length;\n    }\n\n    if (string.charAt(0) === '[') {\n      // IPv6 host - http://tools.ietf.org/html/draft-ietf-6man-text-addr-representation-04#section-6\n      // I claim most client software breaks on IPv6 anyways. To simplify things, URI only accepts\n      // IPv6+port in the format [2001:db8::1]:80 (for the time being)\n      bracketPos = string.indexOf(']');\n      parts.hostname = string.substring(1, bracketPos) || null;\n      parts.port = string.substring(bracketPos + 2, pos) || null;\n      if (parts.port === '/') {\n        parts.port = null;\n      }\n    } else {\n      var firstColon = string.indexOf(':');\n      var firstSlash = string.indexOf('/');\n      var nextColon = string.indexOf(':', firstColon + 1);\n      if (nextColon !== -1 && (firstSlash === -1 || nextColon < firstSlash)) {\n        // IPv6 host contains multiple colons - but no port\n        // this notation is actually not allowed by RFC 3986, but we're a liberal parser\n        parts.hostname = string.substring(0, pos) || null;\n        parts.port = null;\n      } else {\n        t = string.substring(0, pos).split(':');\n        parts.hostname = t[0] || null;\n        parts.port = t[1] || null;\n      }\n    }\n\n    if (parts.hostname && string.substring(pos).charAt(0) !== '/') {\n      pos++;\n      string = '/' + string;\n    }\n\n    if (parts.preventInvalidHostname) {\n      URI.ensureValidHostname(parts.hostname, parts.protocol);\n    }\n\n    if (parts.port) {\n      URI.ensureValidPort(parts.port);\n    }\n\n    return string.substring(pos) || '/';\n  };\n  URI.parseAuthority = function(string, parts) {\n    string = URI.parseUserinfo(string, parts);\n    return URI.parseHost(string, parts);\n  };\n  URI.parseUserinfo = function(string, parts) {\n    // extract username:password\n    var firstSlash = string.indexOf('/');\n    var pos = string.lastIndexOf('@', firstSlash > -1 ? firstSlash : string.length - 1);\n    var t;\n\n    // authority@ must come before /path\n    if (pos > -1 && (firstSlash === -1 || pos < firstSlash)) {\n      t = string.substring(0, pos).split(':');\n      parts.username = t[0] ? URI.decode(t[0]) : null;\n      t.shift();\n      parts.password = t[0] ? URI.decode(t.join(':')) : null;\n      string = string.substring(pos + 1);\n    } else {\n      parts.username = null;\n      parts.password = null;\n    }\n\n    return string;\n  };\n  URI.parseQuery = function(string, escapeQuerySpace) {\n    if (!string) {\n      return {};\n    }\n\n    // throw out the funky business - \"?\"[name\"=\"value\"&\"]+\n    string = string.replace(/&+/g, '&').replace(/^\\?*&*|&+$/g, '');\n\n    if (!string) {\n      return {};\n    }\n\n    var items = {};\n    var splits = string.split('&');\n    var length = splits.length;\n    var v, name, value;\n\n    for (var i = 0; i < length; i++) {\n      v = splits[i].split('=');\n      name = URI.decodeQuery(v.shift(), escapeQuerySpace);\n      // no \"=\" is null according to http://dvcs.w3.org/hg/url/raw-file/tip/Overview.html#collect-url-parameters\n      value = v.length ? URI.decodeQuery(v.join('='), escapeQuerySpace) : null;\n\n      if (hasOwn.call(items, name)) {\n        if (typeof items[name] === 'string' || items[name] === null) {\n          items[name] = [items[name]];\n        }\n\n        items[name].push(value);\n      } else {\n        items[name] = value;\n      }\n    }\n\n    return items;\n  };\n\n  URI.build = function(parts) {\n    var t = '';\n\n    if (parts.protocol) {\n      t += parts.protocol + ':';\n    }\n\n    if (!parts.urn && (t || parts.hostname)) {\n      t += '//';\n    }\n\n    t += (URI.buildAuthority(parts) || '');\n\n    if (typeof parts.path === 'string') {\n      if (parts.path.charAt(0) !== '/' && typeof parts.hostname === 'string') {\n        t += '/';\n      }\n\n      t += parts.path;\n    }\n\n    if (typeof parts.query === 'string' && parts.query) {\n      t += '?' + parts.query;\n    }\n\n    if (typeof parts.fragment === 'string' && parts.fragment) {\n      t += '#' + parts.fragment;\n    }\n    return t;\n  };\n  URI.buildHost = function(parts) {\n    var t = '';\n\n    if (!parts.hostname) {\n      return '';\n    } else if (URI.ip6_expression.test(parts.hostname)) {\n      t += '[' + parts.hostname + ']';\n    } else {\n      t += parts.hostname;\n    }\n\n    if (parts.port) {\n      t += ':' + parts.port;\n    }\n\n    return t;\n  };\n  URI.buildAuthority = function(parts) {\n    return URI.buildUserinfo(parts) + URI.buildHost(parts);\n  };\n  URI.buildUserinfo = function(parts) {\n    var t = '';\n\n    if (parts.username) {\n      t += URI.encode(parts.username);\n    }\n\n    if (parts.password) {\n      t += ':' + URI.encode(parts.password);\n    }\n\n    if (t) {\n      t += '@';\n    }\n\n    return t;\n  };\n  URI.buildQuery = function(data, duplicateQueryParameters, escapeQuerySpace) {\n    // according to http://tools.ietf.org/html/rfc3986 or http://labs.apache.org/webarch/uri/rfc/rfc3986.html\n    // being »-._~!$&'()*+,;=:@/?« %HEX and alnum are allowed\n    // the RFC explicitly states ?/foo being a valid use case, no mention of parameter syntax!\n    // URI.js treats the query string as being application/x-www-form-urlencoded\n    // see http://www.w3.org/TR/REC-html40/interact/forms.html#form-content-type\n\n    var t = '';\n    var unique, key, i, length;\n    for (key in data) {\n      if (hasOwn.call(data, key) && key) {\n        if (isArray(data[key])) {\n          unique = {};\n          for (i = 0, length = data[key].length; i < length; i++) {\n            if (data[key][i] !== undefined && unique[data[key][i] + ''] === undefined) {\n              t += '&' + URI.buildQueryParameter(key, data[key][i], escapeQuerySpace);\n              if (duplicateQueryParameters !== true) {\n                unique[data[key][i] + ''] = true;\n              }\n            }\n          }\n        } else if (data[key] !== undefined) {\n          t += '&' + URI.buildQueryParameter(key, data[key], escapeQuerySpace);\n        }\n      }\n    }\n\n    return t.substring(1);\n  };\n  URI.buildQueryParameter = function(name, value, escapeQuerySpace) {\n    // http://www.w3.org/TR/REC-html40/interact/forms.html#form-content-type -- application/x-www-form-urlencoded\n    // don't append \"=\" for null values, according to http://dvcs.w3.org/hg/url/raw-file/tip/Overview.html#url-parameter-serialization\n    return URI.encodeQuery(name, escapeQuerySpace) + (value !== null ? '=' + URI.encodeQuery(value, escapeQuerySpace) : '');\n  };\n\n  URI.addQuery = function(data, name, value) {\n    if (typeof name === 'object') {\n      for (var key in name) {\n        if (hasOwn.call(name, key)) {\n          URI.addQuery(data, key, name[key]);\n        }\n      }\n    } else if (typeof name === 'string') {\n      if (data[name] === undefined) {\n        data[name] = value;\n        return;\n      } else if (typeof data[name] === 'string') {\n        data[name] = [data[name]];\n      }\n\n      if (!isArray(value)) {\n        value = [value];\n      }\n\n      data[name] = (data[name] || []).concat(value);\n    } else {\n      throw new TypeError('URI.addQuery() accepts an object, string as the name parameter');\n    }\n  };\n\n  URI.setQuery = function(data, name, value) {\n    if (typeof name === 'object') {\n      for (var key in name) {\n        if (hasOwn.call(name, key)) {\n          URI.setQuery(data, key, name[key]);\n        }\n      }\n    } else if (typeof name === 'string') {\n      data[name] = value === undefined ? null : value;\n    } else {\n      throw new TypeError('URI.setQuery() accepts an object, string as the name parameter');\n    }\n  };\n\n  URI.removeQuery = function(data, name, value) {\n    var i, length, key;\n\n    if (isArray(name)) {\n      for (i = 0, length = name.length; i < length; i++) {\n        data[name[i]] = undefined;\n      }\n    } else if (getType(name) === 'RegExp') {\n      for (key in data) {\n        if (name.test(key)) {\n          data[key] = undefined;\n        }\n      }\n    } else if (typeof name === 'object') {\n      for (key in name) {\n        if (hasOwn.call(name, key)) {\n          URI.removeQuery(data, key, name[key]);\n        }\n      }\n    } else if (typeof name === 'string') {\n      if (value !== undefined) {\n        if (getType(value) === 'RegExp') {\n          if (!isArray(data[name]) && value.test(data[name])) {\n            data[name] = undefined;\n          } else {\n            data[name] = filterArrayValues(data[name], value);\n          }\n        } else if (data[name] === String(value) && (!isArray(value) || value.length === 1)) {\n          data[name] = undefined;\n        } else if (isArray(data[name])) {\n          data[name] = filterArrayValues(data[name], value);\n        }\n      } else {\n        data[name] = undefined;\n      }\n    } else {\n      throw new TypeError('URI.removeQuery() accepts an object, string, RegExp as the first parameter');\n    }\n  };\n  URI.hasQuery = function(data, name, value, withinArray) {\n    switch (getType(name)) {\n      case 'String':\n        // Nothing to do here\n        break;\n\n      case 'RegExp':\n        for (var key in data) {\n          if (hasOwn.call(data, key)) {\n            if (name.test(key) && (value === undefined || URI.hasQuery(data, key, value))) {\n              return true;\n            }\n          }\n        }\n\n        return false;\n\n      case 'Object':\n        for (var _key in name) {\n          if (hasOwn.call(name, _key)) {\n            if (!URI.hasQuery(data, _key, name[_key])) {\n              return false;\n            }\n          }\n        }\n\n        return true;\n\n      default:\n        throw new TypeError('URI.hasQuery() accepts a string, regular expression or object as the name parameter');\n    }\n\n    switch (getType(value)) {\n      case 'Undefined':\n        // true if exists (but may be empty)\n        return name in data; // data[name] !== undefined;\n\n      case 'Boolean':\n        // true if exists and non-empty\n        var _booly = Boolean(isArray(data[name]) ? data[name].length : data[name]);\n        return value === _booly;\n\n      case 'Function':\n        // allow complex comparison\n        return !!value(data[name], name, data);\n\n      case 'Array':\n        if (!isArray(data[name])) {\n          return false;\n        }\n\n        var op = withinArray ? arrayContains : arraysEqual;\n        return op(data[name], value);\n\n      case 'RegExp':\n        if (!isArray(data[name])) {\n          return Boolean(data[name] && data[name].match(value));\n        }\n\n        if (!withinArray) {\n          return false;\n        }\n\n        return arrayContains(data[name], value);\n\n      case 'Number':\n        value = String(value);\n        /* falls through */\n      case 'String':\n        if (!isArray(data[name])) {\n          return data[name] === value;\n        }\n\n        if (!withinArray) {\n          return false;\n        }\n\n        return arrayContains(data[name], value);\n\n      default:\n        throw new TypeError('URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter');\n    }\n  };\n\n\n  URI.joinPaths = function() {\n    var input = [];\n    var segments = [];\n    var nonEmptySegments = 0;\n\n    for (var i = 0; i < arguments.length; i++) {\n      var url = new URI(arguments[i]);\n      input.push(url);\n      var _segments = url.segment();\n      for (var s = 0; s < _segments.length; s++) {\n        if (typeof _segments[s] === 'string') {\n          segments.push(_segments[s]);\n        }\n\n        if (_segments[s]) {\n          nonEmptySegments++;\n        }\n      }\n    }\n\n    if (!segments.length || !nonEmptySegments) {\n      return new URI('');\n    }\n\n    var uri = new URI('').segment(segments);\n\n    if (input[0].path() === '' || input[0].path().slice(0, 1) === '/') {\n      uri.path('/' + uri.path());\n    }\n\n    return uri.normalize();\n  };\n\n  URI.commonPath = function(one, two) {\n    var length = Math.min(one.length, two.length);\n    var pos;\n\n    // find first non-matching character\n    for (pos = 0; pos < length; pos++) {\n      if (one.charAt(pos) !== two.charAt(pos)) {\n        pos--;\n        break;\n      }\n    }\n\n    if (pos < 1) {\n      return one.charAt(0) === two.charAt(0) && one.charAt(0) === '/' ? '/' : '';\n    }\n\n    // revert to last /\n    if (one.charAt(pos) !== '/' || two.charAt(pos) !== '/') {\n      pos = one.substring(0, pos).lastIndexOf('/');\n    }\n\n    return one.substring(0, pos + 1);\n  };\n\n  URI.withinString = function(string, callback, options) {\n    options || (options = {});\n    var _start = options.start || URI.findUri.start;\n    var _end = options.end || URI.findUri.end;\n    var _trim = options.trim || URI.findUri.trim;\n    var _parens = options.parens || URI.findUri.parens;\n    var _attributeOpen = /[a-z0-9-]=[\"']?$/i;\n\n    _start.lastIndex = 0;\n    while (true) {\n      var match = _start.exec(string);\n      if (!match) {\n        break;\n      }\n\n      var start = match.index;\n      if (options.ignoreHtml) {\n        // attribut(e=[\"']?$)\n        var attributeOpen = string.slice(Math.max(start - 3, 0), start);\n        if (attributeOpen && _attributeOpen.test(attributeOpen)) {\n          continue;\n        }\n      }\n\n      var end = start + string.slice(start).search(_end);\n      var slice = string.slice(start, end);\n      // make sure we include well balanced parens\n      var parensEnd = -1;\n      while (true) {\n        var parensMatch = _parens.exec(slice);\n        if (!parensMatch) {\n          break;\n        }\n\n        var parensMatchEnd = parensMatch.index + parensMatch[0].length;\n        parensEnd = Math.max(parensEnd, parensMatchEnd);\n      }\n\n      if (parensEnd > -1) {\n        slice = slice.slice(0, parensEnd) + slice.slice(parensEnd).replace(_trim, '');\n      } else {\n        slice = slice.replace(_trim, '');\n      }\n\n      if (slice.length <= match[0].length) {\n        // the extract only contains the starting marker of a URI,\n        // e.g. \"www\" or \"http://\"\n        continue;\n      }\n\n      if (options.ignore && options.ignore.test(slice)) {\n        continue;\n      }\n\n      end = start + slice.length;\n      var result = callback(slice, start, end, string);\n      if (result === undefined) {\n        _start.lastIndex = end;\n        continue;\n      }\n\n      result = String(result);\n      string = string.slice(0, start) + result + string.slice(end);\n      _start.lastIndex = start + result.length;\n    }\n\n    _start.lastIndex = 0;\n    return string;\n  };\n\n  URI.ensureValidHostname = function(v, protocol) {\n    // Theoretically URIs allow percent-encoding in Hostnames (according to RFC 3986)\n    // they are not part of DNS and therefore ignored by URI.js\n\n    var hasHostname = !!v; // not null and not an empty string\n    var hasProtocol = !!protocol;\n    var rejectEmptyHostname = false;\n\n    if (hasProtocol) {\n      rejectEmptyHostname = arrayContains(URI.hostProtocols, protocol);\n    }\n\n    if (rejectEmptyHostname && !hasHostname) {\n      throw new TypeError('Hostname cannot be empty, if protocol is ' + protocol);\n    } else if (v && v.match(URI.invalid_hostname_characters)) {\n      // test punycode\n      if (!punycode) {\n        throw new TypeError('Hostname \"' + v + '\" contains characters other than [A-Z0-9.-:_] and Punycode.js is not available');\n      }\n      if (punycode.toASCII(v).match(URI.invalid_hostname_characters)) {\n        throw new TypeError('Hostname \"' + v + '\" contains characters other than [A-Z0-9.-:_]');\n      }\n    }\n  };\n\n  URI.ensureValidPort = function (v) {\n    if (!v) {\n      return;\n    }\n\n    var port = Number(v);\n    if (isInteger(port) && (port > 0) && (port < 65536)) {\n      return;\n    }\n\n    throw new TypeError('Port \"' + v + '\" is not a valid port');\n  };\n\n  // noConflict\n  URI.noConflict = function(removeAll) {\n    if (removeAll) {\n      var unconflicted = {\n        URI: this.noConflict()\n      };\n\n      if (root.URITemplate && typeof root.URITemplate.noConflict === 'function') {\n        unconflicted.URITemplate = root.URITemplate.noConflict();\n      }\n\n      if (root.IPv6 && typeof root.IPv6.noConflict === 'function') {\n        unconflicted.IPv6 = root.IPv6.noConflict();\n      }\n\n      if (root.SecondLevelDomains && typeof root.SecondLevelDomains.noConflict === 'function') {\n        unconflicted.SecondLevelDomains = root.SecondLevelDomains.noConflict();\n      }\n\n      return unconflicted;\n    } else if (root.URI === this) {\n      root.URI = _URI;\n    }\n\n    return this;\n  };\n\n  p.build = function(deferBuild) {\n    if (deferBuild === true) {\n      this._deferred_build = true;\n    } else if (deferBuild === undefined || this._deferred_build) {\n      this._string = URI.build(this._parts);\n      this._deferred_build = false;\n    }\n\n    return this;\n  };\n\n  p.clone = function() {\n    return new URI(this);\n  };\n\n  p.valueOf = p.toString = function() {\n    return this.build(false)._string;\n  };\n\n\n  function generateSimpleAccessor(_part){\n    return function(v, build) {\n      if (v === undefined) {\n        return this._parts[_part] || '';\n      } else {\n        this._parts[_part] = v || null;\n        this.build(!build);\n        return this;\n      }\n    };\n  }\n\n  function generatePrefixAccessor(_part, _key){\n    return function(v, build) {\n      if (v === undefined) {\n        return this._parts[_part] || '';\n      } else {\n        if (v !== null) {\n          v = v + '';\n          if (v.charAt(0) === _key) {\n            v = v.substring(1);\n          }\n        }\n\n        this._parts[_part] = v;\n        this.build(!build);\n        return this;\n      }\n    };\n  }\n\n  p.protocol = generateSimpleAccessor('protocol');\n  p.username = generateSimpleAccessor('username');\n  p.password = generateSimpleAccessor('password');\n  p.hostname = generateSimpleAccessor('hostname');\n  p.port = generateSimpleAccessor('port');\n  p.query = generatePrefixAccessor('query', '?');\n  p.fragment = generatePrefixAccessor('fragment', '#');\n\n  p.search = function(v, build) {\n    var t = this.query(v, build);\n    return typeof t === 'string' && t.length ? ('?' + t) : t;\n  };\n  p.hash = function(v, build) {\n    var t = this.fragment(v, build);\n    return typeof t === 'string' && t.length ? ('#' + t) : t;\n  };\n\n  p.pathname = function(v, build) {\n    if (v === undefined || v === true) {\n      var res = this._parts.path || (this._parts.hostname ? '/' : '');\n      return v ? (this._parts.urn ? URI.decodeUrnPath : URI.decodePath)(res) : res;\n    } else {\n      if (this._parts.urn) {\n        this._parts.path = v ? URI.recodeUrnPath(v) : '';\n      } else {\n        this._parts.path = v ? URI.recodePath(v) : '/';\n      }\n      this.build(!build);\n      return this;\n    }\n  };\n  p.path = p.pathname;\n  p.href = function(href, build) {\n    var key;\n\n    if (href === undefined) {\n      return this.toString();\n    }\n\n    this._string = '';\n    this._parts = URI._parts();\n\n    var _URI = href instanceof URI;\n    var _object = typeof href === 'object' && (href.hostname || href.path || href.pathname);\n    if (href.nodeName) {\n      var attribute = URI.getDomAttribute(href);\n      href = href[attribute] || '';\n      _object = false;\n    }\n\n    // window.location is reported to be an object, but it's not the sort\n    // of object we're looking for:\n    // * location.protocol ends with a colon\n    // * location.query != object.search\n    // * location.hash != object.fragment\n    // simply serializing the unknown object should do the trick\n    // (for location, not for everything...)\n    if (!_URI && _object && href.pathname !== undefined) {\n      href = href.toString();\n    }\n\n    if (typeof href === 'string' || href instanceof String) {\n      this._parts = URI.parse(String(href), this._parts);\n    } else if (_URI || _object) {\n      var src = _URI ? href._parts : href;\n      for (key in src) {\n        if (key === 'query') { continue; }\n        if (hasOwn.call(this._parts, key)) {\n          this._parts[key] = src[key];\n        }\n      }\n      if (src.query) {\n        this.query(src.query, false);\n      }\n    } else {\n      throw new TypeError('invalid input');\n    }\n\n    this.build(!build);\n    return this;\n  };\n\n  // identification accessors\n  p.is = function(what) {\n    var ip = false;\n    var ip4 = false;\n    var ip6 = false;\n    var name = false;\n    var sld = false;\n    var idn = false;\n    var punycode = false;\n    var relative = !this._parts.urn;\n\n    if (this._parts.hostname) {\n      relative = false;\n      ip4 = URI.ip4_expression.test(this._parts.hostname);\n      ip6 = URI.ip6_expression.test(this._parts.hostname);\n      ip = ip4 || ip6;\n      name = !ip;\n      sld = name && SLD && SLD.has(this._parts.hostname);\n      idn = name && URI.idn_expression.test(this._parts.hostname);\n      punycode = name && URI.punycode_expression.test(this._parts.hostname);\n    }\n\n    switch (what.toLowerCase()) {\n      case 'relative':\n        return relative;\n\n      case 'absolute':\n        return !relative;\n\n      // hostname identification\n      case 'domain':\n      case 'name':\n        return name;\n\n      case 'sld':\n        return sld;\n\n      case 'ip':\n        return ip;\n\n      case 'ip4':\n      case 'ipv4':\n      case 'inet4':\n        return ip4;\n\n      case 'ip6':\n      case 'ipv6':\n      case 'inet6':\n        return ip6;\n\n      case 'idn':\n        return idn;\n\n      case 'url':\n        return !this._parts.urn;\n\n      case 'urn':\n        return !!this._parts.urn;\n\n      case 'punycode':\n        return punycode;\n    }\n\n    return null;\n  };\n\n  // component specific input validation\n  var _protocol = p.protocol;\n  var _port = p.port;\n  var _hostname = p.hostname;\n\n  p.protocol = function(v, build) {\n    if (v) {\n      // accept trailing ://\n      v = v.replace(/:(\\/\\/)?$/, '');\n\n      if (!v.match(URI.protocol_expression)) {\n        throw new TypeError('Protocol \"' + v + '\" contains characters other than [A-Z0-9.+-] or doesn\\'t start with [A-Z]');\n      }\n    }\n\n    return _protocol.call(this, v, build);\n  };\n  p.scheme = p.protocol;\n  p.port = function(v, build) {\n    if (this._parts.urn) {\n      return v === undefined ? '' : this;\n    }\n\n    if (v !== undefined) {\n      if (v === 0) {\n        v = null;\n      }\n\n      if (v) {\n        v += '';\n        if (v.charAt(0) === ':') {\n          v = v.substring(1);\n        }\n\n        URI.ensureValidPort(v);\n      }\n    }\n    return _port.call(this, v, build);\n  };\n  p.hostname = function(v, build) {\n    if (this._parts.urn) {\n      return v === undefined ? '' : this;\n    }\n\n    if (v !== undefined) {\n      var x = { preventInvalidHostname: this._parts.preventInvalidHostname };\n      var res = URI.parseHost(v, x);\n      if (res !== '/') {\n        throw new TypeError('Hostname \"' + v + '\" contains characters other than [A-Z0-9.-]');\n      }\n\n      v = x.hostname;\n      if (this._parts.preventInvalidHostname) {\n        URI.ensureValidHostname(v, this._parts.protocol);\n      }\n    }\n\n    return _hostname.call(this, v, build);\n  };\n\n  // compound accessors\n  p.origin = function(v, build) {\n    if (this._parts.urn) {\n      return v === undefined ? '' : this;\n    }\n\n    if (v === undefined) {\n      var protocol = this.protocol();\n      var authority = this.authority();\n      if (!authority) {\n        return '';\n      }\n\n      return (protocol ? protocol + '://' : '') + this.authority();\n    } else {\n      var origin = URI(v);\n      this\n        .protocol(origin.protocol())\n        .authority(origin.authority())\n        .build(!build);\n      return this;\n    }\n  };\n  p.host = function(v, build) {\n    if (this._parts.urn) {\n      return v === undefined ? '' : this;\n    }\n\n    if (v === undefined) {\n      return this._parts.hostname ? URI.buildHost(this._parts) : '';\n    } else {\n      var res = URI.parseHost(v, this._parts);\n      if (res !== '/') {\n        throw new TypeError('Hostname \"' + v + '\" contains characters other than [A-Z0-9.-]');\n      }\n\n      this.build(!build);\n      return this;\n    }\n  };\n  p.authority = function(v, build) {\n    if (this._parts.urn) {\n      return v === undefined ? '' : this;\n    }\n\n    if (v === undefined) {\n      return this._parts.hostname ? URI.buildAuthority(this._parts) : '';\n    } else {\n      var res = URI.parseAuthority(v, this._parts);\n      if (res !== '/') {\n        throw new TypeError('Hostname \"' + v + '\" contains characters other than [A-Z0-9.-]');\n      }\n\n      this.build(!build);\n      return this;\n    }\n  };\n  p.userinfo = function(v, build) {\n    if (this._parts.urn) {\n      return v === undefined ? '' : this;\n    }\n\n    if (v === undefined) {\n      var t = URI.buildUserinfo(this._parts);\n      return t ? t.substring(0, t.length -1) : t;\n    } else {\n      if (v[v.length-1] !== '@') {\n        v += '@';\n      }\n\n      URI.parseUserinfo(v, this._parts);\n      this.build(!build);\n      return this;\n    }\n  };\n  p.resource = function(v, build) {\n    var parts;\n\n    if (v === undefined) {\n      return this.path() + this.search() + this.hash();\n    }\n\n    parts = URI.parse(v);\n    this._parts.path = parts.path;\n    this._parts.query = parts.query;\n    this._parts.fragment = parts.fragment;\n    this.build(!build);\n    return this;\n  };\n\n  // fraction accessors\n  p.subdomain = function(v, build) {\n    if (this._parts.urn) {\n      return v === undefined ? '' : this;\n    }\n\n    // convenience, return \"www\" from \"www.example.org\"\n    if (v === undefined) {\n      if (!this._parts.hostname || this.is('IP')) {\n        return '';\n      }\n\n      // grab domain and add another segment\n      var end = this._parts.hostname.length - this.domain().length - 1;\n      return this._parts.hostname.substring(0, end) || '';\n    } else {\n      var e = this._parts.hostname.length - this.domain().length;\n      var sub = this._parts.hostname.substring(0, e);\n      var replace = new RegExp('^' + escapeRegEx(sub));\n\n      if (v && v.charAt(v.length - 1) !== '.') {\n        v += '.';\n      }\n\n      if (v.indexOf(':') !== -1) {\n        throw new TypeError('Domains cannot contain colons');\n      }\n\n      if (v) {\n        URI.ensureValidHostname(v, this._parts.protocol);\n      }\n\n      this._parts.hostname = this._parts.hostname.replace(replace, v);\n      this.build(!build);\n      return this;\n    }\n  };\n  p.domain = function(v, build) {\n    if (this._parts.urn) {\n      return v === undefined ? '' : this;\n    }\n\n    if (typeof v === 'boolean') {\n      build = v;\n      v = undefined;\n    }\n\n    // convenience, return \"example.org\" from \"www.example.org\"\n    if (v === undefined) {\n      if (!this._parts.hostname || this.is('IP')) {\n        return '';\n      }\n\n      // if hostname consists of 1 or 2 segments, it must be the domain\n      var t = this._parts.hostname.match(/\\./g);\n      if (t && t.length < 2) {\n        return this._parts.hostname;\n      }\n\n      // grab tld and add another segment\n      var end = this._parts.hostname.length - this.tld(build).length - 1;\n      end = this._parts.hostname.lastIndexOf('.', end -1) + 1;\n      return this._parts.hostname.substring(end) || '';\n    } else {\n      if (!v) {\n        throw new TypeError('cannot set domain empty');\n      }\n\n      if (v.indexOf(':') !== -1) {\n        throw new TypeError('Domains cannot contain colons');\n      }\n\n      URI.ensureValidHostname(v, this._parts.protocol);\n\n      if (!this._parts.hostname || this.is('IP')) {\n        this._parts.hostname = v;\n      } else {\n        var replace = new RegExp(escapeRegEx(this.domain()) + '$');\n        this._parts.hostname = this._parts.hostname.replace(replace, v);\n      }\n\n      this.build(!build);\n      return this;\n    }\n  };\n  p.tld = function(v, build) {\n    if (this._parts.urn) {\n      return v === undefined ? '' : this;\n    }\n\n    if (typeof v === 'boolean') {\n      build = v;\n      v = undefined;\n    }\n\n    // return \"org\" from \"www.example.org\"\n    if (v === undefined) {\n      if (!this._parts.hostname || this.is('IP')) {\n        return '';\n      }\n\n      var pos = this._parts.hostname.lastIndexOf('.');\n      var tld = this._parts.hostname.substring(pos + 1);\n\n      if (build !== true && SLD && SLD.list[tld.toLowerCase()]) {\n        return SLD.get(this._parts.hostname) || tld;\n      }\n\n      return tld;\n    } else {\n      var replace;\n\n      if (!v) {\n        throw new TypeError('cannot set TLD empty');\n      } else if (v.match(/[^a-zA-Z0-9-]/)) {\n        if (SLD && SLD.is(v)) {\n          replace = new RegExp(escapeRegEx(this.tld()) + '$');\n          this._parts.hostname = this._parts.hostname.replace(replace, v);\n        } else {\n          throw new TypeError('TLD \"' + v + '\" contains characters other than [A-Z0-9]');\n        }\n      } else if (!this._parts.hostname || this.is('IP')) {\n        throw new ReferenceError('cannot set TLD on non-domain host');\n      } else {\n        replace = new RegExp(escapeRegEx(this.tld()) + '$');\n        this._parts.hostname = this._parts.hostname.replace(replace, v);\n      }\n\n      this.build(!build);\n      return this;\n    }\n  };\n  p.directory = function(v, build) {\n    if (this._parts.urn) {\n      return v === undefined ? '' : this;\n    }\n\n    if (v === undefined || v === true) {\n      if (!this._parts.path && !this._parts.hostname) {\n        return '';\n      }\n\n      if (this._parts.path === '/') {\n        return '/';\n      }\n\n      var end = this._parts.path.length - this.filename().length - 1;\n      var res = this._parts.path.substring(0, end) || (this._parts.hostname ? '/' : '');\n\n      return v ? URI.decodePath(res) : res;\n\n    } else {\n      var e = this._parts.path.length - this.filename().length;\n      var directory = this._parts.path.substring(0, e);\n      var replace = new RegExp('^' + escapeRegEx(directory));\n\n      // fully qualifier directories begin with a slash\n      if (!this.is('relative')) {\n        if (!v) {\n          v = '/';\n        }\n\n        if (v.charAt(0) !== '/') {\n          v = '/' + v;\n        }\n      }\n\n      // directories always end with a slash\n      if (v && v.charAt(v.length - 1) !== '/') {\n        v += '/';\n      }\n\n      v = URI.recodePath(v);\n      this._parts.path = this._parts.path.replace(replace, v);\n      this.build(!build);\n      return this;\n    }\n  };\n  p.filename = function(v, build) {\n    if (this._parts.urn) {\n      return v === undefined ? '' : this;\n    }\n\n    if (typeof v !== 'string') {\n      if (!this._parts.path || this._parts.path === '/') {\n        return '';\n      }\n\n      var pos = this._parts.path.lastIndexOf('/');\n      var res = this._parts.path.substring(pos+1);\n\n      return v ? URI.decodePathSegment(res) : res;\n    } else {\n      var mutatedDirectory = false;\n\n      if (v.charAt(0) === '/') {\n        v = v.substring(1);\n      }\n\n      if (v.match(/\\.?\\//)) {\n        mutatedDirectory = true;\n      }\n\n      var replace = new RegExp(escapeRegEx(this.filename()) + '$');\n      v = URI.recodePath(v);\n      this._parts.path = this._parts.path.replace(replace, v);\n\n      if (mutatedDirectory) {\n        this.normalizePath(build);\n      } else {\n        this.build(!build);\n      }\n\n      return this;\n    }\n  };\n  p.suffix = function(v, build) {\n    if (this._parts.urn) {\n      return v === undefined ? '' : this;\n    }\n\n    if (v === undefined || v === true) {\n      if (!this._parts.path || this._parts.path === '/') {\n        return '';\n      }\n\n      var filename = this.filename();\n      var pos = filename.lastIndexOf('.');\n      var s, res;\n\n      if (pos === -1) {\n        return '';\n      }\n\n      // suffix may only contain alnum characters (yup, I made this up.)\n      s = filename.substring(pos+1);\n      res = (/^[a-z0-9%]+$/i).test(s) ? s : '';\n      return v ? URI.decodePathSegment(res) : res;\n    } else {\n      if (v.charAt(0) === '.') {\n        v = v.substring(1);\n      }\n\n      var suffix = this.suffix();\n      var replace;\n\n      if (!suffix) {\n        if (!v) {\n          return this;\n        }\n\n        this._parts.path += '.' + URI.recodePath(v);\n      } else if (!v) {\n        replace = new RegExp(escapeRegEx('.' + suffix) + '$');\n      } else {\n        replace = new RegExp(escapeRegEx(suffix) + '$');\n      }\n\n      if (replace) {\n        v = URI.recodePath(v);\n        this._parts.path = this._parts.path.replace(replace, v);\n      }\n\n      this.build(!build);\n      return this;\n    }\n  };\n  p.segment = function(segment, v, build) {\n    var separator = this._parts.urn ? ':' : '/';\n    var path = this.path();\n    var absolute = path.substring(0, 1) === '/';\n    var segments = path.split(separator);\n\n    if (segment !== undefined && typeof segment !== 'number') {\n      build = v;\n      v = segment;\n      segment = undefined;\n    }\n\n    if (segment !== undefined && typeof segment !== 'number') {\n      throw new Error('Bad segment \"' + segment + '\", must be 0-based integer');\n    }\n\n    if (absolute) {\n      segments.shift();\n    }\n\n    if (segment < 0) {\n      // allow negative indexes to address from the end\n      segment = Math.max(segments.length + segment, 0);\n    }\n\n    if (v === undefined) {\n      /*jshint laxbreak: true */\n      return segment === undefined\n        ? segments\n        : segments[segment];\n      /*jshint laxbreak: false */\n    } else if (segment === null || segments[segment] === undefined) {\n      if (isArray(v)) {\n        segments = [];\n        // collapse empty elements within array\n        for (var i=0, l=v.length; i < l; i++) {\n          if (!v[i].length && (!segments.length || !segments[segments.length -1].length)) {\n            continue;\n          }\n\n          if (segments.length && !segments[segments.length -1].length) {\n            segments.pop();\n          }\n\n          segments.push(trimSlashes(v[i]));\n        }\n      } else if (v || typeof v === 'string') {\n        v = trimSlashes(v);\n        if (segments[segments.length -1] === '') {\n          // empty trailing elements have to be overwritten\n          // to prevent results such as /foo//bar\n          segments[segments.length -1] = v;\n        } else {\n          segments.push(v);\n        }\n      }\n    } else {\n      if (v) {\n        segments[segment] = trimSlashes(v);\n      } else {\n        segments.splice(segment, 1);\n      }\n    }\n\n    if (absolute) {\n      segments.unshift('');\n    }\n\n    return this.path(segments.join(separator), build);\n  };\n  p.segmentCoded = function(segment, v, build) {\n    var segments, i, l;\n\n    if (typeof segment !== 'number') {\n      build = v;\n      v = segment;\n      segment = undefined;\n    }\n\n    if (v === undefined) {\n      segments = this.segment(segment, v, build);\n      if (!isArray(segments)) {\n        segments = segments !== undefined ? URI.decode(segments) : undefined;\n      } else {\n        for (i = 0, l = segments.length; i < l; i++) {\n          segments[i] = URI.decode(segments[i]);\n        }\n      }\n\n      return segments;\n    }\n\n    if (!isArray(v)) {\n      v = (typeof v === 'string' || v instanceof String) ? URI.encode(v) : v;\n    } else {\n      for (i = 0, l = v.length; i < l; i++) {\n        v[i] = URI.encode(v[i]);\n      }\n    }\n\n    return this.segment(segment, v, build);\n  };\n\n  // mutating query string\n  var q = p.query;\n  p.query = function(v, build) {\n    if (v === true) {\n      return URI.parseQuery(this._parts.query, this._parts.escapeQuerySpace);\n    } else if (typeof v === 'function') {\n      var data = URI.parseQuery(this._parts.query, this._parts.escapeQuerySpace);\n      var result = v.call(this, data);\n      this._parts.query = URI.buildQuery(result || data, this._parts.duplicateQueryParameters, this._parts.escapeQuerySpace);\n      this.build(!build);\n      return this;\n    } else if (v !== undefined && typeof v !== 'string') {\n      this._parts.query = URI.buildQuery(v, this._parts.duplicateQueryParameters, this._parts.escapeQuerySpace);\n      this.build(!build);\n      return this;\n    } else {\n      return q.call(this, v, build);\n    }\n  };\n  p.setQuery = function(name, value, build) {\n    var data = URI.parseQuery(this._parts.query, this._parts.escapeQuerySpace);\n\n    if (typeof name === 'string' || name instanceof String) {\n      data[name] = value !== undefined ? value : null;\n    } else if (typeof name === 'object') {\n      for (var key in name) {\n        if (hasOwn.call(name, key)) {\n          data[key] = name[key];\n        }\n      }\n    } else {\n      throw new TypeError('URI.addQuery() accepts an object, string as the name parameter');\n    }\n\n    this._parts.query = URI.buildQuery(data, this._parts.duplicateQueryParameters, this._parts.escapeQuerySpace);\n    if (typeof name !== 'string') {\n      build = value;\n    }\n\n    this.build(!build);\n    return this;\n  };\n  p.addQuery = function(name, value, build) {\n    var data = URI.parseQuery(this._parts.query, this._parts.escapeQuerySpace);\n    URI.addQuery(data, name, value === undefined ? null : value);\n    this._parts.query = URI.buildQuery(data, this._parts.duplicateQueryParameters, this._parts.escapeQuerySpace);\n    if (typeof name !== 'string') {\n      build = value;\n    }\n\n    this.build(!build);\n    return this;\n  };\n  p.removeQuery = function(name, value, build) {\n    var data = URI.parseQuery(this._parts.query, this._parts.escapeQuerySpace);\n    URI.removeQuery(data, name, value);\n    this._parts.query = URI.buildQuery(data, this._parts.duplicateQueryParameters, this._parts.escapeQuerySpace);\n    if (typeof name !== 'string') {\n      build = value;\n    }\n\n    this.build(!build);\n    return this;\n  };\n  p.hasQuery = function(name, value, withinArray) {\n    var data = URI.parseQuery(this._parts.query, this._parts.escapeQuerySpace);\n    return URI.hasQuery(data, name, value, withinArray);\n  };\n  p.setSearch = p.setQuery;\n  p.addSearch = p.addQuery;\n  p.removeSearch = p.removeQuery;\n  p.hasSearch = p.hasQuery;\n\n  // sanitizing URLs\n  p.normalize = function() {\n    if (this._parts.urn) {\n      return this\n        .normalizeProtocol(false)\n        .normalizePath(false)\n        .normalizeQuery(false)\n        .normalizeFragment(false)\n        .build();\n    }\n\n    return this\n      .normalizeProtocol(false)\n      .normalizeHostname(false)\n      .normalizePort(false)\n      .normalizePath(false)\n      .normalizeQuery(false)\n      .normalizeFragment(false)\n      .build();\n  };\n  p.normalizeProtocol = function(build) {\n    if (typeof this._parts.protocol === 'string') {\n      this._parts.protocol = this._parts.protocol.toLowerCase();\n      this.build(!build);\n    }\n\n    return this;\n  };\n  p.normalizeHostname = function(build) {\n    if (this._parts.hostname) {\n      if (this.is('IDN') && punycode) {\n        this._parts.hostname = punycode.toASCII(this._parts.hostname);\n      } else if (this.is('IPv6') && IPv6) {\n        this._parts.hostname = IPv6.best(this._parts.hostname);\n      }\n\n      this._parts.hostname = this._parts.hostname.toLowerCase();\n      this.build(!build);\n    }\n\n    return this;\n  };\n  p.normalizePort = function(build) {\n    // remove port of it's the protocol's default\n    if (typeof this._parts.protocol === 'string' && this._parts.port === URI.defaultPorts[this._parts.protocol]) {\n      this._parts.port = null;\n      this.build(!build);\n    }\n\n    return this;\n  };\n  p.normalizePath = function(build) {\n    var _path = this._parts.path;\n    if (!_path) {\n      return this;\n    }\n\n    if (this._parts.urn) {\n      this._parts.path = URI.recodeUrnPath(this._parts.path);\n      this.build(!build);\n      return this;\n    }\n\n    if (this._parts.path === '/') {\n      return this;\n    }\n\n    _path = URI.recodePath(_path);\n\n    var _was_relative;\n    var _leadingParents = '';\n    var _parent, _pos;\n\n    // handle relative paths\n    if (_path.charAt(0) !== '/') {\n      _was_relative = true;\n      _path = '/' + _path;\n    }\n\n    // handle relative files (as opposed to directories)\n    if (_path.slice(-3) === '/..' || _path.slice(-2) === '/.') {\n      _path += '/';\n    }\n\n    // resolve simples\n    _path = _path\n      .replace(/(\\/(\\.\\/)+)|(\\/\\.$)/g, '/')\n      .replace(/\\/{2,}/g, '/');\n\n    // remember leading parents\n    if (_was_relative) {\n      _leadingParents = _path.substring(1).match(/^(\\.\\.\\/)+/) || '';\n      if (_leadingParents) {\n        _leadingParents = _leadingParents[0];\n      }\n    }\n\n    // resolve parents\n    while (true) {\n      _parent = _path.search(/\\/\\.\\.(\\/|$)/);\n      if (_parent === -1) {\n        // no more ../ to resolve\n        break;\n      } else if (_parent === 0) {\n        // top level cannot be relative, skip it\n        _path = _path.substring(3);\n        continue;\n      }\n\n      _pos = _path.substring(0, _parent).lastIndexOf('/');\n      if (_pos === -1) {\n        _pos = _parent;\n      }\n      _path = _path.substring(0, _pos) + _path.substring(_parent + 3);\n    }\n\n    // revert to relative\n    if (_was_relative && this.is('relative')) {\n      _path = _leadingParents + _path.substring(1);\n    }\n\n    this._parts.path = _path;\n    this.build(!build);\n    return this;\n  };\n  p.normalizePathname = p.normalizePath;\n  p.normalizeQuery = function(build) {\n    if (typeof this._parts.query === 'string') {\n      if (!this._parts.query.length) {\n        this._parts.query = null;\n      } else {\n        this.query(URI.parseQuery(this._parts.query, this._parts.escapeQuerySpace));\n      }\n\n      this.build(!build);\n    }\n\n    return this;\n  };\n  p.normalizeFragment = function(build) {\n    if (!this._parts.fragment) {\n      this._parts.fragment = null;\n      this.build(!build);\n    }\n\n    return this;\n  };\n  p.normalizeSearch = p.normalizeQuery;\n  p.normalizeHash = p.normalizeFragment;\n\n  p.iso8859 = function() {\n    // expect unicode input, iso8859 output\n    var e = URI.encode;\n    var d = URI.decode;\n\n    URI.encode = escape;\n    URI.decode = decodeURIComponent;\n    try {\n      this.normalize();\n    } finally {\n      URI.encode = e;\n      URI.decode = d;\n    }\n    return this;\n  };\n\n  p.unicode = function() {\n    // expect iso8859 input, unicode output\n    var e = URI.encode;\n    var d = URI.decode;\n\n    URI.encode = strictEncodeURIComponent;\n    URI.decode = unescape;\n    try {\n      this.normalize();\n    } finally {\n      URI.encode = e;\n      URI.decode = d;\n    }\n    return this;\n  };\n\n  p.readable = function() {\n    var uri = this.clone();\n    // removing username, password, because they shouldn't be displayed according to RFC 3986\n    uri.username('').password('').normalize();\n    var t = '';\n    if (uri._parts.protocol) {\n      t += uri._parts.protocol + '://';\n    }\n\n    if (uri._parts.hostname) {\n      if (uri.is('punycode') && punycode) {\n        t += punycode.toUnicode(uri._parts.hostname);\n        if (uri._parts.port) {\n          t += ':' + uri._parts.port;\n        }\n      } else {\n        t += uri.host();\n      }\n    }\n\n    if (uri._parts.hostname && uri._parts.path && uri._parts.path.charAt(0) !== '/') {\n      t += '/';\n    }\n\n    t += uri.path(true);\n    if (uri._parts.query) {\n      var q = '';\n      for (var i = 0, qp = uri._parts.query.split('&'), l = qp.length; i < l; i++) {\n        var kv = (qp[i] || '').split('=');\n        q += '&' + URI.decodeQuery(kv[0], this._parts.escapeQuerySpace)\n          .replace(/&/g, '%26');\n\n        if (kv[1] !== undefined) {\n          q += '=' + URI.decodeQuery(kv[1], this._parts.escapeQuerySpace)\n            .replace(/&/g, '%26');\n        }\n      }\n      t += '?' + q.substring(1);\n    }\n\n    t += URI.decodeQuery(uri.hash(), true);\n    return t;\n  };\n\n  // resolving relative and absolute URLs\n  p.absoluteTo = function(base) {\n    var resolved = this.clone();\n    var properties = ['protocol', 'username', 'password', 'hostname', 'port'];\n    var basedir, i, p;\n\n    if (this._parts.urn) {\n      throw new Error('URNs do not have any generally defined hierarchical components');\n    }\n\n    if (!(base instanceof URI)) {\n      base = new URI(base);\n    }\n\n    if (resolved._parts.protocol) {\n      // Directly returns even if this._parts.hostname is empty.\n      return resolved;\n    } else {\n      resolved._parts.protocol = base._parts.protocol;\n    }\n\n    if (this._parts.hostname) {\n      return resolved;\n    }\n\n    for (i = 0; (p = properties[i]); i++) {\n      resolved._parts[p] = base._parts[p];\n    }\n\n    if (!resolved._parts.path) {\n      resolved._parts.path = base._parts.path;\n      if (!resolved._parts.query) {\n        resolved._parts.query = base._parts.query;\n      }\n    } else {\n      if (resolved._parts.path.substring(-2) === '..') {\n        resolved._parts.path += '/';\n      }\n\n      if (resolved.path().charAt(0) !== '/') {\n        basedir = base.directory();\n        basedir = basedir ? basedir : base.path().indexOf('/') === 0 ? '/' : '';\n        resolved._parts.path = (basedir ? (basedir + '/') : '') + resolved._parts.path;\n        resolved.normalizePath();\n      }\n    }\n\n    resolved.build();\n    return resolved;\n  };\n  p.relativeTo = function(base) {\n    var relative = this.clone().normalize();\n    var relativeParts, baseParts, common, relativePath, basePath;\n\n    if (relative._parts.urn) {\n      throw new Error('URNs do not have any generally defined hierarchical components');\n    }\n\n    base = new URI(base).normalize();\n    relativeParts = relative._parts;\n    baseParts = base._parts;\n    relativePath = relative.path();\n    basePath = base.path();\n\n    if (relativePath.charAt(0) !== '/') {\n      throw new Error('URI is already relative');\n    }\n\n    if (basePath.charAt(0) !== '/') {\n      throw new Error('Cannot calculate a URI relative to another relative URI');\n    }\n\n    if (relativeParts.protocol === baseParts.protocol) {\n      relativeParts.protocol = null;\n    }\n\n    if (relativeParts.username !== baseParts.username || relativeParts.password !== baseParts.password) {\n      return relative.build();\n    }\n\n    if (relativeParts.protocol !== null || relativeParts.username !== null || relativeParts.password !== null) {\n      return relative.build();\n    }\n\n    if (relativeParts.hostname === baseParts.hostname && relativeParts.port === baseParts.port) {\n      relativeParts.hostname = null;\n      relativeParts.port = null;\n    } else {\n      return relative.build();\n    }\n\n    if (relativePath === basePath) {\n      relativeParts.path = '';\n      return relative.build();\n    }\n\n    // determine common sub path\n    common = URI.commonPath(relativePath, basePath);\n\n    // If the paths have nothing in common, return a relative URL with the absolute path.\n    if (!common) {\n      return relative.build();\n    }\n\n    var parents = baseParts.path\n      .substring(common.length)\n      .replace(/[^\\/]*$/, '')\n      .replace(/.*?\\//g, '../');\n\n    relativeParts.path = (parents + relativeParts.path.substring(common.length)) || './';\n\n    return relative.build();\n  };\n\n  // comparing URIs\n  p.equals = function(uri) {\n    var one = this.clone();\n    var two = new URI(uri);\n    var one_map = {};\n    var two_map = {};\n    var checked = {};\n    var one_query, two_query, key;\n\n    one.normalize();\n    two.normalize();\n\n    // exact match\n    if (one.toString() === two.toString()) {\n      return true;\n    }\n\n    // extract query string\n    one_query = one.query();\n    two_query = two.query();\n    one.query('');\n    two.query('');\n\n    // definitely not equal if not even non-query parts match\n    if (one.toString() !== two.toString()) {\n      return false;\n    }\n\n    // query parameters have the same length, even if they're permuted\n    if (one_query.length !== two_query.length) {\n      return false;\n    }\n\n    one_map = URI.parseQuery(one_query, this._parts.escapeQuerySpace);\n    two_map = URI.parseQuery(two_query, this._parts.escapeQuerySpace);\n\n    for (key in one_map) {\n      if (hasOwn.call(one_map, key)) {\n        if (!isArray(one_map[key])) {\n          if (one_map[key] !== two_map[key]) {\n            return false;\n          }\n        } else if (!arraysEqual(one_map[key], two_map[key])) {\n          return false;\n        }\n\n        checked[key] = true;\n      }\n    }\n\n    for (key in two_map) {\n      if (hasOwn.call(two_map, key)) {\n        if (!checked[key]) {\n          // two contains a parameter not present in one\n          return false;\n        }\n      }\n    }\n\n    return true;\n  };\n\n  // state\n  p.preventInvalidHostname = function(v) {\n    this._parts.preventInvalidHostname = !!v;\n    return this;\n  };\n\n  p.duplicateQueryParameters = function(v) {\n    this._parts.duplicateQueryParameters = !!v;\n    return this;\n  };\n\n  p.escapeQuerySpace = function(v) {\n    this._parts.escapeQuerySpace = !!v;\n    return this;\n  };\n\n  return URI;\n}));\n","/**\n * This is responsible for interacting with the GAYL web service.\n *\n * How the GAYL web service works:\n * - Log in / sign up and get a device security code\n * - This code is sent in future requests, it tells the server this user has logged in and\n * can access the API.\n *\n * Each method that requires authentication will have a \"deviceSecurityCode\" as the first parameter. To get this,\n * you need to either:\n * - Log in using the extension\n * - Be already logged into GAYL.com\n *\n * To see a full list of methods and their request / response formats, you can download Postman (todo: add link to postman here.)\n *\n * @author Daniel Moffat\n *\n */\n\nvar URI = require('urijs');\nvar Request = require('./request.js');\nvar Config = require('./config.development.js');\nvar util = require('./shared/util.js');\nvar Cache = require('./cache.js');\n\n// Default options used for every request.\nvar DEFAULT_OPTIONS = {\n\theaders: {\n\t\t'Authorization': Config.apiAuthHeader()\n\t}\n};\n\n// The time this script was loaded\nvar created = util.getTimestamp();\n\n// Temporary caches for API responses.\n// These are really handy for endpoints which are called multiple times per website to reduce the amount of overall calls that are made.\nvar findStoreByUrlCache = new Cache(1000 * 60 * 3); // 3 minutes\nvar findStoreByUrlAnonymousCache = new Cache(1000 * 60 * 3); // 3 minutes\nvar findSimilarStoresCache = new Cache(60000); // 1 minute\nvar urlBlacklistCache = new Cache(1000 * 60 * 60); // 1 hour\nvar adsCache = new Cache(1000 * 60 * 60); // 1 hour\nvar serpRulesCache = new Cache(1000 * 60 * 60); // 1 hour\nvar userStateCache = new Cache(1000 * 60); // 1 minute\n\nvar GaylApiClient = {\n\t// Logs the user into the extension\n\tlogin: function(email, password) {\n\t\tvar endpoint = Config.apiBase + 'user/find';\n\t\tvar payload = {\n\t\t\temail: email,\n\t\t\tpassword: password\n\t\t};\n\t\treturn Request.post(endpoint, payload, DEFAULT_OPTIONS);\n\t},\n\n\t// Logs the user into the GAYL website\n\tcookieLogin: function(deviceSecurityCode) {\n\t\tvar endpoint = Config.apiBase + 'extension/cookieLogin';\n\t\tvar payload = { deviceSecurityCode };\n\t\treturn Request.post(endpoint, payload, DEFAULT_OPTIONS);\n\t},\n\n\t// Logs the user out of the GAYL website\n\tcookieLogout: function() {\n\t\tvar endpoint = Config.apiBase + 'extension/cookieLogout';\n\t\treturn Request.post(endpoint, {}, DEFAULT_OPTIONS);\n\t},\n\n\t// Returns the current user's state on the GAYL website\n\t// Options is an object with the following structure:\n\t// {\n\t// \t\t// Whether to retrieve a response from the cache or not.\n\t//\t\t'useCache': true\n\t// }\n\tgetState: function(options) {\n\t\toptions = options || {};\n\n\t\t// Add the time to the query param, since we don't want the browser to cache this request.\n\t\tvar endpoint = Config.apiBase + 'user/state?cb=' + util.getTimestamp();\n\n\t\tvar cachedResponse = userStateCache.get('userState');\n\t\tif(cachedResponse && options.useCache) {\n\t\t\treturn Promise.resolve(cachedResponse);\n\t\t}\n\n\t\treturn Request.get(endpoint, DEFAULT_OPTIONS).then(function(resp) {\n\t\t\tuserStateCache.set('userState', resp);\n\t\t\treturn resp;\n\t\t});\n\t},\n\n\tgetSerpRules: function() {\n\t\tvar endpoint = Config.apiBase + 'serp/rules?cb=' + util.getDayAndYear();\n/*\n\t\tvar cachedResponse = serpRulesCache.get('serpRules');\n\t\tif(cachedResponse) {\n\t\t\treturn Promise.resolve(cachedResponse);\n\t\t}\n*/\n\t\t// Add the day/year to the query param, since we want the browser to cache this request, but only for 1 day maximum, since\n\t\t// the rules might change, but they won't change often enough for this to be cached less.\n\t\treturn Request.get(endpoint, DEFAULT_OPTIONS).then(function(resp) {\n\t\t\tserpRulesCache.set('serpRules', resp.rules);\n\t\t\treturn resp.rules;\n\t\t});\n\t},\n\n\t// Lists a user's favourite stores followed by popular stores.\n\tlistUserStores: function(deviceSecurityCode) {\n\t\tconst endpoint = `${Config.apiBaseV2}user/stores`;\n\t\tconst payload = { deviceSecurityCode };\n\t\treturn Request.post(endpoint, payload, DEFAULT_OPTIONS).then(resp => {\n\t\t\treturn resp.stores;\n\t\t});\n\t},\n\n\t// List this user's popular stores\n\tlistPopularStores: function(deviceSecurityCode) {\n\t\tvar endpoint = Config.apiBase + 'store/popular?includeFavourites=true';\n\t\tvar payload = { deviceSecurityCode };\n\t\treturn Request.post(endpoint, payload, DEFAULT_OPTIONS).then(function(resp) {\n\t\t\t// Return only the field we need, otherwise client code looks weird, e.g.\n\t\t\t// listPopularStores(...).then(resp => console.log(resp.popularStores))\n\t\t\t// vs\n\t\t\t// listPopularStores(...).then(popularStores => console.log(popularStores));\n\t\t\treturn resp.popularStores;\n\t\t});\n\t},\n\n\t// List account options for the account area\n\tlistAccountOptions: function(deviceSecurityCode) {\n\t\tvar endpoint = Config.apiBase + 'user/listAccountOptions';\n\t\tvar payload = { deviceSecurityCode };\n\t\treturn Request.post(endpoint, payload, DEFAULT_OPTIONS).then(function(resp) {\n\t\t\t// Filter out app-specific account options\n\t\t\t// todo: add an additional parameter to this endpoint, to only return account options for the\n\t\t\t// extension.\n\t\t\tvar filtered = [];\n\t\t\tfor (var i = 0; i < resp.accountOptions.length; i++) {\n\t\t\t\tvar option = resp.accountOptions[i];\n\t\t\t\tif(option.name !== 'Review app') {\n\t\t\t\t\tfiltered.push(option);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn filtered;\n\t\t});\n\t},\n\n\t// Lists a user's favourite stores\n\tlistFavouriteStores: function(deviceSecurityCode) {\n\t\tvar endpoint = Config.apiBase + 'favourite/list';\n\t\tvar payload = { deviceSecurityCode };\n\t\treturn Request.post(endpoint, payload, DEFAULT_OPTIONS).then(function(resp) {\n\t\t\treturn resp.stores;\n\t\t});\n\t},\n\n\t// Add a favourite store\n\taddFavouriteStore: function(deviceSecurityCode, storeId) {\n\t\tvar endpoint = Config.apiBase + 'favourite/add';\n\t\tvar payload = { deviceSecurityCode, storeId };\n\t\treturn Request.post(endpoint, payload, DEFAULT_OPTIONS);\n\t},\n\n\t// Remove a favourite store\n\tremoveFavouriteStore: function(deviceSecurityCode, storeId) {\n\t\tvar endpoint = Config.apiBase + 'favourite/remove';\n\t\tvar payload = { deviceSecurityCode, storeId };\n\t\treturn Request.post(endpoint, payload, DEFAULT_OPTIONS);\n\t},\n\n\t// Find a store by query.\n\tfindStoreByQuery: function(deviceSecurityCode, query) {\n\t\tvar endpoint = Config.apiBase + 'store/findByQuery?includeFavourites=true';\n\t\tvar payload = { deviceSecurityCode, query };\n\t\treturn Request.post(endpoint, payload, DEFAULT_OPTIONS).then(function(resp) {\n\t\t\treturn resp.stores;\n\t\t});\n\t},\n\n\t// Find a store by URL, returns the following:\n\t// {\n\t// \t\tfound: boolean,\n\t// \t\tstandDown: boolean,\n\t// \t\tlist: [\n\t// \t\t\t..stores..\n\t// \t\t]\n\t// }\n\tfindStoreByUrl: function(deviceSecurityCode, urls) {\n\t\tvar endpoint = Config.apiBase + 'store/findByUrl';\n\t\tvar lastUrl = util.getLastItem(urls);\n\n\t\tif(!lastUrl) {\n\t\t\tconsole.warn('WARN: No URL found in the URL list.');\n\t\t\treturn Promise.reject(util.createError('no_navigated_urls'));\n\t\t}\n\n\t\t// Parse the URI so we can access the domain / host\n\t\tvar url = URI(lastUrl);\n\n\t\t// Check the cache first\n\t\tvar cachedResponse = findStoreByUrlCache.get(url.host());\n\t\tif(cachedResponse) {\n\t\t\treturn Promise.resolve(cachedResponse);\n\t\t}\n\n\t\t// Nothing found in the cache.\n\t\tvar payload = {\n\t\t\tdeviceSecurityCode,\n\t\t\turl: urls,\n\t\t\tdomain: url.domain(),\n\t\t\thost: url.host(),\n\t\t\tsearchType: 'I'\n\t\t};\n\n\t\treturn Request.post(endpoint, payload, DEFAULT_OPTIONS).then(function(resp) {\n\t\t\tfindStoreByUrlCache.set(url.host(), resp);\n\t\t\treturn resp;\n\t\t});\n\t},\n\n\t// Same as the above method, but for anonymous users only.\n\tfindStoreByUrlAnonymous: function(urls) {\n\t\tvar endpoint = Config.apiBase + 'store/findByUrlAnonymous?version=' + Config.version();\n\t\tvar lastUrl = util.getLastItem(urls);\n\n\t\tif(!lastUrl) {\n\t\t\tconsole.warn('WARN: No URL found in the URL list.');\n\t\t\treturn Promise.reject(util.createError('no_navigated_urls'));\n\t\t}\n\n\t\tvar url = URI(lastUrl);\n\n\t\t// Check the cache first\n\t\tvar cachedResponse = findStoreByUrlAnonymousCache.get(url.host());\n\t\tif(cachedResponse) {\n\t\t\treturn Promise.resolve(cachedResponse);\n\t\t}\n\n\t\t// Nothing found in the cache.\n\t\tvar payload = {\n\t\t\turl: urls,\n\t\t\tdomain: url.domain(),\n\t\t\thost: url.host(),\n\t\t\tsearchType: 'A'\n\t\t};\n\n\t\treturn Request.post(endpoint, payload, DEFAULT_OPTIONS).then(function(resp) {\n\t\t\tfindStoreByUrlAnonymousCache.set(url.host(), resp);\n\t\t\treturn resp;\n\t\t});\n\t},\n\n\t// Find similar stores to the given store.\n\tfindSimilarStores: function(deviceSecurityCode, storeId) {\n\t\tvar endpoint = Config.apiBase + 'stores/similar?includeFavourites=true';\n\t\tvar payload = { deviceSecurityCode, storeId };\n\n\t\tvar cachedResponse = findSimilarStoresCache.get(storeId);\n\t\tif(cachedResponse) {\n\t\t\treturn Promise.resolve(cachedResponse);\n\t\t}\n\n\t\treturn Request.post(endpoint, payload, DEFAULT_OPTIONS).then(function(resp) {\n\t\t\tfindSimilarStoresCache.set(storeId, resp);\n\t\t\treturn resp;\n\t\t});\n\t},\n\n\t// Retrieve the URL blacklist, which specifies URLs which should be ignored when processing\n\t// URLs.\n\tgetUrlBlacklist: function() {\n\t\tvar endpoint = Config.apiBase + 'urlBlacklist/';\n\n\t\tvar cachedResponse = urlBlacklistCache.get('blacklist');\n\t\tif(cachedResponse) {\n\t\t\treturn Promise.resolve(cachedResponse);\n\t\t}\n\n\t\treturn Request.get(endpoint, DEFAULT_OPTIONS).then(function(resp) {\n\t\t\turlBlacklistCache.set('blacklist', resp);\n\t\t\treturn resp\n\t\t});\n\t},\n\n\t// Get ads that will be displayed within the extension. These are paid-for placements from retailers\n\t// we work with.\n\tgetAds: function() {\n\t\tvar endpoint = Config.apiBase + 'urlBlacklist/';\n\n\t\tvar cachedResponse = adsCache.get('ads');\n\t\tif(cachedResponse) {\n\t\t\treturn Promise.resolve(cachedResponse);\n\t\t}\n\n\t\treturn Request.get(endpoint, DEFAULT_OPTIONS).then(function(resp) {\n\t\t\tadsCache.set('ads', resp.ads);\n\t\t\treturn resp.ads;\n\t\t});\n\t},\n\n\t// Check the given list of URLs to see if they are supported on our website. Used for search engine result pages only (SERP).\n\tcheckSerpUrls: function(urls) {\n\t\tvar endpoint = Config.gaylUrl + '/toolbar/find?version=' + Config.version();\n\t\treturn Request.post(endpoint, urls, {headers: {}});\n\t},\n\n\t// Fetches the refer a friend metadata, this includes things such as the text to be shared and the referral URL.\n\tgetReferAFriendMetaData: function() {\n\t\tvar endpoint = `${Config.apiBaseV2}refer/get-metadata`;\n\t\treturn Request.get(endpoint, DEFAULT_OPTIONS);\n\t}\n}\n\nmodule.exports = GaylApiClient;","/**\n *\tAll of the different states a store may be in.\n * \n * \t@author Daniel Moffat\n */\n\nvar StoreStatus = {\n\tTRACKING: 'TRACKING',\n\tTRACKED: 'TRACKED',\n\tBLANK: 'BLANK',\n\tNOT_SUPPORTED: 'NOT_SUPPORTED'\n};\n\nmodule.exports = StoreStatus;","/**\n * \tProvides a cross-browser way to close the Donation reminder popup window.\n *\n * \t@author Daniel Moffat\n */\n\nfunction closePopup() {\n\tif(typeof safari !== 'undefined') {\n\t\tsafari.extension.popovers[0].hide();\n\t} else {\n\t\t// In Safari, this will destroy the window, causing it to remain unresponsive until you force quit.\n\t\twindow.close();\n\t}\n}\n\nmodule.exports = closePopup;","/*!\n * URI.js - Mutating URLs\n * Second Level Domain (SLD) Support\n *\n * Version: 1.19.1\n *\n * Author: Rodney Rehm\n * Web: http://medialize.github.io/URI.js/\n *\n * Licensed under\n *   MIT License http://www.opensource.org/licenses/mit-license\n *\n */\n\n(function (root, factory) {\n  'use strict';\n  // https://github.com/umdjs/umd/blob/master/returnExports.js\n  if (typeof module === 'object' && module.exports) {\n    // Node\n    module.exports = factory();\n  } else if (typeof define === 'function' && define.amd) {\n    // AMD. Register as an anonymous module.\n    define(factory);\n  } else {\n    // Browser globals (root is window)\n    root.SecondLevelDomains = factory(root);\n  }\n}(this, function (root) {\n  'use strict';\n\n  // save current SecondLevelDomains variable, if any\n  var _SecondLevelDomains = root && root.SecondLevelDomains;\n\n  var SLD = {\n    // list of known Second Level Domains\n    // converted list of SLDs from https://github.com/gavingmiller/second-level-domains\n    // ----\n    // publicsuffix.org is more current and actually used by a couple of browsers internally.\n    // downside is it also contains domains like \"dyndns.org\" - which is fine for the security\n    // issues browser have to deal with (SOP for cookies, etc) - but is way overboard for URI.js\n    // ----\n    list: {\n      'ac':' com gov mil net org ',\n      'ae':' ac co gov mil name net org pro sch ',\n      'af':' com edu gov net org ',\n      'al':' com edu gov mil net org ',\n      'ao':' co ed gv it og pb ',\n      'ar':' com edu gob gov int mil net org tur ',\n      'at':' ac co gv or ',\n      'au':' asn com csiro edu gov id net org ',\n      'ba':' co com edu gov mil net org rs unbi unmo unsa untz unze ',\n      'bb':' biz co com edu gov info net org store tv ',\n      'bh':' biz cc com edu gov info net org ',\n      'bn':' com edu gov net org ',\n      'bo':' com edu gob gov int mil net org tv ',\n      'br':' adm adv agr am arq art ato b bio blog bmd cim cng cnt com coop ecn edu eng esp etc eti far flog fm fnd fot fst g12 ggf gov imb ind inf jor jus lel mat med mil mus net nom not ntr odo org ppg pro psc psi qsl rec slg srv tmp trd tur tv vet vlog wiki zlg ',\n      'bs':' com edu gov net org ',\n      'bz':' du et om ov rg ',\n      'ca':' ab bc mb nb nf nl ns nt nu on pe qc sk yk ',\n      'ck':' biz co edu gen gov info net org ',\n      'cn':' ac ah bj com cq edu fj gd gov gs gx gz ha hb he hi hl hn jl js jx ln mil net nm nx org qh sc sd sh sn sx tj tw xj xz yn zj ',\n      'co':' com edu gov mil net nom org ',\n      'cr':' ac c co ed fi go or sa ',\n      'cy':' ac biz com ekloges gov ltd name net org parliament press pro tm ',\n      'do':' art com edu gob gov mil net org sld web ',\n      'dz':' art asso com edu gov net org pol ',\n      'ec':' com edu fin gov info med mil net org pro ',\n      'eg':' com edu eun gov mil name net org sci ',\n      'er':' com edu gov ind mil net org rochest w ',\n      'es':' com edu gob nom org ',\n      'et':' biz com edu gov info name net org ',\n      'fj':' ac biz com info mil name net org pro ',\n      'fk':' ac co gov net nom org ',\n      'fr':' asso com f gouv nom prd presse tm ',\n      'gg':' co net org ',\n      'gh':' com edu gov mil org ',\n      'gn':' ac com gov net org ',\n      'gr':' com edu gov mil net org ',\n      'gt':' com edu gob ind mil net org ',\n      'gu':' com edu gov net org ',\n      'hk':' com edu gov idv net org ',\n      'hu':' 2000 agrar bolt casino city co erotica erotika film forum games hotel info ingatlan jogasz konyvelo lakas media news org priv reklam sex shop sport suli szex tm tozsde utazas video ',\n      'id':' ac co go mil net or sch web ',\n      'il':' ac co gov idf k12 muni net org ',\n      'in':' ac co edu ernet firm gen gov i ind mil net nic org res ',\n      'iq':' com edu gov i mil net org ',\n      'ir':' ac co dnssec gov i id net org sch ',\n      'it':' edu gov ',\n      'je':' co net org ',\n      'jo':' com edu gov mil name net org sch ',\n      'jp':' ac ad co ed go gr lg ne or ',\n      'ke':' ac co go info me mobi ne or sc ',\n      'kh':' com edu gov mil net org per ',\n      'ki':' biz com de edu gov info mob net org tel ',\n      'km':' asso com coop edu gouv k medecin mil nom notaires pharmaciens presse tm veterinaire ',\n      'kn':' edu gov net org ',\n      'kr':' ac busan chungbuk chungnam co daegu daejeon es gangwon go gwangju gyeongbuk gyeonggi gyeongnam hs incheon jeju jeonbuk jeonnam k kg mil ms ne or pe re sc seoul ulsan ',\n      'kw':' com edu gov net org ',\n      'ky':' com edu gov net org ',\n      'kz':' com edu gov mil net org ',\n      'lb':' com edu gov net org ',\n      'lk':' assn com edu gov grp hotel int ltd net ngo org sch soc web ',\n      'lr':' com edu gov net org ',\n      'lv':' asn com conf edu gov id mil net org ',\n      'ly':' com edu gov id med net org plc sch ',\n      'ma':' ac co gov m net org press ',\n      'mc':' asso tm ',\n      'me':' ac co edu gov its net org priv ',\n      'mg':' com edu gov mil nom org prd tm ',\n      'mk':' com edu gov inf name net org pro ',\n      'ml':' com edu gov net org presse ',\n      'mn':' edu gov org ',\n      'mo':' com edu gov net org ',\n      'mt':' com edu gov net org ',\n      'mv':' aero biz com coop edu gov info int mil museum name net org pro ',\n      'mw':' ac co com coop edu gov int museum net org ',\n      'mx':' com edu gob net org ',\n      'my':' com edu gov mil name net org sch ',\n      'nf':' arts com firm info net other per rec store web ',\n      'ng':' biz com edu gov mil mobi name net org sch ',\n      'ni':' ac co com edu gob mil net nom org ',\n      'np':' com edu gov mil net org ',\n      'nr':' biz com edu gov info net org ',\n      'om':' ac biz co com edu gov med mil museum net org pro sch ',\n      'pe':' com edu gob mil net nom org sld ',\n      'ph':' com edu gov i mil net ngo org ',\n      'pk':' biz com edu fam gob gok gon gop gos gov net org web ',\n      'pl':' art bialystok biz com edu gda gdansk gorzow gov info katowice krakow lodz lublin mil net ngo olsztyn org poznan pwr radom slupsk szczecin torun warszawa waw wroc wroclaw zgora ',\n      'pr':' ac biz com edu est gov info isla name net org pro prof ',\n      'ps':' com edu gov net org plo sec ',\n      'pw':' belau co ed go ne or ',\n      'ro':' arts com firm info nom nt org rec store tm www ',\n      'rs':' ac co edu gov in org ',\n      'sb':' com edu gov net org ',\n      'sc':' com edu gov net org ',\n      'sh':' co com edu gov net nom org ',\n      'sl':' com edu gov net org ',\n      'st':' co com consulado edu embaixada gov mil net org principe saotome store ',\n      'sv':' com edu gob org red ',\n      'sz':' ac co org ',\n      'tr':' av bbs bel biz com dr edu gen gov info k12 name net org pol tel tsk tv web ',\n      'tt':' aero biz cat co com coop edu gov info int jobs mil mobi museum name net org pro tel travel ',\n      'tw':' club com ebiz edu game gov idv mil net org ',\n      'mu':' ac co com gov net or org ',\n      'mz':' ac co edu gov org ',\n      'na':' co com ',\n      'nz':' ac co cri geek gen govt health iwi maori mil net org parliament school ',\n      'pa':' abo ac com edu gob ing med net nom org sld ',\n      'pt':' com edu gov int net nome org publ ',\n      'py':' com edu gov mil net org ',\n      'qa':' com edu gov mil net org ',\n      're':' asso com nom ',\n      'ru':' ac adygeya altai amur arkhangelsk astrakhan bashkiria belgorod bir bryansk buryatia cbg chel chelyabinsk chita chukotka chuvashia com dagestan e-burg edu gov grozny int irkutsk ivanovo izhevsk jar joshkar-ola kalmykia kaluga kamchatka karelia kazan kchr kemerovo khabarovsk khakassia khv kirov koenig komi kostroma kranoyarsk kuban kurgan kursk lipetsk magadan mari mari-el marine mil mordovia mosreg msk murmansk nalchik net nnov nov novosibirsk nsk omsk orenburg org oryol penza perm pp pskov ptz rnd ryazan sakhalin samara saratov simbirsk smolensk spb stavropol stv surgut tambov tatarstan tom tomsk tsaritsyn tsk tula tuva tver tyumen udm udmurtia ulan-ude vladikavkaz vladimir vladivostok volgograd vologda voronezh vrn vyatka yakutia yamal yekaterinburg yuzhno-sakhalinsk ',\n      'rw':' ac co com edu gouv gov int mil net ',\n      'sa':' com edu gov med net org pub sch ',\n      'sd':' com edu gov info med net org tv ',\n      'se':' a ac b bd c d e f g h i k l m n o org p parti pp press r s t tm u w x y z ',\n      'sg':' com edu gov idn net org per ',\n      'sn':' art com edu gouv org perso univ ',\n      'sy':' com edu gov mil net news org ',\n      'th':' ac co go in mi net or ',\n      'tj':' ac biz co com edu go gov info int mil name net nic org test web ',\n      'tn':' agrinet com defense edunet ens fin gov ind info intl mincom nat net org perso rnrt rns rnu tourism ',\n      'tz':' ac co go ne or ',\n      'ua':' biz cherkassy chernigov chernovtsy ck cn co com crimea cv dn dnepropetrovsk donetsk dp edu gov if in ivano-frankivsk kh kharkov kherson khmelnitskiy kiev kirovograd km kr ks kv lg lugansk lutsk lviv me mk net nikolaev od odessa org pl poltava pp rovno rv sebastopol sumy te ternopil uzhgorod vinnica vn zaporizhzhe zhitomir zp zt ',\n      'ug':' ac co go ne or org sc ',\n      'uk':' ac bl british-library co cym gov govt icnet jet lea ltd me mil mod national-library-scotland nel net nhs nic nls org orgn parliament plc police sch scot soc ',\n      'us':' dni fed isa kids nsn ',\n      'uy':' com edu gub mil net org ',\n      've':' co com edu gob info mil net org web ',\n      'vi':' co com k12 net org ',\n      'vn':' ac biz com edu gov health info int name net org pro ',\n      'ye':' co com gov ltd me net org plc ',\n      'yu':' ac co edu gov org ',\n      'za':' ac agric alt bourse city co cybernet db edu gov grondar iaccess imt inca landesign law mil net ngo nis nom olivetti org pix school tm web ',\n      'zm':' ac co com edu gov net org sch ',\n      // https://en.wikipedia.org/wiki/CentralNic#Second-level_domains\n      'com': 'ar br cn de eu gb gr hu jpn kr no qc ru sa se uk us uy za ',\n      'net': 'gb jp se uk ',\n      'org': 'ae',\n      'de': 'com '\n    },\n    // gorhill 2013-10-25: Using indexOf() instead Regexp(). Significant boost\n    // in both performance and memory footprint. No initialization required.\n    // http://jsperf.com/uri-js-sld-regex-vs-binary-search/4\n    // Following methods use lastIndexOf() rather than array.split() in order\n    // to avoid any memory allocations.\n    has: function(domain) {\n      var tldOffset = domain.lastIndexOf('.');\n      if (tldOffset <= 0 || tldOffset >= (domain.length-1)) {\n        return false;\n      }\n      var sldOffset = domain.lastIndexOf('.', tldOffset-1);\n      if (sldOffset <= 0 || sldOffset >= (tldOffset-1)) {\n        return false;\n      }\n      var sldList = SLD.list[domain.slice(tldOffset+1)];\n      if (!sldList) {\n        return false;\n      }\n      return sldList.indexOf(' ' + domain.slice(sldOffset+1, tldOffset) + ' ') >= 0;\n    },\n    is: function(domain) {\n      var tldOffset = domain.lastIndexOf('.');\n      if (tldOffset <= 0 || tldOffset >= (domain.length-1)) {\n        return false;\n      }\n      var sldOffset = domain.lastIndexOf('.', tldOffset-1);\n      if (sldOffset >= 0) {\n        return false;\n      }\n      var sldList = SLD.list[domain.slice(tldOffset+1)];\n      if (!sldList) {\n        return false;\n      }\n      return sldList.indexOf(' ' + domain.slice(0, tldOffset) + ' ') >= 0;\n    },\n    get: function(domain) {\n      var tldOffset = domain.lastIndexOf('.');\n      if (tldOffset <= 0 || tldOffset >= (domain.length-1)) {\n        return null;\n      }\n      var sldOffset = domain.lastIndexOf('.', tldOffset-1);\n      if (sldOffset <= 0 || sldOffset >= (tldOffset-1)) {\n        return null;\n      }\n      var sldList = SLD.list[domain.slice(tldOffset+1)];\n      if (!sldList) {\n        return null;\n      }\n      if (sldList.indexOf(' ' + domain.slice(sldOffset+1, tldOffset) + ' ') < 0) {\n        return null;\n      }\n      return domain.slice(sldOffset+1);\n    },\n    noConflict: function(){\n      if (root.SecondLevelDomains === this) {\n        root.SecondLevelDomains = _SecondLevelDomains;\n      }\n      return this;\n    }\n  };\n\n  return SLD;\n}));\n","/*!\n * URI.js - Mutating URLs\n * IPv6 Support\n *\n * Version: 1.19.1\n *\n * Author: Rodney Rehm\n * Web: http://medialize.github.io/URI.js/\n *\n * Licensed under\n *   MIT License http://www.opensource.org/licenses/mit-license\n *\n */\n\n(function (root, factory) {\n  'use strict';\n  // https://github.com/umdjs/umd/blob/master/returnExports.js\n  if (typeof module === 'object' && module.exports) {\n    // Node\n    module.exports = factory();\n  } else if (typeof define === 'function' && define.amd) {\n    // AMD. Register as an anonymous module.\n    define(factory);\n  } else {\n    // Browser globals (root is window)\n    root.IPv6 = factory(root);\n  }\n}(this, function (root) {\n  'use strict';\n\n  /*\n  var _in = \"fe80:0000:0000:0000:0204:61ff:fe9d:f156\";\n  var _out = IPv6.best(_in);\n  var _expected = \"fe80::204:61ff:fe9d:f156\";\n\n  console.log(_in, _out, _expected, _out === _expected);\n  */\n\n  // save current IPv6 variable, if any\n  var _IPv6 = root && root.IPv6;\n\n  function bestPresentation(address) {\n    // based on:\n    // Javascript to test an IPv6 address for proper format, and to\n    // present the \"best text representation\" according to IETF Draft RFC at\n    // http://tools.ietf.org/html/draft-ietf-6man-text-addr-representation-04\n    // 8 Feb 2010 Rich Brown, Dartware, LLC\n    // Please feel free to use this code as long as you provide a link to\n    // http://www.intermapper.com\n    // http://intermapper.com/support/tools/IPV6-Validator.aspx\n    // http://download.dartware.com/thirdparty/ipv6validator.js\n\n    var _address = address.toLowerCase();\n    var segments = _address.split(':');\n    var length = segments.length;\n    var total = 8;\n\n    // trim colons (:: or ::a:b:c… or …a:b:c::)\n    if (segments[0] === '' && segments[1] === '' && segments[2] === '') {\n      // must have been ::\n      // remove first two items\n      segments.shift();\n      segments.shift();\n    } else if (segments[0] === '' && segments[1] === '') {\n      // must have been ::xxxx\n      // remove the first item\n      segments.shift();\n    } else if (segments[length - 1] === '' && segments[length - 2] === '') {\n      // must have been xxxx::\n      segments.pop();\n    }\n\n    length = segments.length;\n\n    // adjust total segments for IPv4 trailer\n    if (segments[length - 1].indexOf('.') !== -1) {\n      // found a \".\" which means IPv4\n      total = 7;\n    }\n\n    // fill empty segments them with \"0000\"\n    var pos;\n    for (pos = 0; pos < length; pos++) {\n      if (segments[pos] === '') {\n        break;\n      }\n    }\n\n    if (pos < total) {\n      segments.splice(pos, 1, '0000');\n      while (segments.length < total) {\n        segments.splice(pos, 0, '0000');\n      }\n    }\n\n    // strip leading zeros\n    var _segments;\n    for (var i = 0; i < total; i++) {\n      _segments = segments[i].split('');\n      for (var j = 0; j < 3 ; j++) {\n        if (_segments[0] === '0' && _segments.length > 1) {\n          _segments.splice(0,1);\n        } else {\n          break;\n        }\n      }\n\n      segments[i] = _segments.join('');\n    }\n\n    // find longest sequence of zeroes and coalesce them into one segment\n    var best = -1;\n    var _best = 0;\n    var _current = 0;\n    var current = -1;\n    var inzeroes = false;\n    // i; already declared\n\n    for (i = 0; i < total; i++) {\n      if (inzeroes) {\n        if (segments[i] === '0') {\n          _current += 1;\n        } else {\n          inzeroes = false;\n          if (_current > _best) {\n            best = current;\n            _best = _current;\n          }\n        }\n      } else {\n        if (segments[i] === '0') {\n          inzeroes = true;\n          current = i;\n          _current = 1;\n        }\n      }\n    }\n\n    if (_current > _best) {\n      best = current;\n      _best = _current;\n    }\n\n    if (_best > 1) {\n      segments.splice(best, _best, '');\n    }\n\n    length = segments.length;\n\n    // assemble remaining segments\n    var result = '';\n    if (segments[0] === '')  {\n      result = ':';\n    }\n\n    for (i = 0; i < length; i++) {\n      result += segments[i];\n      if (i === length - 1) {\n        break;\n      }\n\n      result += ':';\n    }\n\n    if (segments[length - 1] === '') {\n      result += ':';\n    }\n\n    return result;\n  }\n\n  function noConflict() {\n    /*jshint validthis: true */\n    if (root.IPv6 === this) {\n      root.IPv6 = _IPv6;\n    }\n\n    return this;\n  }\n\n  return {\n    best: bestPresentation,\n    noConflict: noConflict\n  };\n}));\n","/*! https://mths.be/punycode v1.4.0 by @mathias */\n;(function(root) {\n\n\t/** Detect free variables */\n\tvar freeExports = typeof exports == 'object' && exports &&\n\t\t!exports.nodeType && exports;\n\tvar freeModule = typeof module == 'object' && module &&\n\t\t!module.nodeType && module;\n\tvar freeGlobal = typeof global == 'object' && global;\n\tif (\n\t\tfreeGlobal.global === freeGlobal ||\n\t\tfreeGlobal.window === freeGlobal ||\n\t\tfreeGlobal.self === freeGlobal\n\t) {\n\t\troot = freeGlobal;\n\t}\n\n\t/**\n\t * The `punycode` object.\n\t * @name punycode\n\t * @type Object\n\t */\n\tvar punycode,\n\n\t/** Highest positive signed 32-bit float value */\n\tmaxInt = 2147483647, // aka. 0x7FFFFFFF or 2^31-1\n\n\t/** Bootstring parameters */\n\tbase = 36,\n\ttMin = 1,\n\ttMax = 26,\n\tskew = 38,\n\tdamp = 700,\n\tinitialBias = 72,\n\tinitialN = 128, // 0x80\n\tdelimiter = '-', // '\\x2D'\n\n\t/** Regular expressions */\n\tregexPunycode = /^xn--/,\n\tregexNonASCII = /[^\\x20-\\x7E]/, // unprintable ASCII chars + non-ASCII chars\n\tregexSeparators = /[\\x2E\\u3002\\uFF0E\\uFF61]/g, // RFC 3490 separators\n\n\t/** Error messages */\n\terrors = {\n\t\t'overflow': 'Overflow: input needs wider integers to process',\n\t\t'not-basic': 'Illegal input >= 0x80 (not a basic code point)',\n\t\t'invalid-input': 'Invalid input'\n\t},\n\n\t/** Convenience shortcuts */\n\tbaseMinusTMin = base - tMin,\n\tfloor = Math.floor,\n\tstringFromCharCode = String.fromCharCode,\n\n\t/** Temporary variable */\n\tkey;\n\n\t/*--------------------------------------------------------------------------*/\n\n\t/**\n\t * A generic error utility function.\n\t * @private\n\t * @param {String} type The error type.\n\t * @returns {Error} Throws a `RangeError` with the applicable error message.\n\t */\n\tfunction error(type) {\n\t\tthrow new RangeError(errors[type]);\n\t}\n\n\t/**\n\t * A generic `Array#map` utility function.\n\t * @private\n\t * @param {Array} array The array to iterate over.\n\t * @param {Function} callback The function that gets called for every array\n\t * item.\n\t * @returns {Array} A new array of values returned by the callback function.\n\t */\n\tfunction map(array, fn) {\n\t\tvar length = array.length;\n\t\tvar result = [];\n\t\twhile (length--) {\n\t\t\tresult[length] = fn(array[length]);\n\t\t}\n\t\treturn result;\n\t}\n\n\t/**\n\t * A simple `Array#map`-like wrapper to work with domain name strings or email\n\t * addresses.\n\t * @private\n\t * @param {String} domain The domain name or email address.\n\t * @param {Function} callback The function that gets called for every\n\t * character.\n\t * @returns {Array} A new string of characters returned by the callback\n\t * function.\n\t */\n\tfunction mapDomain(string, fn) {\n\t\tvar parts = string.split('@');\n\t\tvar result = '';\n\t\tif (parts.length > 1) {\n\t\t\t// In email addresses, only the domain name should be punycoded. Leave\n\t\t\t// the local part (i.e. everything up to `@`) intact.\n\t\t\tresult = parts[0] + '@';\n\t\t\tstring = parts[1];\n\t\t}\n\t\t// Avoid `split(regex)` for IE8 compatibility. See #17.\n\t\tstring = string.replace(regexSeparators, '\\x2E');\n\t\tvar labels = string.split('.');\n\t\tvar encoded = map(labels, fn).join('.');\n\t\treturn result + encoded;\n\t}\n\n\t/**\n\t * Creates an array containing the numeric code points of each Unicode\n\t * character in the string. While JavaScript uses UCS-2 internally,\n\t * this function will convert a pair of surrogate halves (each of which\n\t * UCS-2 exposes as separate characters) into a single code point,\n\t * matching UTF-16.\n\t * @see `punycode.ucs2.encode`\n\t * @see <https://mathiasbynens.be/notes/javascript-encoding>\n\t * @memberOf punycode.ucs2\n\t * @name decode\n\t * @param {String} string The Unicode input string (UCS-2).\n\t * @returns {Array} The new array of code points.\n\t */\n\tfunction ucs2decode(string) {\n\t\tvar output = [],\n\t\t    counter = 0,\n\t\t    length = string.length,\n\t\t    value,\n\t\t    extra;\n\t\twhile (counter < length) {\n\t\t\tvalue = string.charCodeAt(counter++);\n\t\t\tif (value >= 0xD800 && value <= 0xDBFF && counter < length) {\n\t\t\t\t// high surrogate, and there is a next character\n\t\t\t\textra = string.charCodeAt(counter++);\n\t\t\t\tif ((extra & 0xFC00) == 0xDC00) { // low surrogate\n\t\t\t\t\toutput.push(((value & 0x3FF) << 10) + (extra & 0x3FF) + 0x10000);\n\t\t\t\t} else {\n\t\t\t\t\t// unmatched surrogate; only append this code unit, in case the next\n\t\t\t\t\t// code unit is the high surrogate of a surrogate pair\n\t\t\t\t\toutput.push(value);\n\t\t\t\t\tcounter--;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\toutput.push(value);\n\t\t\t}\n\t\t}\n\t\treturn output;\n\t}\n\n\t/**\n\t * Creates a string based on an array of numeric code points.\n\t * @see `punycode.ucs2.decode`\n\t * @memberOf punycode.ucs2\n\t * @name encode\n\t * @param {Array} codePoints The array of numeric code points.\n\t * @returns {String} The new Unicode string (UCS-2).\n\t */\n\tfunction ucs2encode(array) {\n\t\treturn map(array, function(value) {\n\t\t\tvar output = '';\n\t\t\tif (value > 0xFFFF) {\n\t\t\t\tvalue -= 0x10000;\n\t\t\t\toutput += stringFromCharCode(value >>> 10 & 0x3FF | 0xD800);\n\t\t\t\tvalue = 0xDC00 | value & 0x3FF;\n\t\t\t}\n\t\t\toutput += stringFromCharCode(value);\n\t\t\treturn output;\n\t\t}).join('');\n\t}\n\n\t/**\n\t * Converts a basic code point into a digit/integer.\n\t * @see `digitToBasic()`\n\t * @private\n\t * @param {Number} codePoint The basic numeric code point value.\n\t * @returns {Number} The numeric value of a basic code point (for use in\n\t * representing integers) in the range `0` to `base - 1`, or `base` if\n\t * the code point does not represent a value.\n\t */\n\tfunction basicToDigit(codePoint) {\n\t\tif (codePoint - 48 < 10) {\n\t\t\treturn codePoint - 22;\n\t\t}\n\t\tif (codePoint - 65 < 26) {\n\t\t\treturn codePoint - 65;\n\t\t}\n\t\tif (codePoint - 97 < 26) {\n\t\t\treturn codePoint - 97;\n\t\t}\n\t\treturn base;\n\t}\n\n\t/**\n\t * Converts a digit/integer into a basic code point.\n\t * @see `basicToDigit()`\n\t * @private\n\t * @param {Number} digit The numeric value of a basic code point.\n\t * @returns {Number} The basic code point whose value (when used for\n\t * representing integers) is `digit`, which needs to be in the range\n\t * `0` to `base - 1`. If `flag` is non-zero, the uppercase form is\n\t * used; else, the lowercase form is used. The behavior is undefined\n\t * if `flag` is non-zero and `digit` has no uppercase form.\n\t */\n\tfunction digitToBasic(digit, flag) {\n\t\t//  0..25 map to ASCII a..z or A..Z\n\t\t// 26..35 map to ASCII 0..9\n\t\treturn digit + 22 + 75 * (digit < 26) - ((flag != 0) << 5);\n\t}\n\n\t/**\n\t * Bias adaptation function as per section 3.4 of RFC 3492.\n\t * https://tools.ietf.org/html/rfc3492#section-3.4\n\t * @private\n\t */\n\tfunction adapt(delta, numPoints, firstTime) {\n\t\tvar k = 0;\n\t\tdelta = firstTime ? floor(delta / damp) : delta >> 1;\n\t\tdelta += floor(delta / numPoints);\n\t\tfor (/* no initialization */; delta > baseMinusTMin * tMax >> 1; k += base) {\n\t\t\tdelta = floor(delta / baseMinusTMin);\n\t\t}\n\t\treturn floor(k + (baseMinusTMin + 1) * delta / (delta + skew));\n\t}\n\n\t/**\n\t * Converts a Punycode string of ASCII-only symbols to a string of Unicode\n\t * symbols.\n\t * @memberOf punycode\n\t * @param {String} input The Punycode string of ASCII-only symbols.\n\t * @returns {String} The resulting string of Unicode symbols.\n\t */\n\tfunction decode(input) {\n\t\t// Don't use UCS-2\n\t\tvar output = [],\n\t\t    inputLength = input.length,\n\t\t    out,\n\t\t    i = 0,\n\t\t    n = initialN,\n\t\t    bias = initialBias,\n\t\t    basic,\n\t\t    j,\n\t\t    index,\n\t\t    oldi,\n\t\t    w,\n\t\t    k,\n\t\t    digit,\n\t\t    t,\n\t\t    /** Cached calculation results */\n\t\t    baseMinusT;\n\n\t\t// Handle the basic code points: let `basic` be the number of input code\n\t\t// points before the last delimiter, or `0` if there is none, then copy\n\t\t// the first basic code points to the output.\n\n\t\tbasic = input.lastIndexOf(delimiter);\n\t\tif (basic < 0) {\n\t\t\tbasic = 0;\n\t\t}\n\n\t\tfor (j = 0; j < basic; ++j) {\n\t\t\t// if it's not a basic code point\n\t\t\tif (input.charCodeAt(j) >= 0x80) {\n\t\t\t\terror('not-basic');\n\t\t\t}\n\t\t\toutput.push(input.charCodeAt(j));\n\t\t}\n\n\t\t// Main decoding loop: start just after the last delimiter if any basic code\n\t\t// points were copied; start at the beginning otherwise.\n\n\t\tfor (index = basic > 0 ? basic + 1 : 0; index < inputLength; /* no final expression */) {\n\n\t\t\t// `index` is the index of the next character to be consumed.\n\t\t\t// Decode a generalized variable-length integer into `delta`,\n\t\t\t// which gets added to `i`. The overflow checking is easier\n\t\t\t// if we increase `i` as we go, then subtract off its starting\n\t\t\t// value at the end to obtain `delta`.\n\t\t\tfor (oldi = i, w = 1, k = base; /* no condition */; k += base) {\n\n\t\t\t\tif (index >= inputLength) {\n\t\t\t\t\terror('invalid-input');\n\t\t\t\t}\n\n\t\t\t\tdigit = basicToDigit(input.charCodeAt(index++));\n\n\t\t\t\tif (digit >= base || digit > floor((maxInt - i) / w)) {\n\t\t\t\t\terror('overflow');\n\t\t\t\t}\n\n\t\t\t\ti += digit * w;\n\t\t\t\tt = k <= bias ? tMin : (k >= bias + tMax ? tMax : k - bias);\n\n\t\t\t\tif (digit < t) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tbaseMinusT = base - t;\n\t\t\t\tif (w > floor(maxInt / baseMinusT)) {\n\t\t\t\t\terror('overflow');\n\t\t\t\t}\n\n\t\t\t\tw *= baseMinusT;\n\n\t\t\t}\n\n\t\t\tout = output.length + 1;\n\t\t\tbias = adapt(i - oldi, out, oldi == 0);\n\n\t\t\t// `i` was supposed to wrap around from `out` to `0`,\n\t\t\t// incrementing `n` each time, so we'll fix that now:\n\t\t\tif (floor(i / out) > maxInt - n) {\n\t\t\t\terror('overflow');\n\t\t\t}\n\n\t\t\tn += floor(i / out);\n\t\t\ti %= out;\n\n\t\t\t// Insert `n` at position `i` of the output\n\t\t\toutput.splice(i++, 0, n);\n\n\t\t}\n\n\t\treturn ucs2encode(output);\n\t}\n\n\t/**\n\t * Converts a string of Unicode symbols (e.g. a domain name label) to a\n\t * Punycode string of ASCII-only symbols.\n\t * @memberOf punycode\n\t * @param {String} input The string of Unicode symbols.\n\t * @returns {String} The resulting Punycode string of ASCII-only symbols.\n\t */\n\tfunction encode(input) {\n\t\tvar n,\n\t\t    delta,\n\t\t    handledCPCount,\n\t\t    basicLength,\n\t\t    bias,\n\t\t    j,\n\t\t    m,\n\t\t    q,\n\t\t    k,\n\t\t    t,\n\t\t    currentValue,\n\t\t    output = [],\n\t\t    /** `inputLength` will hold the number of code points in `input`. */\n\t\t    inputLength,\n\t\t    /** Cached calculation results */\n\t\t    handledCPCountPlusOne,\n\t\t    baseMinusT,\n\t\t    qMinusT;\n\n\t\t// Convert the input in UCS-2 to Unicode\n\t\tinput = ucs2decode(input);\n\n\t\t// Cache the length\n\t\tinputLength = input.length;\n\n\t\t// Initialize the state\n\t\tn = initialN;\n\t\tdelta = 0;\n\t\tbias = initialBias;\n\n\t\t// Handle the basic code points\n\t\tfor (j = 0; j < inputLength; ++j) {\n\t\t\tcurrentValue = input[j];\n\t\t\tif (currentValue < 0x80) {\n\t\t\t\toutput.push(stringFromCharCode(currentValue));\n\t\t\t}\n\t\t}\n\n\t\thandledCPCount = basicLength = output.length;\n\n\t\t// `handledCPCount` is the number of code points that have been handled;\n\t\t// `basicLength` is the number of basic code points.\n\n\t\t// Finish the basic string - if it is not empty - with a delimiter\n\t\tif (basicLength) {\n\t\t\toutput.push(delimiter);\n\t\t}\n\n\t\t// Main encoding loop:\n\t\twhile (handledCPCount < inputLength) {\n\n\t\t\t// All non-basic code points < n have been handled already. Find the next\n\t\t\t// larger one:\n\t\t\tfor (m = maxInt, j = 0; j < inputLength; ++j) {\n\t\t\t\tcurrentValue = input[j];\n\t\t\t\tif (currentValue >= n && currentValue < m) {\n\t\t\t\t\tm = currentValue;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Increase `delta` enough to advance the decoder's <n,i> state to <m,0>,\n\t\t\t// but guard against overflow\n\t\t\thandledCPCountPlusOne = handledCPCount + 1;\n\t\t\tif (m - n > floor((maxInt - delta) / handledCPCountPlusOne)) {\n\t\t\t\terror('overflow');\n\t\t\t}\n\n\t\t\tdelta += (m - n) * handledCPCountPlusOne;\n\t\t\tn = m;\n\n\t\t\tfor (j = 0; j < inputLength; ++j) {\n\t\t\t\tcurrentValue = input[j];\n\n\t\t\t\tif (currentValue < n && ++delta > maxInt) {\n\t\t\t\t\terror('overflow');\n\t\t\t\t}\n\n\t\t\t\tif (currentValue == n) {\n\t\t\t\t\t// Represent delta as a generalized variable-length integer\n\t\t\t\t\tfor (q = delta, k = base; /* no condition */; k += base) {\n\t\t\t\t\t\tt = k <= bias ? tMin : (k >= bias + tMax ? tMax : k - bias);\n\t\t\t\t\t\tif (q < t) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tqMinusT = q - t;\n\t\t\t\t\t\tbaseMinusT = base - t;\n\t\t\t\t\t\toutput.push(\n\t\t\t\t\t\t\tstringFromCharCode(digitToBasic(t + qMinusT % baseMinusT, 0))\n\t\t\t\t\t\t);\n\t\t\t\t\t\tq = floor(qMinusT / baseMinusT);\n\t\t\t\t\t}\n\n\t\t\t\t\toutput.push(stringFromCharCode(digitToBasic(q, 0)));\n\t\t\t\t\tbias = adapt(delta, handledCPCountPlusOne, handledCPCount == basicLength);\n\t\t\t\t\tdelta = 0;\n\t\t\t\t\t++handledCPCount;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t++delta;\n\t\t\t++n;\n\n\t\t}\n\t\treturn output.join('');\n\t}\n\n\t/**\n\t * Converts a Punycode string representing a domain name or an email address\n\t * to Unicode. Only the Punycoded parts of the input will be converted, i.e.\n\t * it doesn't matter if you call it on a string that has already been\n\t * converted to Unicode.\n\t * @memberOf punycode\n\t * @param {String} input The Punycoded domain name or email address to\n\t * convert to Unicode.\n\t * @returns {String} The Unicode representation of the given Punycode\n\t * string.\n\t */\n\tfunction toUnicode(input) {\n\t\treturn mapDomain(input, function(string) {\n\t\t\treturn regexPunycode.test(string)\n\t\t\t\t? decode(string.slice(4).toLowerCase())\n\t\t\t\t: string;\n\t\t});\n\t}\n\n\t/**\n\t * Converts a Unicode string representing a domain name or an email address to\n\t * Punycode. Only the non-ASCII parts of the domain name will be converted,\n\t * i.e. it doesn't matter if you call it with a domain that's already in\n\t * ASCII.\n\t * @memberOf punycode\n\t * @param {String} input The domain name or email address to convert, as a\n\t * Unicode string.\n\t * @returns {String} The Punycode representation of the given domain name or\n\t * email address.\n\t */\n\tfunction toASCII(input) {\n\t\treturn mapDomain(input, function(string) {\n\t\t\treturn regexNonASCII.test(string)\n\t\t\t\t? 'xn--' + encode(string)\n\t\t\t\t: string;\n\t\t});\n\t}\n\n\t/*--------------------------------------------------------------------------*/\n\n\t/** Define the public API */\n\tpunycode = {\n\t\t/**\n\t\t * A string representing the current Punycode.js version number.\n\t\t * @memberOf punycode\n\t\t * @type String\n\t\t */\n\t\t'version': '1.3.2',\n\t\t/**\n\t\t * An object of methods to convert from JavaScript's internal character\n\t\t * representation (UCS-2) to Unicode code points, and back.\n\t\t * @see <https://mathiasbynens.be/notes/javascript-encoding>\n\t\t * @memberOf punycode\n\t\t * @type Object\n\t\t */\n\t\t'ucs2': {\n\t\t\t'decode': ucs2decode,\n\t\t\t'encode': ucs2encode\n\t\t},\n\t\t'decode': decode,\n\t\t'encode': encode,\n\t\t'toASCII': toASCII,\n\t\t'toUnicode': toUnicode\n\t};\n\n\t/** Expose `punycode` */\n\t// Some AMD build optimizers, like r.js, check for specific condition patterns\n\t// like the following:\n\tif (\n\t\ttypeof define == 'function' &&\n\t\ttypeof define.amd == 'object' &&\n\t\tdefine.amd\n\t) {\n\t\tdefine('punycode', function() {\n\t\t\treturn punycode;\n\t\t});\n\t} else if (freeExports && freeModule) {\n\t\tif (module.exports == freeExports) {\n\t\t\t// in Node.js, io.js, or RingoJS v0.8.0+\n\t\t\tfreeModule.exports = punycode;\n\t\t} else {\n\t\t\t// in Narwhal or RingoJS v0.7.0-\n\t\t\tfor (key in punycode) {\n\t\t\t\tpunycode.hasOwnProperty(key) && (freeExports[key] = punycode[key]);\n\t\t\t}\n\t\t}\n\t} else {\n\t\t// in Rhino or a web browser\n\t\troot.punycode = punycode;\n\t}\n\n}(this));\n","/**\n * \tWebExtensions storage API polyfill.\n *\n * \t@author Daniel Moffat\n */\n\nvar isArray = require('../shared/util.js').isArray;\n\nvar storage;\n\n// Firefox / Chrome\nif('undefined' !== typeof chrome && chrome.storage) {\n\tstorage = chrome.storage;\n}\n\n// Microsoft Edge\nif('undefined' !== typeof browser && browser.storage) {\n\tstorage = browser.storage;\n}\n\nmodule.exports = storage;","/**\n * \tWebExtensions permissions API polyfill.\n *\n * \t@author Daniel Moffat\n */\n\nvar permissions;\n\n// Firefox / Chrome\nif('undefined' !== typeof chrome && chrome.permissions) {\n\tpermissions = chrome.permissions;\n}\n\n// Safari + other old versions of Firefox (<55) which don't support this API yet.\nif(!permissions) {\n\tpermissions = {\n\t\tcontains: function(permissionsToCheck, callback) {\n\t\t\t// Assume we always have permission, otherwise the extension would incorrectly tell the user to change their settings.\n\t\t\tconsole.log('Using permissions#contains polyfill.');\n\t\t\tcallback(true);\n\t\t}\n\t}\n}\n\nmodule.exports = permissions;","/**\n * \tWebExtensions API polyfill(s).\n *\n *\tThese basically normalise the behaviour of WebExtensions APIs across all browsers.\n *\n * \tThey can be require'd and will \"just work\" on all supported browsers, no need to worry about cross-browser\n * \tcompatibility. You can either import the specific APIs you need, or the whole lot at once by including this file.\n *\n *  Note: This only polyfills methods / properties that are actually used by the extension, not all of them.\n */\nmodule.exports = {\n\tbrowserAction: require('./browser-action.js'),\n\tcookies: require('./cookies.js'),\n\ttabs: require('./tabs.js'),\n\tpermissions: require('./permissions.js'),\n\truntime: require('./runtime.js'),\n\tstorage: require('./storage.js'),\n\twebRequest: require('./web-request.js'),\n\twebNavigation: require('./web-navigation.js'),\n\twindows: require(\"./windows.js\")\n};","/**\n *\tBrowserTabs automatically discovers, and keeps track of the browser tabs that are currently open,\n *\tas well as keeping the store state for each tab.\n *\n *  It is not completely independent, and is manipulated from extension-core.js when different browser events happen (i.e window focused change,\n *  new tab opened, etc.).\n *\n * \tNote: the state is completely lost when the background page is reloaded, since this state is only stored in\n * \tmemory and not in persistent storage.\n *\n *  todo: Refactor this to be self-contained (e.g. containing all the tab event handlers). The only reason it doesn't already is because it needs\n *  to call updateIcon when the tab is being switched, so that would need to be reworked too.\n *\n * \t@author Daniel Moffat\n */\nvar Config = require('./config.development.js');\nvar NavigationTracker = require('./navigation-tracker.js');\nvar StoreStatus = require('./shared/store-status.js');\nvar isUndefined = require('./shared/util.js').isUndefined;\nvar tabs = require('./web-ext/tabs.js');\n\nfunction BrowserTabs() {\n\t// Stores a reference to the currently active tab\n\tthis.activeTab = {};\n\n\t// Map of tabId => BrowserTab\n\tthis.tabs = new Map();\n\n\t// Discover all tabs in all windows and add them to our internal map.\n\tthis.discoverAllTabs()\n\t\t.then(this.addTabs.bind(this));\n}\n\n/**\n * Finds all tabs in all windows.\n * Returns a promise which contains the list of tabs that were found, or an empty list if none were.\n */\nBrowserTabs.prototype.discoverAllTabs = function() {\n\tconsole.log('Discovering tabs..')\n\tvar self = this;\n\treturn tabs.customQuery({}).then(function(tabs) {\n\t\t// Handle an odd edge case where tabs is undefined, according to the docs this should never happen.\n\t\ttabs = tabs || [];\n\t\tconsole.log('Discovered', tabs.length, 'tabs.');\n\t\ttabs.forEach(function(tab) {\n\t\t\tconsole.log(`- Tab ID: ${tab.id} (window:${tab.windowId})`);\n\t\t});\n\t\treturn tabs;\n\t});\n};\n\n/**\n * Given a list of tabs, will add them to the internal map of tabs.\n */\nBrowserTabs.prototype.addTabs = function(tabs) {\n\tvar tabs = tabs || [];\n\tvar self = this;\n\ttabs.forEach(function(tab){\n\t\t// Add the tab\n\t\tself.add(tab.id);\n\n\t\t// Set the currently active tab.\n\t\tif(tab.active) {\n\t\t\tself.setActiveTab(tab.id);\n\t\t}\n\t});\n};\n\n/**\n * Sets the active tab to the given tab ID.\n *\n * @param tabId The tab ID to set to active. When -1, it means the window that was switched to didn't contain any active tabs (e.g. In a devtools window)\n *\n * Note: This method will create a new tab if the given tab ID doesn't exist, as this method may be called with a non-existent tab ID.\n */\nBrowserTabs.prototype.setActiveTab = function(tabId) {\n\tconsole.log('setActiveTab(' + tabId + ')');\n\tif(tabId === -1) { // -1 == no tab\n\t\treturn;\n\t}\n\n\tvar tab = this.find(tabId);\n\n\t// No existing tab with that ID, create a new one\n\tif(!tab) {\n\t\tthis.activeTab = this.add(tabId)\n\t\treturn;\n\t}\n\n\t// Existing tab with this ID, set it to active\n\tthis.activeTab = tab;\n};\n\n/**\n * @return A list of tab IDs that are stored in the tab map.\n */\nBrowserTabs.prototype.ids = function() {\n\tvar ids = [];\n\tthis.tabs.forEach(function(tab, tabId) {\n\t\tids.push(tabId);\n\t})\n\treturn ids;\n};\n\n/**\n * Adds a new tab to the internal map.\n * @return The tab object that was created.\n */\nBrowserTabs.prototype.add = function(tabId) {\n\tthis.tabs.set(tabId, new BrowserTab(tabId));\n\treturn this.find(tabId);\n};\n\n/**\n * @return A tab with the given ID. Will be null if a tab doesn't exist with that ID\n */\nBrowserTabs.prototype.find = function(tabId) {\n\tvar tab = this.tabs.get(tabId);\n\treturn tab;\n};\n\n/**\n * Removes the given tab ID from the internal tabs map.\n */\nBrowserTabs.prototype.remove = function(tabId) {\n\tthis.tabs.delete(tabId);\n};\n\n/**\n * @return true if a tab is active.\n */\nBrowserTabs.prototype.hasActiveTab = function() {\n\treturn !isUndefined(this.activeTab.id);\n};\n\n/**\n * @return True if the given tab ID matches that of the active tab.\n */\nBrowserTabs.prototype.isActiveTab = function(tabId) {\n\tif(!this.hasActiveTab()) {\n\t\treturn false;\n\t}\n\n\treturn this.activeTab.id === tabId;\n};\n\n/**\n * Find the first tab with the given store ID in, excluding the current tab ID that was given.\n *\n * @return The tab object which has the given store ID as the current store.\n */\nBrowserTabs.prototype.findByStoreId = function(storeId, currentTabId) {\n\tvar tabs = this.findAllByStoreId(storeId, currentTabId);\n\tif(tabs.length > 0) {\n\t\treturn tabs[0];\n\t}\n\treturn null;\n};\n\n/**\n * Finds all tab IDs with the given store ID.\n *\n * @return A list of tab IDs with the given store ID in, excluding the current tab ID that was given.\n */\nBrowserTabs.prototype.findAllByStoreId = function(storeId, currentTabId) {\n\tvar found = [];\n\tthis.tabs.forEach(function(tab, tabId) {\n\t\t// Exclude the current tab's ID.\n\t\tif(tab.currentStore.id === storeId && tabId !== currentTabId) {\n\t\t\tfound.push(tab);\n\t\t}\n\t});\n\treturn found;\n};\n\n/**\n * Updates the state of all tabs to match the state of the given tab, but only if they're on the same store.\n */\nBrowserTabs.prototype.updateTabsWithMatchingStore = function(currentTab) {\n\tconsole.log('updateTabsWithMatchingStore()');\n\tvar tabs = this.findAllByStoreId(currentTab.currentStore.id, currentTab.id);\n\ttabs.forEach(function(tab, tabId) {\n\t\tconsole.log('Changing state of tab ' + tabId);\n\t\ttab.status = currentTab.status;\n\t\ttab.activeStore = currentTab.activeStore;\n\t});\n};\n\n/**\n * \tModel for a browser tab, used by BrowserTabs.\n */\nfunction BrowserTab(id) {\n\t// The tab's ID, determined by the browser.\n\tthis.id = id;\n\n\t// The URL this tab is currently on.\n\tthis.url = null;\n\n\t// The store this tab is currently on. We set this to an empty object so that\n\t// we can safely access the 'id' property without having to check if this is undefined.\n\tthis.currentStore = {};\n\n\t// The store the user last activated on this tab. This may differ from this.currentStore.\n\tthis.activeStore = {};\n\n\t// The current tracking status for this.currentStore\n\t// See store-status.js for a full list of statuses.\n\tthis.status = StoreStatus.BLANK\n\n\t// Keeps track of all URLs this tab has navigated through to reach the current URL (includes redirects).\n\tthis.navigation = new NavigationTracker();\n\n\tthis.pendingProcess = null;\n\n\tconsole.log('BrowserTab(' + id + ') created.');\n}\n\n/**\n * Executes the given callback once within a given time.\n */\nBrowserTab.prototype.executeOnce = function(callback) {\n\tif(this.pendingProcess) {\n\t\tclearTimeout(this.pendingProcess);\n\t}\n\tthis.pendingProcess = setTimeout(callback, Config.processingDelayMs);\n};\n\n/**\n * Creates a BrowserTab object from a raw object in the shape of a BrowserTab object.\n *\n * Why?\n * ---\n * When sending data from the background page to the popup, all of the methods on this object are lost,\n * so we need to recreate it from scratch.\n */\nBrowserTab.prototype.from = function(browserTab) {\n\t// Background page might not have sent a proper response.\n\tif(!browserTab || !browserTab.id){\n\t\treturn null;\n\t}\n\tvar tab = new BrowserTab(browserTab.id);\n\tfor(var prop in browserTab) {\n\t\ttab[prop] = browserTab[prop];\n\t}\n\treturn tab;\n};\n\n/**\n * @return True if the given tab ID has the same ID as this tab.\n */\nBrowserTab.prototype.isSameTab = function(tabId) {\n\treturn this.id === tabId;\n};\n\n/**\n * @return True if the given store object is the current store for this tab.\n */\nBrowserTab.prototype.isCurrentStore = function(store) {\n\t// No current store means it's the first time a store has been loaded in this tab.\n\tif(isUndefined(this.currentStore.id)) {\n\t\treturn false;\n\t}\n\treturn this.currentStore.id === store.id;\n};\n\n/**\n * @return The current status of this tab - possible states are listed in store-status.js\n */\nBrowserTab.prototype.currentStatus = function() {\n\treturn this.status;\n};\n\n/**\n * @return True if this tab has a store loaded in it.\n */\nBrowserTab.prototype.hasStore = function() {\n\treturn !isUndefined(this.currentStore.id);\n};\n\nBrowserTab.prototype.toString = function() {\n\treturn `Tab(${this.id}), currentStore=${this.currentStore.name}, activeStore=${this.activeStore.name}, status=${this.status}`;\n};\n\n/**\n * Copies specific properties from the source tab to the target tab.\n */\nBrowserTab.copy = function(srcTab, targetTab) {\n\ttargetTab.navigation = srcTab.navigation;\n\ttargetTab.status = srcTab.status;\n\ttargetTab.currentStore = srcTab.currentStore;\n\ttargetTab.activeStore = srcTab.activeStore;\n};\n\nmodule.exports = {\n\tBrowserTabs,\n\tBrowserTab\n};","var cookies;\n\n// Firefox / Chrome\nif('undefined' !== typeof chrome && chrome.cookies) {\n\tcookies = chrome.cookies;\n}\n\n// Microsoft Edge\nif('undefined' !== typeof browser && browser.cookies) {\n\tcookies = browser.cookies;\n}\n\nmodule.exports = cookies;","/**\n * Utility for visiting clickthrough URLs.\n *\n * This is invoked any time a user clicks a clickthrough URL. It does the following things:\n * - Appends a 'check_adblocker' parameter to the URL.\n * - Appends an 'extension_source' parameter to the URL.\n *\n * @author Daniel Moffat\n *\n * todo: The parameters should be appended on the server when they are generated, this is a workaround that\n *       shouldn't really exist - me after looking 2 years later.\n */\n\nvar Config = require('../config.development.js');\nvar visitUrl = require('./visit-url.js');\n\n/**\n * Follows the URL specified in the options, in the tab specified in the options.\n * Options look like this:\n *  {\n *  \t// URL to follow\n\t\t\"url\": \"http://www.google.com\",\n\t\t// Tab ID to open this URL in\n\t\t\"tabId\": \"1234\",\n\t\t// Where this was invoked from\n\t\t\"source\": \"RETAILER\",\n\t\t// Whether to close the extension popup after following the link\n\t\t\"closePopup\": true\n \t}\n */\nfunction visitClickthrough(options) {\n\tvar tabId = options.tabId;\n\tvar url = options.url;\n\tvar source = options.source || null;\n\tvar closePopup = options.closePopup || false;\n\n\tif(!url || !tabId) {\n\t\tconsole.error('visitClickthrough requires a tab ID / URL.');\n\t\treturn;\n\t}\n\n\t// Prompt the clickthrough to check for adblocking software.\n\turl += '&check_adblocker=true';\n\n\t// Add the version\n\turl += '&v=' + Config.version();\n\n\t// Let the clickthrough know where the click came from\n\tif(source) {\n\t\turl += '&extension_source=' + source;\n\t} else {\n\t\tconsole.warn('No source found for clickthrough URL.');\n\t}\n\n\tconsole.log('Final click URL: ' + url);\n\n\tvisitUrl({ tabId, url, closePopup });\n}\n\nmodule.exports = visitClickthrough;","/**\n* Checks if the extension is allowed access to all URLs. If the callback is invoked with false, it means the user has changed\n* their host runtime permissions (https://developer.chrome.com/extensions/runtime_host_permissions) and the extension can't operate.\n*\n* @param callback Will be invoked with either true|false, depending on permissions.\n*\n* @author Daniel Moffat\n*/\n\nvar permissions = require('../web-ext/permissions.js')\n\n function checkPermissions(callback) {\n \tvar permissionsToCheck = {\n \t\torigins: ['http://*/*', 'https://*/*']\n \t};\n \tpermissions.contains(permissionsToCheck, function(hasPermission) {\n \t\tif(callback) { // Handle being called without a callback\n \t\t\tcallback(hasPermission);\n \t\t}\n \t}.bind(this));\n }\n\nmodule.exports = checkPermissions;","/**\n * \tKeeps track of the URLs (including redirects) that have been navigated to by the user.\n * \tOnce the user navigates to a completely different URL, the history is cleared.\n *\n * \tFor example, lets say you have the URL http://example.org/foo, which redirects to\n * \thttp://example.org/foo/bar and then http://somewhere-else.com, the stack will look like this:\n *\n * \t[\n * \t\t\"http://example.org/foo\",\n * \t\t\"http://example.org/foo/bar\",\n * \t\t\"http://somewhere-else.com\"\n * \t]\n *\n *  However, if http://example.org/foo didn't perform any redirects, the stack will look like this:\n *\n *  [\n * \t\t\"http://example.org/foo\"\n * \t]\n *\n * \tIt's driven by the webRequest.beforeRequest + webNavigation.onCommitted events.\n *\n * \t@author Daniel Moffat\n */\n\nvar URI = require('urijs');\nvar {isClickthrough, isGiveasyouLiveEmail} = require('./shared/util.js');\n\nfunction NavigationTracker() {\n\t// The current stack of URLs that've been navigated to\n\t// todo: rename, this is a bad name, it's actually a list of NavigationTrackerItem's, rather than URLs as the name implies...\n\tthis.urls = [];\n\n\t// The last stack of URLs that've been navigated to\n\tthis.oldUrls = [];\n}\n\n/**\n * Adds a URL to the navigation stack, extracting metadata from the URL, such as the host and the domain.\n */\nNavigationTracker.prototype.push = function(url) {\n\tthis.urls.push(new NavigationTrackerItem(url));\n};\n\n/**\n * @return The last URL that in the navigation stack, or null if there isn't one (this usually happens if the page is refreshed, or typed directly into the address bar.)\n */\nNavigationTracker.prototype.last = function() {\n\treturn this.urls[this.urls.length - 1] || null;\n};\n\n/**\n * @return the first URL in the navigation stack (i.e the first one the user navigated to)\n */\nNavigationTracker.prototype.first = function() {\n\treturn this.urls[0] || null;\n};\n\n/**\n * @param  urlOnly Whether to return just URLs, or all metadata.\n * @return A list of navigation items (which contain URL metadata), or just a list of URLs, depending on the value of the urlOnly flag.\n */\nNavigationTracker.prototype.currentUrls = function(urlOnly) {\n\tif(urlOnly) {\n\t\treturn this.urls.map(function(trackerItem) { return trackerItem.url });\n\t}\n\treturn this.urls;\n};\n\n/**\n * Clears the navigation stack, and keeps a reference to the old navigation stack.\n */\nNavigationTracker.prototype.clear = function() {\n\tthis.oldUrls = this.urls;\n\tthis.urls = [];\n};\n\n/**\n * @return True if the navigation stack is empty.\n */\nNavigationTracker.prototype.isEmpty = function() {\n\treturn this.urls.length === 0;\n};\n\n/**\n * @return True if the navigation stack was the result of a direct click from either the GAYL.com website, or\n * an email.\n */\nNavigationTracker.prototype.wasDirectClick = function() {\n\treturn this.firstWasClickthrough() || // If the first URL was the clickthrough, they've clicked directly from the GAYL website\n\t\t\t(this.firstWasEmail() && this.wasClickthrough(1)); // Ensure the navigation is email click -> clickthrough before turning it on.\n};\n\n/**\n * @return True if the first URL in the navigation stack is the clickthrough URL.\n */\nNavigationTracker.prototype.firstWasClickthrough = function() {\n\tvar first = this.first();\n\tif(first && first.url && isClickthrough(first.url)) {\n\t\treturn true;\n\t}\n\treturn false;\n};\n\n/**\n * @return True if the given index in the navigation stack is a clickthrough URL.\n */\nNavigationTracker.prototype.wasClickthrough = function(idx) {\n\tif(idx >= this.urls.length) { // Make sure the index is accessible\n\t\treturn false;\n\t}\n\n\tvar item = this.urls[idx];\n\n\treturn isClickthrough(item.url);\n};\n\n/**\n * @return True if the navigation stack's first URL was from a Give as you Live email.\n */\nNavigationTracker.prototype.firstWasEmail = function() {\n\tvar first = this.first();\n\tif(first && first.url && isGiveasyouLiveEmail(first.url)) {\n\t\treturn true;\n\t}\n\treturn false;\n};\n\n/**\n * @return True if the given url is in the navigation stack\n */\nNavigationTracker.prototype.contains = function(url) {\n\tfor (var i = 0; i < this.urls.length; i++) {\n\t\tvar item = this.urls[i];\n\t\tif(item.url === url) {\n\t\t\treturn true;\n\t\t}\n\t}\n\treturn false;\n};\n\n/**\n * Logs all URLs that are in the navigation stack\n */\nNavigationTracker.prototype.log = function() {\n\tconsole.log('Navigation URLS:');\n\tthis.currentUrls(true).forEach(function(url) {\n\t\tconsole.log('- ' + url);\n\t});\n};\n\n/**\n * Represents a URL that has been navigated through. Extracts additional metadata from the URL for use later on.\n */\nfunction NavigationTrackerItem(url) {\n\tvar uri = URI(url);\n\tthis.url = url;\n\tthis.domain = uri.domain();\n\tthis.host = uri.host();\n}\n\nmodule.exports = NavigationTracker;","/**\n * Provides an temporary cache whose entries expire after a fixed timeout. Once the object is\n * destroyed all cache entries will be lost.\n *\n * @author Daniel Moffat\n */\n\nvar {isString, getTimestamp} = require('./shared/util.js');\n\nvar DEFAULT_CACHE_TIMEOUT = 10000;\n\nfunction Cache(expiryTimeMs) {\n\tthis.expiryTimeMs = expiryTimeMs || DEFAULT_CACHE_TIMEOUT;\n\tthis.entries = {};\n}\n\n/**\n * Get an entry from the cache.\n *\n * @return The value for the given key, or null if the value cannot be found / has expired.\n */\nCache.prototype.get = function(key) {\n\tvar entry = this.entries[key];\n\n\tif(!entry) {\n\t\treturn null;\n\t}\n\n\tvar age = getTimestamp() - entry._added;\n\tif(age >= this.expiryTimeMs) {\n\t\tthis.remove(key);\n\t\treturn null;\n\t}\n\n\treturn entry;\n}\n\n/**\n * Adds an entry to the cache. Does not currently support strings as values, since you\n * can't set properties on them.\n * todo: Make this support strings, would need to wrap the provided value in an object\n * and set the 'added' property.\n */\nCache.prototype.set = function(key, value) {\n\tif(!key) {\n\t\tthrow new Error('Cache.set called without a key.');\n\t}\n\n\tif(!value) {\n\t\tthrow new Error('Cache.set called without a value.');\n\t}\n\n\tif(isString(value)) {\n\t\tconsole.log(value);\n\t\tthrow new Error('Cache.set doesn\\'t support strings as values.');\n\t}\n\n\t// Before adding to the cache, add a timestamp so we know how long it's been there for.\n\tvalue._added = getTimestamp();\n\tthis.entries[key] = value;\n}\n\nCache.prototype.remove = function(key) {\n\tdelete this.entries[key];\n}\n\nmodule.exports = Cache;","/**\n * Responsible for making HTTP requests in a browser-agnostic manner (uses XMLHttpRequest internally).\n *\n * All request methods (get, post) return Promise objects (https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise),\n * to make it easier to handle responses (similar to jQuery.ajax).\n *\n * Options:\n * - dataType, The type of data you're receiving, defaults to JSON, supported values are:\n * \t- 'json'\n * - headers, map of header names / values\n * - timeout, the amount of time (in ms) to wait before the request times out.\n *\n * Example:\n *\n * // GET request\n * Request.get('/path/to/resource')\n * \t\t  .then(resp => console.log(resp))\n * \t\t  .catch(err => {\n\t\t   \t\tconsole.log(err.statusCode, err.message);\n\t\t   });\n\n   todo: Try and find a lightweight HTTP client which performs similar tasks. This is just reinventing the wheel, and not very well.\n *\n * @author Daniel Moffat\n */\n\nvar Messages = require('./shared/messages.js');\nvar Config = require('./config.development.js');\n\n// HTTP status codes\nvar STATUS_OK = 200;\n\nvar Request = {\n\tget: function (url, options) {\n\t\treturn fetch('GET', url, {}, options || {});\n\t},\n\n\tpost: function(url, data, options) {\n\t\treturn fetch('POST', url, data || {}, options || {});\n\t}\n}\n\n/** This function does the actual AJAX requests for both POST / GET requests */\nfunction fetch(type, url, data, options) {\n\tvar data = data || {};\n\tvar type = type || 'GET';\n\tvar options = options || {};\n\tvar requestStart = 0;\n\treturn new Promise(function(resolve, reject) {\n\t\trequestStart = Date.now();\n\t\tvar req = new XMLHttpRequest();\n\t\treq.onreadystatechange = function() {\n\t\t\thandleRequest(url, req, resolve, reject, options, requestStart);\n\t\t};\n\t\treq.open(type, url);\n\t\treq.timeout =  options.timeout || Config.requestTimeoutMs;\n\t\taddHeaders(req, options.headers);\n\t\tif(req.type === 'GET') {\n\t\t\treq.send();\n\t\t} else {\n\t\t\treq.send(JSON.stringify(data));\n\t\t}\n\t});\n}\n\n/** Add request headers to the given request */\nfunction addHeaders(req, headers) {\n\tif(!headers) return;\n\tfor(var header in headers) {\n\t\treq.setRequestHeader(header, headers[header]);\n\t}\n\treq.setRequestHeader('Content-Type', 'application/json; charset=UTF-8');\n}\n\n/**\n * Invoked each time XMLHttpRequest.onreadstatechange is triggered, used by fetch.\n */\nfunction handleRequest(url, req, resolve, reject, options, requestStart) {\n\tif(req.readyState === XMLHttpRequest.DONE) {\n\t\t// console.log(`Request (status:${req.status}) '${url}' took ${Date.now() - requestStart}ms`);\n\n\t\t// 200\n\t\tif(req.status === STATUS_OK) {\n\t\t\treturn handleStatusOk(req, resolve, reject, options);\n\t\t}\n\n\t\t// 4xx, 5xx and 0 (XMLHttpRequest)\n\t\treturn handleStatusNotOk(req, resolve, reject);\n\t}\n}\n\n// Invoked for the OK HTTP response (200)\nfunction handleStatusOk(req, resolve, reject, options) {\n\t// TODO: need to add handling for different datatypes. Currently if a dataType is specified, it will just resolve with the content.\n\tif(options.dataType && options.dataType !== 'json') {\n\t\tresolve(req.responseText);\n\t} else {\n\t\ttry {\n\t\t\tresolve(JSON.parse(req.responseText));\n\t\t} catch(e) { // If we failed to parse the JSON, just return the response.\n\t\t\tresolve(req.responseText);\n\t\t}\n\t}\n}\n\n// Invoked for every HTTP response except OK (200)\nfunction handleStatusNotOk(req, resolve, reject) {\n\t// The status will be 0 if:\n\t// - The request timed out\n\t// - The browser cancelled the request\n\t// I cannot use ontimeout, as that is invoked AFTER handleRequest is invoked. So by the time the ontimeout\n\t// callback is fired, the promise has already been rejected.\n\tif(req.status === 0) {\n\t\treject({\n\t\t\tstatusCode: req.status,\n\t\t\tmessage: 'Request timed out.',\n\t\t\ttype: 'http_error_timeout_or_cancelled'\n\t\t});\n\t} else {\n\t\t// If it's not 0, it will be 4xx or 5xx, which we can handle.\n\t\treject({\n\t\t\tstatusCode: req.status,\n\t\t\tmessage: tryParseErrorMessageFromResponse(req),\n\t\t\ttype: 'api_error'\n\t\t});\n\t}\n}\n\nfunction tryParseErrorMessageFromResponse(req) {\n\tvar errorMessage = Messages.GENERIC_ERROR_MESSAGE;\n\ttry {\n\t\t// First, try parse the response as JSON. Our API returns all error responses as JSON.\n\t\tvar resp = JSON.parse(req.responseText);\n\t\tvar errors = resp.errors;\n\t\tif(errors && errors.length > 0) {\n\t\t\terrorMessage = Messages.API_ERROR_MESSAGES[errors[0].error_code]\n\t\t}\n\t} catch(e) {\n\t\t// If this happened, our API did not return JSON, I've never actually seen this happen,\n\t\t// but it should be covered.\n\t\terrorMessage = Messages.REQUEST_ERROR_MESSAGES[req.status];\n\t\tif(!errorMessage) {\n\t\t\tconsole.warn('No message found for status code', req.status);\n\t\t}\n\t}\n\treturn errorMessage;\n}\n\nmodule.exports = Request;","module.exports = function(module) {\r\n\tif (!module.webpackPolyfill) {\r\n\t\tmodule.deprecate = function() {};\r\n\t\tmodule.paths = [];\r\n\t\t// module.parent = undefined by default\r\n\t\tif (!module.children) module.children = [];\r\n\t\tObject.defineProperty(module, \"loaded\", {\r\n\t\t\tenumerable: true,\r\n\t\t\tget: function() {\r\n\t\t\t\treturn module.l;\r\n\t\t\t}\r\n\t\t});\r\n\t\tObject.defineProperty(module, \"id\", {\r\n\t\t\tenumerable: true,\r\n\t\t\tget: function() {\r\n\t\t\t\treturn module.i;\r\n\t\t\t}\r\n\t\t});\r\n\t\tmodule.webpackPolyfill = 1;\r\n\t}\r\n\treturn module;\r\n};\r\n","/**\n *\tWebExtensions windows polyfill.\n *\n * \t@author Daniel Moffat\n */\n\nvar windows;\n\n// Firefox / Chrome\nif('undefined' !== typeof chrome && chrome.windows) {\n\twindows = chrome.windows;\n}\n\n// Microsoft Edge\nif('undefined' !== typeof browser && browser.windows) {\n\twindows = browser.windows;\n}\n\n// Browsers which don't support this (old Safari/Android Firefox). This is required to stop runtime errors being thrown.\nif(!windows) {\n    windows = {\n       onFocusChanged: {\n           addListener: function(callback) {}\n       }\n    };\n}\n\nmodule.exports = windows;","/**\n *\tWebExtensions webNavigation polyfill.\n *\n * \t@author Daniel Moffat\n */\n\nvar webNavigation;\n\n// Firefox / Chrome\nif('undefined' !== typeof chrome && chrome.webNavigation) {\n\twebNavigation = chrome.webNavigation;\n}\n\n// Microsoft Edge\nif('undefined' !== typeof browser && browser.webNavigation) {\n\twebNavigation = browser.webNavigation;\n}\n\nmodule.exports = webNavigation;","/**\n *\tWebExtensions webRequest polyfill.\n *\n * \t@author Daniel Moffat\n */\n\nvar webRequest;\n\n// Firefox / Chrome\nif('undefined' !== typeof chrome && chrome.webRequest) {\n\twebRequest = chrome.webRequest;\n}\n\n// Microsoft Edge\nif('undefined' !== typeof browser && browser.webRequest) {\n\twebRequest = browser.webRequest;\n}\n\nmodule.exports = webRequest;","/**\n * \tWebExtensions browserAction API polyfill.\n *\n * \t@author Daniel Moffat\n */\n\nvar browserAction;\n\n// Firefox / Chrome\nif('undefined' !== typeof chrome && chrome.browserAction) {\n\tbrowserAction = chrome.browserAction;\n}\n\n// Microsoft Edge\nif('undefined' !== typeof browser && browser.browserAction) {\n\tbrowserAction = browser.browserAction;\n}\n\nmodule.exports = browserAction;","var config = require('./config.development.js');\nvar runtime = require('./web-ext/runtime.js');\nvar cookies = require('./web-ext/cookies.js');\n\nclass NotificationListener {\n\n\tconstructor() {\n\n        // Establish connection with app\n        let  port = runtime.connectNative(\"DonationReminderNotification\");\n        port.onMessage.addListener(response => {\n\n            // todo: we don't have the 'cookies' permission in browsers, we need to a way to physically remove\n            //       code when building for web/android for this to be usable.\n             cookies.set({\n                url: config.gaylUrl,\n                domain: config.gaylDomain,\n                name: \"android_notification\",\n                value:  response.token,\n                expirationDate: 2147483647,\n                path: '/'\n              });\n\n        });\n\n\t}\n\n}\n\nmodule.exports = NotificationListener;","/**\n * \tProvides a cross-browser way to open a new tab. Uses browser-specific APIs where possible.\n *\n *  If you're looking to update the URL in the current tab, look at web-ext/tabs.js\n *\n * \t@author Daniel Moffat\n */\n\nvar tabs = require('../web-ext/tabs.js');\n\nfunction openTab(url) {\n\tconsole.log('Opening tab with URL: ' + url);\n\t// Safari\n\tif(typeof safari !== 'undefined') {\n\t\t// If we don't close the popup before opening a new tab, the popup will get stuck\n\t\t// and will be permanently fixed on top of the window.\n\t\trequire(\"./close-popup.js\")();\n\t\tsafari.application.activeBrowserWindow.openTab().url = url;\n\t} else {\n\t\t// Chrome / Firefox / Edge\n\t\ttabs.create({\n\t\t\turl: url\n\t\t});\n\t}\n}\n\nmodule.exports = openTab;","/**\n * Listens for browser extension installation / update events.\n *\n * @author Daniel Moffat\n */\n\nvar getBrowserName = require('./shared/get-browser-name.js');\nvar getMobileOs = require('./shared/get-mobile-os.js');\nvar Config = require('./config.development.js');\nvar openTab = require('./shared/open-tab.js');\nvar { runtime } = require('./web-ext/index.js');\nvar { getGaylUrl, isAndroidApp, isMajorVersionUpdate } = require('./shared/util.js');\n\nclass InstallationListener {\n\tconstructor() {\n\t\t/**\n\t\t * \tInvoked when:\n\t\t * \t- Extension is first installed\n\t\t * \t- Extension is updated to a new version\n\t\t * \t- Browser is updated to a new version\n\t\t *\n\t\t * \tdocs: https://developer.mozilla.org/en-US/Add-ons/WebExtensions/API/runtime/onInstalled\n\t\t *\n\t\t * \tNOTE: runtime.onInstalled doesn't seem to be present in Firefox 48 - 52. So we need to check for its existence first.\n\t\t */\n\n\t\tif(isAndroidApp())\n\t\t    return;\n\n\t\tif(runtime.onInstalled) {\n\t\t\truntime.onInstalled.addListener(this.onExtensionInstalled.bind(this));\n\t\t}\n\t}\n\n\tonExtensionInstalled(details) {\n\t\tswitch(details.reason) {\n\t\t\tcase 'install':\n\t\t\t\tthis.onExtensionInstalledFirstTime(details);\n\t\t\t\tbreak;\n\t\t\tcase 'update':\n\t\t\t\tthis.onExtensionUpdated(details);\n\t\t\t\tbreak;\n\t\t\t// These don't require us to do anything, pass through\n\t\t\tcase 'chrome_update':\n\t\t\tcase 'shared_module_update':\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tonExtensionInstalledFirstTime(details) {\n\t\tvar welcomeUrl = getGaylUrl('/welcome');\n\t\tvar installedVersion = Config.version();\n\t\tconsole.log('Extension installed for the first time.', installedVersion);\n\t\topenTab(welcomeUrl + \"?version=\" + installedVersion);\n\t}\n\n\tonExtensionUpdated(details) {\n\t\tvar updateUrl = getGaylUrl('/update');\n\t\tvar newVersion = Config.version();\n\t\tvar previousVersion = details.previousVersion;\n\n\t\tconsole.log('The extension has been updated: ' + previousVersion + ' -> ' + newVersion);\n\n\t\t// Open the update webpage for major version updates.\n\t\tif(isMajorVersionUpdate(previousVersion, newVersion)) {\n\t\t\tconsole.log('Extension has updated major versions.');\n\t\t\topenTab(updateUrl + \"?previousVersion=\" + previousVersion + '&newVersion=' + newVersion);\n\t\t}\n\t}\n}\n\nmodule.exports = InstallationListener;","/**\n * \tProvides a convenient way to set the browser icon for multiple image sizes.\n *  Browser icons live in the 'images' folder and you should provide images in the same sizes as the\n *  'ICON_IMAGE_SIZES' array.\n *  \n * \t@author Daniel Moffat\n */\n\nvar { runtime, browserAction } = require('../web-ext/index.js');\nvar getBrowserName = require('./get-browser-name.js');\n\nvar ICON_IMAGE_PATH = \"images/\";\nvar ICON_IMAGE_SIZES = [16, 20, 25, 30, 32, 40, 48, 64, 128];\n\n/**\n * @param name, the image name, e.g. my-cool-icon\n * @param suffix, the image suffix, e.g. .png\n */\nfunction setBrowserIcon(prefix, suffix) {\n\tvar paths = {};\n\tprefix = ICON_IMAGE_PATH + prefix;\n\n\tICON_IMAGE_SIZES.forEach(function(size) {\n\t\tpaths[size] = runtime.getURL(prefix + size + suffix)\n\t});\n\n\tvar browserName = getBrowserName();\n\n\tif(browserName === 'Edge') {\n\t\t// Edge does not seem to support setting multiple paths like Chrome / Firefox.\n\t\t// This just plucks out the 40x40 icon and uses that.\n\t\t// todo: Add something to browserAction.setIcon polyfil to cater for this.\n\t\tbrowserAction.setIcon({\n\t\t\tpath: paths['40']\n\t\t});\n\t} else if(browserName === 'Safari'){\n\t\t// Safari doesn't support:\n\t\t// - Setting the icon to an absolute path of an extension resource, e.g. safari-extension://your-extension-id/xxxx.png\n\t\t// - Setting the icon to a map of image size -> path to resource\n\t\t// Because of this limitation we hardcode the 128px resource and use relative image paths\n\t\tvar relativeIconPath = prefix + '128' + suffix;\n\t\tbrowserAction.setIcon({\n\t\t\tpath: relativeIconPath\n\t\t});\n\t} else {\n\t\tbrowserAction.setIcon({\n\t\t\tpath: paths\n\t\t});\n\t}\n}\n\nmodule.exports = setBrowserIcon;","/**\n * \tThis is the core class of the extension. It listens to browser events to determine if a retailer is supported, and events\n * \tsent from other extension components.\n *\n * \tWhen a user browses the internet, it collects URLs that have been visited, and sends them off to our REST API to determine\n * \tif the current website is a supported retailer or not.\n *\n * \tIt is used by the following extension components:\n *\t- Content scripts, to display retailer alerts\n *\t- Popup, to obtain information about the currently logged in user, and the current website's state.\n *\n * \t@author Daniel Moffat\n */\n\nvar URI = require('urijs');\n\nvar { browserAction, runtime, webRequest, webNavigation, windows } = require('./web-ext/index.js');\nvar { createError, isClickthrough, isMajorVersionUpdate, isSerp, isUndefined, logObject } = require('./shared/util.js');\nvar { BrowserTab, BrowserTabs } = require('./browser-tabs.js');\nvar { Message, MessageSubject } = require('./shared/message.js');\nvar Api = require('./gayl-api-client.js');\nvar checkPermissions = require('./shared/check-permissions.js');\nvar Config = require('./config.development.js');\nvar getBrowserName = require('./shared/get-browser-name.js');\nvar setBrowserIcon = require('./shared/set-browser-icon.js');\nvar Storage = require('./storage.js');\nvar StoreStatus = require('./shared/store-status.js');\nvar tabs = require('./web-ext/tabs.js');\nvar visitClickthrough = require('./shared/visit-clickthrough.js');\n\nclass ExtensionCore {\n\tconstructor() {\n\t\t// Holds information about the browser tabs and their state\n\t\tthis.tabs = new BrowserTabs();\n\n\t\t// Contains the currently logged in user.\n\t\tthis.user = null;\n\n\t\t// Contains the currently logged in user's cause.\n\t\tthis.cause = null;\n\n\t\t// Contains the currently logged in user's device security code, this is just a token that's returned after a user authenticates.\n\t\tthis.deviceSecurityCode = null;\n\n\t\t// For making GAYL API requests\n\t\tthis.api = Api;\n\n\t\t// For persistent storage\n\t\tthis.storage = Storage;\n\n\t\t// Listen for browser events\n\t\tthis.bindEventHandlers();\n\n\t\tthis.setUninstallUrl(Config.uninstallUrl);\n\t}\n\n\tbindEventHandlers() {\n\n\t\t/**\n\t\t * \tMake Safari's popup behave the same way as the other browsers (full reload each time it's opened.),\n\t\t * \tthis makes it much easier to work with, as you don't need to worry about what state the popup was in\n\t\t * \twhen it was closed.\n\t\t */\n\t\tif('undefined' !== typeof safari) {\n\t\t\tsafari.application.addEventListener('command', this.onClickSafariExtensionIcon.bind(this), false);\n\t\t}\n\n\t\t/**\n\t\t * Invoked before every HTTP request.\n\t\t *\n\t\t * This is executed every time a HTTP request is made for top-level documents (not iFrames).\n\t\t */\n\t\twebRequest.onBeforeRequest.addListener(this.onBeforeRequest.bind(this), {\n\t\t\turls: ['http://*/*', 'https://*/*'], // Only run on certain schemes, otherwise you get junk from chrome-extension://\n\t\t\ttypes: ['main_frame'] // Limit to top-level documents\n\t\t});\n\n\t\t// NOTE: This having an empty function is INTENDED, due to this bug in Firefox (https://bugzilla.mozilla.org/show_bug.cgi?id=1429556),\n\t\t// without it, redirected URLs are not picked up inside webRequest.onBeforeRequest().\n\t\twebRequest.onBeforeRedirect.addListener(function() {}, { urls: ['<all_urls>'] });\n\n\t\t/**\n\t\t * Invoked when a new tab is created. Note, this is not invoked when a pre-rendered tab is created...\n\t\t *\n\t\t * docs: https://developer.mozilla.org/en-US/Add-ons/WebExtensions/API/tabs/onCreated\n\t\t */\n\t\ttabs.onCreated.addListener(this.onTabCreated.bind(this));\n\n\t\t/**\n\t\t * Invoked when a tab is removed.\n\t\t *\n\t\t * docs: https://developer.mozilla.org/en-US/Add-ons/WebExtensions/API/tabs/onRemoved\n\t\t */\n\t\ttabs.onRemoved.addListener(this.onTabRemoved.bind(this));\n\n\t\t/**\n\t\t * \tInvoked when the active tab in a window changes.\n\t\t *\n\t\t * \tdocs: https://developer.mozilla.org/en-US/Add-ons/WebExtensions/API/tabs/onActivated\n\t\t */\n\t\ttabs.onActivated.addListener(this.onTabActivated.bind(this));\n\n\t\t/**\n\t\t * \tInvoked when the currently focused window changes.\n\t\t *\n\t\t * \tdocs: https://developer.mozilla.org/en-US/Add-ons/WebExtensions/API/windows/onFocusChanged\n\t\t */\n\t\twindows.onFocusChanged.addListener(this.onWindowFocusChanged.bind(this));\t\n\n\t\t/**\n\t\t *\tInvoked when a message is receieved from a content script / the popup.\n\t\t *\n\t\t * \tTo send a message which will be received by the onMessage listener, use runtime.sendMessage() or (to send a message to a content script) tabs.sendMessage().\n\t\t *\n\t\t * \tdocs: https://developer.mozilla.org/en-US/Add-ons/WebExtensions/API/runtime/onMessage\n\t\t */\n\t\truntime.onMessage.addListener(this.onMessage.bind(this));\n\n\t\t/**\n\t\t *  Explanation of this: 'webNavigation.onCommitted' doesn't get fired in Safari when you type into the address bar and press enter - it gets fired\n\t\t *  as you're typing and doesn't get fired again when you press enter. As a result the request to check the current\n\t\t *  website never gets sent until the page is refreshed. 'tabs.onUpdated' seems to get fired when I want it to (after you press enter), but I haven't\n\t\t *  had time to test this in all the other browsers, so for now this remains a Safari-specific fix.\n\t\t */\n\t\tif(getBrowserName() === \"Safari\") {\n\t\t\ttabs.onUpdated.addListener(this.onTabUpdated.bind(this));\n\t\t} else {\n\t\t\t/**\n\t\t\t * Invoked when a navigation is committed. It's committed when part of the new document\n\t\t\t * has been received from the server and the browser has decided to switch to the new document.\n\t\t\t *\n\t\t\t * docs: https://developer.mozilla.org/en-US/Add-ons/WebExtensions/API/webNavigation/onCommitted\n\t\t\t */\n\t\t\twebNavigation.onCommitted.addListener(this.onNavigationCommitted.bind(this));\n\t\t}\n\t}\n\n\tonTabUpdated(tabId, changeInfo, tabInfo) {\n\t\t// There are lots of onTabUpdated events that are fired, during the loading a page, the last one has a status of 'complete'.\n\t\t// It's also fired with an empty 'url' property when a new tab is created.\n\t\tif(changeInfo.status === 'complete' && tabInfo.url !== '') {\n\t\t\tconsole.log('onTabUpdated()', changeInfo, tabInfo);\n\t\t\t// See comment in 'bindEventHandlers' where this gets bound to see why this function is calling onNavigationCommitted.\n\t\t\tthis.onNavigationCommitted({\n\t\t\t\tframeId: 0,\n\t\t\t\ttabId: tabId,\n\t\t\t\turl: tabInfo.url\n\t\t\t});\t\n\t\t}\n\t}\n\n\tonTabReplaced(addedTabId, removedTabId) {\n\t\tconsole.log(`Added tab ID: ${addedTabId}, removed tab ID: ${removedTabId}`);\n\t}\n\n\tonClickSafariExtensionIcon(e) {\n\t\tif(e.command === 'open-popover') {\n\t\t\te.target.popover.contentWindow.location.reload();\n\t\t\te.target.showPopover();\n\t\t}\n\t}\n\n\tonBeforeRequest(requestDetails) {\n\t\tvar { tabId, url, parentFrameId } = requestDetails;\n\n\t\t// See method definition for an explanation of why this is needed.\n\t\tif(this.shouldIgnoreRequestSafari(parentFrameId, url)) {\n\t\t\tconsole.log('Ignoring: ', url);\n\t\t\tconsole.log('Parent frame id was: ', parentFrameId);\n\t\t\treturn;\n\t\t}\n\n\t\tif(!isSerp(requestDetails.url)) {\n\t\t\t// Get a handle on the tab that caused this event to fire. This may be a tab which is pre-rendered and not visible, so we need\n\t\t\t// to check if it actually exists in our tab map.\n\t\t\tvar tab = this.tabs.find(tabId);\n\t\t\tif(!isUndefined(tab)) {\n\t\t\t\tconsole.log('Adding navigated URL: ', url);\n\t\t\t\ttab.navigation.push(requestDetails.url);\n\t\t\t}\n\t\t}\n\t}\n\n\t// Safari's implementation of the 'webRequest' API doesn't support the 'opt_extraInfoSpec' parameter, meaning we can't filter out\n\t// requests when registering an event handler. To get around this we filter those requests inside the handler itself on Safari only.\n\tshouldIgnoreRequestSafari(parentFrameId, url) {\n\t\tif(getBrowserName() !== 'Safari') {\n\t\t\treturn false;\n\t\t}\n\t\treturn !url.startsWith('http') || parentFrameId !== 0;\n\t}\n\n\tonTabCreated(tabInfo) {\n\t\tconsole.log('onTabCreated(' + tabInfo.id + ')');\n\t\t// Workaround a bug that affects Safari only when the browser is opened for the first time.\n\t\tif('undefined' !== typeof safari) {\n\t\t\t// If there's no active tab, set it to the tab that was just created. This only happens\n\t\t\t// when Safari is opened for the first time and no tabs are discovered.\n\t\t\tif(!this.tabs.activeTab) {\n\t\t\t\tthis.tabs.setActiveTab(tabInfo.id);\n\t\t\t} else {\n\t\t\t\t// If there's already an active tab, just add the recently created one to the list.\n\t\t\t\t// We can't set it to active, because it may have been created in the background via CMD+click.\n\t\t\t\tthis.tabs.add(tabInfo.id);\n\t\t\t}\n\t\t} else {\n\t\t\t// Workaround for a bug in Firefox 48, where the onTabActivated event is fired before the onTabCreated event.\n\t\t\t// What happens:\n\t\t\t// - onTabActivated fired -> tab is set to active and added to internal tab map if it doesn't exist\n\t\t\t// - onTabCreated fired -> tab is added to internal tab map, overwriting the existing tab state\n\t\t\t// In other browsers these events fire in the order onTabCreated -> onTabActivated\n\t\t\tif(!this.tabs.find(tabInfo.id)) {\n\t\t\t\tthis.tabs.add(tabInfo.id);\n\t\t\t} else {\n\t\t\t\tconsole.log('Firefox 48 BUG.');\n\t\t\t}\n\t\t}\n\t}\n\n\tonTabRemoved(tabId, removeInfo) {\n\t\tconsole.log('onTabRemoved(tabId=' + tabId + ')');\n\t\tthis.tabs.remove(tabId);\n\t}\n\n\tonTabActivated(tabInfo) {\n\t\tconsole.log('onTabActivated(tabId=' + tabInfo.tabId + ')');\n\t\tthis.tabs.setActiveTab(tabInfo.tabId);\n\t\tthis.updateIcon();\n\t}\n\n\tonWindowFocusChanged(windowId) {\n\t\tconsole.log('onWindowFocusChanged(windowId=' + windowId + ')');\n\t\tvar self = this;\n\t\t// Find the active tab in the window that was switched to.\n\t\ttabs.customQuery({\n\t\t\tcurrentWindow: true,\n\t\t\tactive: true\n\t\t}).then(function(tabs) {\n\t\t\tif(!tabs || !tabs.length) { // Clear the active tab if none are in this window (e.g. A detatched devtools window.)\n\t\t\t\tself.tabs.setActiveTab(-1);\n\t\t\t} else {\n\t\t\t\tself.tabs.setActiveTab(tabs[0].id);\n\t\t\t\tself.updateIcon();\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * This is called before executing any of the logic in the onNavigationCommitted event handler. Its aim\n\t * is to filter out URLs we know we can't process.\n\t *\n\t * @return True if the given URL / frame ID should be processed.\n\t */\n\tshouldProcessUrl(url, frameId) {\n\t\treturn !isBlacklisted(url) &&\n\t\t\t\t!isClickthrough(url) &&\n\t\t\t\t!isGoogleChromeNewTab(url) &&\n\t\t\t\t!isIgnoredScheme(url) &&\n\t\t\t\tisCurrentFrame(frameId);\n\t}\n\n\t/**\n\t * \tInvoked when the user navigates to a URL. This can be fired multiple times per page load and for some browsers\n\t * \twill even be fired for pre-rendered tabs that aren't visible to the end-user.\n\t *\n\t *  It will also be fired twice in the same second for websites which perform client-side redirects.\n\t *\n\t *  @param request Contains detailed information about the current request.\n\t */\n\tonNavigationCommitted(request) {\n\t\tvar self = this;\n\n\t\t// An initial check before doing any processing to see if we can actually process this URL.\n\t\tif(!this.shouldProcessUrl(request.url, request.frameId)) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Check is the user has given the extension permission.\n\t\tcheckPermissions(function(hasPermission) {\n\t\t\tif(!hasPermission) { // Can't do anything without permission.\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Next, match the tabID in the request, with our in-memory list of tabs.\n\t\t\tvar tab = self.tabs.find(request.tabId);\n\n\t\t\t// If no tab was found, it can mean a few things:\n\t\t\t// 1) The tab is being pre-rendered by Chrome (or other browsers which do this)\n\t\t\t// 2) It's a new tab in Safari\n\t\t\tif(!tab) {\n\t\t\t\tconsole.log('### Pre-render / new Safari tab / tab removal detected. ###');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Finally, process the URL. This executes at most once per 'Config.processingDelayMs'. The main purpose of\n\t\t\t// 'executeOnce' is to handle multiple onNavigationCommitted callbacks being invoked in a short space of time.\n\t\t\ttab.executeOnce(function() {\n\t\t\t\t// Take a copy of the current URL and the new URL\n\t\t\t\tvar oldUrl = tab.url;\n\t\t\t\tvar newUrl = request.url;\n\n\t\t\t\t// Update the tab's URL with the one we're navigating to.\n\t\t\t\ttab.url = newUrl;\n\n\t\t\t\tconsole.log('onNavigationCommitted - ' + newUrl + ' (tabId=' + request.tabId + ')');\n\t\t\t\tconsole.log(oldUrl + ' -> ' + newUrl);\n\n\t\t\t\t// If the navigation stack is empty, the current tab has just been reloaded.\n\t\t\t\tif(tab.navigation.isEmpty()) {\n\t\t\t\t\tconsole.log('Navigation stack is empty, possible page reload / direct navigation.');\n\t\t\t\t\ttab.navigation.push(newUrl);\n\t\t\t\t}\n\n\t\t\t\t// Fixes a bug where a website is loaded through a Service Worker (https://developers.google.com/web/fundamentals/primers/service-workers/).\n\t\t\t\t// In this case, an onBeforeRequest event is emitted with a type of 'xmlhttprequest', rather than 'main_frame' resulting in the URL not being added\n\t\t\t\t// to the list of navigated URLs.\n\t\t\t\tif(!tab.navigation.contains(newUrl)) {\n\t\t\t\t\ttab.navigation.push(newUrl);\n\t\t\t\t}\n\n\t\t\t\ttab.navigation.log();\n\n\t\t\t\t// Now, check user state on GAYL and see if the current store is supported.\n\t\t\t\t// If any error occurs during either of these 2 steps, this.onError will be invoked.\n\t\t\t\tself.getAndUpdateUserState(request.tabId)\n\t\t\t\t\t.then(function(data){\n\t\t\t\t\t\tconsole.log('2. Checking if retailer is supported. (tabId=' + request.tabId + ')');\n\t\t\t\t\t\treturn self.checkRetailerSupported.bind(self)(data, tab.id);\n\t\t\t\t\t})\n\t\t\t\t\t.then(function(findStoreByUrlResponse) {\n\t\t\t\t\t\tconsole.log('3. Analysing API response. (tabId=' + request.tabId + ')');\n\t\t\t\t\t\treturn self.handleRetailerResponse.bind(self)(findStoreByUrlResponse, request.tabId);\n\t\t\t\t\t})\n\t\t\t\t\t.catch(self.onError.bind(self))\n\t\t\t\t\t.then(function() { // Should be .finally, but that's not supported in Safari.\n\t\t\t\t\t\tconsole.log('4. Finished checking retailer. (tabId=' + request.tabId + ')');\n\t\t\t\t\t\tself.updateIcon();\n\n\t\t\t\t\t\t// Clear the navigated URLs once the API request has finished, check the tab exists incase it gets removed from the tab map.\n\t\t\t\t\t\tif(tab) {\n\t\t\t\t\t\t\ttab.navigation.clear();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\t/**\n\t * Retreives the user's state on GAYL.com and either persists it (if they're logged in) or clears it (if they're logged out).\n\t * The reason it clears it if they're logged out is that they may have logged out of the website, and the extension needs to keep\n\t * in sync with the website.\n\t */\n\tgetAndUpdateUserState(tabId) {\n\t\tvar self = this;\n\t\tconsole.log('1. Checking user GAYL.com state. (tabId=' + tabId + ')');\n\t\treturn this.api.getState({useCache: true}).then(function(resp) {\n\t\t\tif(resp.user.loggedIn) {\n\t\t\t\treturn self.persistState(resp);\n\t\t\t} else {\n\t\t\t\t// If they aren't logged in, clear any existing state that might be cached / in-memory\n\t\t\t\treturn self.clearUserState();\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Persists user state in the persistent storage and Sentry context.\n\t */\n\tpersistState(getStateResponse) {\n\t\t// Save them in memory so we can access them using this.XXX\n\t\tthis.user = getStateResponse.user;\n\t\tthis.cause = getStateResponse.cause;\n\t\tthis.deviceSecurityCode = getStateResponse.deviceSecurityCode;\n\n\t\t// Add them to persistent storage too.\n\t\treturn this.storage.set({\n\t\t\t'deviceSecurityCode': getStateResponse.deviceSecurityCode,\n\t\t\t'user': getStateResponse.user,\n\t\t\t'cause': getStateResponse.cause\n\t\t});\n\t}\n\n\t/**\n\t * Clears all user state from the extension, including the persistent storage, the background page and the Sentry context.\n\t */\n\tclearUserState() {\n\t\tthis.storage.clear();\n\t\tthis.user = null;\n\t\tthis.cause = null;\n\t\tthis.deviceSecurityCode = null;\n\t}\n\n\t/**\n\t * This method is invoked when an error occurs during the retailer checking process, possible errors are:\n\t * - Request timeout or request cancelled (http_error_timeout_or_cancelled)\n\t * - API error (api_error), malformed request was sent to the server\n\t * - Tab deleted (tab_deleted), tab was closed whilst it was being processed.\n\t * - No navigated URLs (no_navigated_urls), no URLs were navigated through to get to this page.\n\t * If it's not one of these errors, it will be recorded to Sentry as a bug.\n\t */\n\tonError(err) {\n\t\t// Map of error types + their handler functions - currently they don't do anything, but they aren't fatal\n\t\t// errors. The extension still functions just fine - the errors were thrown to exit early from a promise chain.\n\t\t// In some situations we can't actually recover anyway, without somehow invoking onNavigationCommitted again to\n\t\t// retry.\n\t\tvar errorFns = {\n\t\t\t'api_error': function() {\n\t\t\t\tconsole.warn('API returned 4xx or 5xx');\n\t\t\t},\n\t\t\t'http_error_timeout_or_cancelled': function() {\n\t\t\t\tconsole.warn('HTTP error - request execeeded ' + Config.requestTimeoutMs + 'ms OR cancelled by browser.');\n\t\t\t},\n\t\t\t'tab_deleted': function() {\n\t\t\t\tconsole.warn('Tab was deleted whilst being processed.');\n\t\t\t},\n\t\t\t'no_navigated_urls': function() {\n\t\t\t\tconsole.warn('No navigated URLs - possible overlap');\n\t\t\t}\n\t\t};\n\n\t\tvar errorFn = errorFns[err.type];\n\n\t\t// If an error handling function was defined, invoke it.\n\t\tif(!isUndefined(errorFn)) {\n\t\t\terrorFn();\n\t\t} else {\n\t\t\tconsole.error(err);\n\t\t}\n\t}\n\n\t// Given a findStoreByUrlResponse, this method will return the store found in that response,\n\t// based on some rules...\n\t//\n\t// The rules are a bit odd, so I'll try to explain:\n\t// 1. If there's 1 store in the response, it means it's supported and will be returned.\n\t// 2. If there's more than one store, it means this store is only supported on specific paths\n\t// \t\ta) If the path matches the path of the current website, it will be returned.\n\t// \t\tb) If there are no matches, null will be returned.\n\textractStore(findStoreByUrlResponse, currentTab) {\n\t\tvar stores = findStoreByUrlResponse.list;\n\n\t\t// 1.\n\t\tif(stores.length === 1) {\n\t\t\treturn stores[0];\n\t\t}\n\n\t\t// 2.\n\t\t// See if the paths match\n\t\tvar currentTabUrl = currentTab.navigation.last().url;\n\n\t\tfor (var i = 0; i < stores.length; i++) {\n\t\t\tvar store = stores[i];\n\n\t\t\tif(currentTabUrl.indexOf(store.folder) > -1) {\n\t\t\t\treturn store;\n\t\t\t}\n\t\t}\n\n\t\t// No matched path\n\t\treturn null;\n\t}\n\n\t/**\n\t *\tThis is the main function that determines if the current website\n\t *\tis a supported retailer, and if we are allowed to inject our dialogs.\n\t *\tData is an object with the following keys:\n\t *\t- user, user info\n\t *\t- cause, user's cause info\n\t *\t- deviceSecurityCode\n\t */\n\tcheckRetailerSupported(data, tabId) {\n\t\tvar currentTab = this.tabs.find(tabId);\n\t\tif(!currentTab) {\n\t\t\tconsole.warn(tabId + ' not found before calling supported API.');\n\t\t\treturn Promise.reject(createError('tab_deleted'));\n\t\t}\n\n\t\t// Obtain the URLs the user navigated through.\n\t\tvar navigatedUrls = currentTab.navigation.currentUrls(true);\n\n\t\tif(this.isLoggedIn()) {\n\t\t\treturn this.api.findStoreByUrl(data.deviceSecurityCode, navigatedUrls);\n\t\t} else {\n\t\t\treturn this.api.findStoreByUrlAnonymous(navigatedUrls);\n\t\t}\n\t}\n\n\t/**\n\t * \tThis method is called when this.checkRetailerSupported has finished executing.\n\t *  It can be called multiple times for one website, for example:\n\t *  - User visits hobbs.co.uk <-- called once here\n\t *  - User clicks \"Yes\" on confirmation dialog, this sends them to the GAYL clickthrough\n\t *  - Clickthrough redirects user back to the hobbs.co.uk\n\t *  - onNavigationCommitted is fired again <-- called again here\n\t */\n\thandleRetailerResponse(findStoreByUrlResponse, tabId) {\n\t\t// Get a handle on the current tab, this may differ from the active tab if the user changes tabs whilst\n\t\t// this is being executed.\n\t\tvar currentTab = this.tabs.find(tabId);\n\n\t\t// If we couldn't get a handle on the current tab, we can't do anything as the tab doesn't exist / have state.\n\t\tif(!currentTab) {\n\t\t\tconsole.warn(tabId + ' not found when handling retailer response.');\n\t\t\treturn Promise.reject(createError(\"tab_deleted\"));\n\t\t}\n\n\t\t// Retailer wasn't found in the API\n\t\tif(!findStoreByUrlResponse.found) {\n\t\t\treturn this.handleRetailerNotSupported(currentTab);\n\t\t}\n\n\t\t// Extract the store from the response, see extractStore for more comments.\n\t\tvar store = this.extractStore(findStoreByUrlResponse, currentTab);\n\t\tif(store === null) {\n\t\t\treturn this.handleRetailerNotSupported(currentTab);\n\t\t}\n\n\t\t// Now the store is extracted from the response, check the existing tabs we have to see if\n\t\t// any of them have activated this store before. If they have, we can copy the tracking state across\n\t\t// so that it remains activated. There's no need to copy the state if the tracking status is BLANK.\n\t\tvar existingTabWithStore = this.tabs.findByStoreId(store.id, tabId);\n\t\tif(existingTabWithStore) {\n\t\t\tconsole.log('Store already exists in another tab.');\n\t\t\tconsole.log('Current tab status: ', currentTab.currentStatus());\n\t\t\tconsole.log('Existing tab status: ', existingTabWithStore.currentStatus())\n\t\t\tBrowserTab.copy(existingTabWithStore, currentTab);\n\t\t}\n\n\t\t // Check if the current store stored for this tab matches the store we found in the API.\n\t\t // If it doesn't match, it means the user has navigated to a new retailer, and we need to reset the\n\t\t // tracking status.\n\t\tif(!currentTab.isCurrentStore(store)) {\n\t\t\tconsole.log('User transitioned to a different store, resetting the state...');\n\t\t\tcurrentTab.status = StoreStatus.BLANK;\n\t\t}\n\n\t\t// Save the store from the API against the currently active tab.\n\t\tcurrentTab.currentStore = store;\n\n\t\t// If the navigated URLs look like a direct click (from either the GAYL website, or an email), we can handle it the same as if they clicked \"Yes\" on the confirmation dialog.\n\t\tif(currentTab.navigation.wasDirectClick()) {\n\t\t\t// Temporary fix to resolve a bug where findStoreByUrl caches an API response which changes between requests.\n\t\t\t// It only occurs when you activate a retailer which doesn't support the toolbar, since the standDown flag gets set to false temporarily\n\t\t\t// Allow toolbar retailer: standDown = false, allowToolbar = true, standDown gets set to false\n\t\t\t// Disallow toolbar retailer: standDown = false (when first URL was the clickthrough), allowToolbar = false, standDown gets set to true.\n\t\t\t// todo: remove this when I rewrite the way the current store gets looked up.\n\t\t\tconsole.log('Changing cached findStoreByUrl response... from ' + findStoreByUrlResponse.standDown + ' to ' + !currentTab.currentStore.allowToolbar);\n\t\t\tfindStoreByUrlResponse.standDown = !currentTab.currentStore.allowToolbar;\n\n\t\t\tthis.handleStatusTracking(currentTab);\n\t\t}\n\n\t\t// Finally perform some additional actions based on the status of this store.\n\t\tswitch(currentTab.currentStatus()) {\n\t\t\t// Store is already tracked\n\t\t\tcase StoreStatus.TRACKED:\n\t\t\t\t// Do nothing if it's already tracking\n\t\t\t\treturn;\n\t\t\t// User has clicked \"Yes\" on the confirmation dialog, has been redirected to the GAYL\n\t\t\t// clickthrough, which has sent them back to the retailer page, which invoked this method again.\n\t\t\tcase StoreStatus.TRACKING:\n\t\t\t\treturn this.handleStatusTracking(currentTab);\n\t\t\t// User has clicked \"No\" on the confirmation dialog\n\t\t\tcase StoreStatus.NOT_SUPPORTED:\n\t\t\t\treturn Promise.resolve();\n\t\t\t// User hasn't actioned this store yet.\n\t\t\tcase StoreStatus.BLANK:\n\t\t\t\treturn this.handleStatusBlank(findStoreByUrlResponse, currentTab);\n\t\t\tdefault:\n\t\t\t\treturn this.handleUnknownStatus();\n\t\t}\n\t}\n\n\t/**\n\t * Invoked when the status of the current tab is \"TRACKING\". The tab is in this state when the user has clicked \"YES\" on the confirmation dialog.\n\t */\n\thandleStatusTracking(currentTab) {\n\t\t// Activate the current tab.\n\t\tconsole.log('This store is in the process of being tracked.');\n\t\tcurrentTab.activeStore = currentTab.currentStore;\n\t\tcurrentTab.status = StoreStatus.TRACKED; // Change the status so the user doesn't see the thank you dialog again.\n\t\tthis.showThankYou(currentTab);\n\n\t\t// Activate any other tabs which contain this store.\n\t\t// todo: combine this with the above and do all tabs in one go\n\t\tconsole.log('Activating all other tabs...');\n\t\tthis.tabs.updateTabsWithMatchingStore(currentTab);\n\t\tvar tabs = this.tabs.findAllByStoreId(currentTab.currentStore.id, currentTab.id);\n\t\tconsole.log('Found this store in ' + tabs.length + ' other tabs.');\n\t\tthis.showThankYouForTabs(tabs);\n\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * Invoked when the status of the current tab is \"BLANK\".\n\t */\n\thandleStatusBlank(findStoreByUrlResponse, currentTab) {\n\t\t// Are we allowed to show the user the dialog?\n\t\t// todo: This should be moved out of here and next to the .found check in handleRetailerResponse.\n\t\tif(findStoreByUrlResponse.standDown) {\n\t\t\tconsole.log('Standing down...');\n\t\t\treturn;\n\t\t}\n\n\t\t// Yay! We're allowed to show the confirmation dialog\n\t\t// Note: The user's response to this dialog is handled in onMessage() - MessageSubject.RETAILER_CONFIRM and\n\t\t// MessageSubject.RETAILER_REJECT\n\t\tthis.showConfirmationDialog(currentTab.id, Object.assign({}, findStoreByUrlResponse.list[0]));\n\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * Invoked inside handleRetailerResponse when the retailer was not found in our API.\n\t */\n\thandleRetailerNotSupported(tab) {\n\t\ttab.status = StoreStatus.BLANK;\n\t\ttab.currentStore = {};\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * Invoked when the status of the current tab doesn't match our list of defined states.\n\t */\n\thandleUnknownStatus() {\n\t\treturn Promise.reject(new Error(\"Unknown status: \" + activeTab.currentStatus()));\n\t}\n\n\t/**\n\t * Sends a message to the content script in the given tab ID, instructing it to show the confirmation dialog.\n\t */\n\tshowConfirmationDialog(tabId, store) {\n\t\tvar message = new Message(MessageSubject.RETAILER_CONFIRMATION, {\n\t\t\tcause: this.cause,\n\t\t\tstore: store\n\t\t});\n\t\tthis.sendMessageToContentScript(tabId, message);\n\t}\n\n\t/**\n\t * Sends a message to the content script in the given tab ID, instructing it to hide the confirmation dialog.\n\t */\n\thideConfirmationDialog(tabId) {\n\t\tthis.sendMessageToContentScript(tabId, new Message(MessageSubject.HIDE_CONFIRMATION));\n\t}\n\n\t/**\n\t * Sends a message to the content script for each tab in the list, instructing it to hide the confirmation dialog.\n\t */\n\thideConfirmationDialogForTabs(tabs) {\n\t\tvar self = this;\n\t\ttabs.forEach(function(tab) {\n\t\t\tself.hideConfirmationDialog(tab.id);\n\t\t});\n\t}\n\n\t/**\n\t * Sends a message to the content script in the given tab, instructing it to show the thank you message.\n\t */\n\tshowThankYou(tab) {\n\t\tvar message = new Message(MessageSubject.RETAILER_THANKYOU, {\n\t\t\tcause: this.cause,\n\t\t\tstore: tab.activeStore\n\t\t});\n\t\tthis.sendMessageToContentScript(tab.id, message);\n\t}\n\n\t/**\n\t * Sends a message to the content script for each tab in the list, instructing it to show the thank you message.\n\t */\n\tshowThankYouForTabs(tabs) {\n\t\tvar self = this;\n\t\ttabs.forEach(function(tab) {\n\t\t\tself.showThankYou(tab);\n\t\t});\n\t}\n\n\t/**\n\t * Sends a message to the given tab ID\n\t */\n\tsendMessageToContentScript(tabId, message) {\n\t\tconsole.log('Sending content script message to tab(' + tabId + ') with message: subject=' +  message.subject + ' payload=' + logObject(message.payload));\n\t\tif(tabId) { // May be undefined if there is no active tab / tab reference\n\t\t\ttabs.sendMessage(tabId, message, function() {\n\t\t\t\t// This callback stops this error being thrown - \"The message port closed before a response was received.\". \n\t\t\t\t// From a quick bit of reading I'm not doing the async message passing correctly. I will revisit this as part of Manifest v3 refactoring.\n\t\t\t\t// An exception is thrown if this property if not checked in this callback, even if you decided to do nothing with it.\n\t\t\t\tif(runtime.lastError) {} else {}\n\t\t\t})\n\t\t}\n\t}\n\n\t/**\n\t * @return True if the user is logged in\n\t */\n\tisLoggedIn() {\n\t\treturn this.user && this.user.loggedIn;\n\t}\n\n\t/**\n\t * Called when the background page receives a message from a content script.\n\t */\n\tonMessage(message, sender, sendResponse) {\n\t\tif(!isTrusted(sender)) {\n\t\t\tconsole.log('Received an untrusted message from ' + sender.id);\n\t\t\treturn; // Only respond to messages sent by our extension\n\t\t}\n\t\tconsole.log('Background received message: ' + message.subject + ' with payload ' + logObject(message.payload));\n\t\tvar { payload, subject } = message;\n\t\tvar activeTab = this.tabs.activeTab;\n\t\tvar self = this;\n\n\t\t// Try and invoke the message handler, if an exception occurs it will be logged to Sentry.\n\t\ttry {\n\t\t\tswitch(subject) {\n\t\t\t\t// User has said \"yes\", they'd like to track their purchases.\n\t\t\t\tcase MessageSubject.RETAILER_CONFIRM:\n\t\t\t\t\tthis.onConfirmation(payload.extensionSource);\n\t\t\t\t\tbreak;\n\t\t\t\t// User doesn't want their purchases tracked.\n\t\t\t\tcase MessageSubject.RETAILER_REJECT:\n\t\t\t\t\tthis.onRejection();\n\t\t\t\t\tbreak;\n\t\t\t\t// Content script has requested the SERP extraction rules.\n\t\t\t\tcase MessageSubject.GET_SERP_RULES:\n\t\t\t\t\tthis.getSerpRules();\n\t\t\t\t\tbreak;\n\t\t\t\t// Content script has requested its extracted URLs be checked.\n\t\t\t\tcase MessageSubject.CHECK_SERP_URLS:\n\t\t\t\t\tconsole.log('Check serp URLS')\n\t\t\t\t\tthis.checkSerpUrls(payload);\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tconsole.warn('Unable to handle event - ' + subject);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t} catch(e) {\n\t\t\tconsole.error(e);\n\t\t}\n\t\treturn true;\n\t}\n\n\t/**\n\t * Fetches the SERP extraction rules from the API. These dictate how URLs should be extracted from SERPs.\n\t */\n\tgetSerpRules() {\n\t\tvar activeTab = this.tabs.activeTab;\n\t\tvar self = this;\n\t\tthis.api.getSerpRules().then(function(rules) {\n\t\t\t// todo: Will activeTab be sufficient? Or will we need the TAB ID that sent the message incase tab gets switched.\n\t\t\tself.sendMessageToContentScript(activeTab.id, new Message(MessageSubject.GET_SERP_RULES_RESPONSE, rules));\n\t\t\tconsole.log('API request finished: ', rules);\n\t\t}).catch(function() {}); // If we failed to fetch the rules there's nothing we can do. This prevents uncaught rejected promises being logged in Sentry.\n\t}\n\n\t/**\n\t * Checks the URLs in the payload to determine if they are supported by the GAYL website.\n\t *\n\t * Payload is an object in the format:\n\t * { urls: ['https://www.hmv.com', 'https://www.google.com', ...] }\n\t */\n\tcheckSerpUrls(payload) {\n\t\tvar activeTab = this.tabs.activeTab;\n\t\tvar self = this;\n\t\tconsole.log('Checking SERP URLs')\n\t\tthis.api.checkSerpUrls(payload).then(function(resp) {\n\t\t\tself.sendMessageToContentScript(activeTab.id, new Message(MessageSubject.CHECK_SERP_URLS_RESPONSE, resp));\n\t\t\tconsole.log('API request finished', resp);\n\t\t}).catch(function() {}); // // If we failed to check the URLs there's nothing we can do. This prevents uncaught rejected promises being logged in Sentry.\n\t}\n\n\t/**\n\t * Invoked when the user agrees to turn on the Donation Reminder.\n\t * This follows the clickthrough URL for this retailer, and also activates any other tabs with this retailer in.\n\t * @param source Where this click came from, possible values live inside ./shared/extension-source.js\n\t */\n\tonConfirmation(source) {\n\t\tvar activeTab = this.tabs.activeTab;\n\t\tactiveTab.activeStore = activeTab.currentStore;\n\t\tactiveTab.status = StoreStatus.TRACKING;\n\t\tconsole.log('User has confirmed the retailer - ' + logObject(activeTab.activeStore));\n\t\tconsole.log('They were on the URL ' + activeTab.url);\n\n\t\t// Deeplink = URL of the webpage the user was on when they clicked the confirmation prompt.\n\t\t// When visiting the clickthrough, if this paramter is present it will send them back to this link afterwards,\n\t\t// rather than dumping them on the homepage.\n\t\tvar deepLink = encodeURIComponent(activeTab.url);\n\n\t\tvisitClickthrough({\n\t\t\ttabId: activeTab.id,\n\t\t\turl: Config.gaylUrl + activeTab.activeStore.url + '&dl=' + deepLink,\n\t\t\tsource: source,\n\t\t\tclosePopup: false\n\t\t});\n\t}\n\n\t/**\n\t * Invoked when the user has said \"no\" to the Donation Reminder.\n\t */\n\tonRejection() {\n\t\t// Decline the currently active tab\n\t\tvar activeTab = this.tabs.activeTab;\n\t\tconsole.log('User has rejected the retailer - ' + logObject(activeTab.currentStore));\n\t\tactiveTab.activeStore = {};\n\t\tactiveTab.status = StoreStatus.NOT_SUPPORTED;\n\t\tthis.updateIcon();\n\t\tthis.hideConfirmationDialog(activeTab.id);\n\n\t\t// Decline any other tabs which contain this retailer\n\t\t// todo: combine this with the above and do all tabs in one go\n\t\tconsole.log('Declining all other tabs...');\n\t\tthis.tabs.updateTabsWithMatchingStore(activeTab);\n\t\tvar tabs = this.tabs.findAllByStoreId(activeTab.currentStore.id, activeTab.id);\n\t\tconsole.log('Found this store in ' + tabs.length + ' other tabs.');\n\t\tthis.hideConfirmationDialogForTabs(tabs);\n\t}\n\n\t/**\n\t * Updates the extension icon, based on the status of the current tab (i.e. turning it red / green)\n\t */\n\tupdateIcon() {\n\t\tvar activeTab = this.tabs.activeTab;\n\t\tswitch(activeTab.currentStatus()) {\n\t\t\t// Same icon for these two\n\t\t\tcase StoreStatus.BLANK:\n\t\t\tcase StoreStatus.NOT_SUPPORTED:\n\t\t\t\tsetBrowserIcon('inactive_', '.png');\n\t\t\t\tbreak;\n\t\t\t// Same icon for these two\n\t\t\tcase StoreStatus.TRACKING:\n\t\t\tcase StoreStatus.TRACKED:\n\t\t\t\tsetBrowserIcon('active_', '.png');\n\t\t\t\tbreak;\n\t\t\tdefault: // Can't handle these\n\t\t\t\tconsole.log('Unknown store status: ' + activeTab.currentStatus());\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t/**\n\t * Sets the uninstall URL, which will be opened when the extension is uninstalled (except for Safari, which doesn't have this mechanism).\n\t */\n\tsetUninstallUrl(url) {\n\t\t// Add some additional query string parameters to the uninstall URL, so that we know\n\t\t// which browser / version they were using when they uninstalled.\n\t\turl = url + '?browser=' + getBrowserName().toLowerCase() + '&version=' + Config.version();\n\t\truntime.setUninstallURL(url);\n\t}\n}\n\n/**\n * \tHelper functions\n */\nfunction isCurrentFrame(frameId) {\n\treturn frameId === 0;\n}\n\n/**\n * @return True if the given URL is blacklisted and shouldn't be processed.\n */\nfunction isBlacklisted(url) {\n\tvar re = new RegExp(Config.ignoredUrls, 'g');\n\tvar result = re.test(url);\n\treturn result;\n}\n\n/**\n * Used to determine if messages received inside 'onMessage' were actually sent by this extension.\n * This stops messages being sent from other extensions - even though the message handlers themselves do very little and can't really\n * be abused. If the message subject isn't recognised, it won't do anything.\n */\nfunction isTrusted(sender) {\n\tconsole.log('isTrusted(' + Config.extensionId() + ', ' + sender.id + ')');\n\n\t// First check if the extension ID matches\n\tif(Config.extensionId() === sender.id) {\n\t\treturn true;\n\t}\n\n\t// If no match it might be a synthetic event we've created when invoking the onMessage function manually.\n\tif(sender.id === 'synthetic') {\n\t\treturn true;\n\t}\n\n\t// Finally check if it's Firefox 48 - 52, none of the above conditions will return true because\n\t// the sender ID is the extension's internal ID, not the external ID. See this note in the docs\n\t// about it: https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/runtime/MessageSender -> id\n\t// An alternative is setting the extension ID explictly in manfiest.json, but I'm not sure of the implications for newer\n\t// Firefox versions, since the ID is not explictly defined anywhere, it's all managed through AMO.\n\tif(getBrowserName() === 'Firefox') {\n\t\treturn true;\n\t}\n\n\t// If no conditions match it's an untrusted message.\n\treturn false;\n}\n\n/**\n * @return True if the given URL is a Chrome new tab URL.\n */\nfunction isGoogleChromeNewTab(url) {\n\treturn url.indexOf('_/chrome') > -1;\n}\n\n/**\n * @return True if the given URL has a scheme we don't support / care about, e.g. chrome://, file://, etc.\n */\nfunction isIgnoredScheme(url) {\n\tfor (var i = 0; i < Config.ignoredSchemes.length; i++) {\n\t\tvar scheme = Config.ignoredSchemes[i];\n\t\tif(url.indexOf(scheme) === 0) {\n\t\t\treturn true;\n\t\t}\n\t}\n\treturn false;\n}\n\nmodule.exports = ExtensionCore;","/**\n * \tMain extension script.\n *\n *  It's instantiated ONCE when the extension is loaded (exactly when it's loaded is determined by the browser) and then sits in the background\n *  listening for events.\n *\n *  Note: Ideally this would be non-persistent, but webRequest doesn't support non-persistent background pages yet.\n *\n * \t@author Daniel Moffat\n */\nvar ExtensionCore = require('./lib/extension-core.js');\nvar InstallationListener = require('./lib/installation-listener.js');\nvar NotificationListener = require('./lib/notification-listener.js');\n\nvar { isAndroidApp } = require('./lib/shared/util.js');\n\nif(isAndroidApp()) {\n    // This connects to our Android app to get the FCM registration token so we can send it to our backend.\n    new NotificationListener();\n} else {\n    // React to extension installation / updates - not applicable to Android as that controls it's own update process.\n    new InstallationListener();\n}\n\n// Intialise the extension, which contains all of the logic.\n// We also export it so its methods can be accessed directly by the popup component.\nwindow.gaylExtension = new ExtensionCore();"],"sourceRoot":""}