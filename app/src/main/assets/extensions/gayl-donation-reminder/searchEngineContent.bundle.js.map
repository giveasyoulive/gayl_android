{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/extension/lib/shared/util.js","webpack:///./src/extension/lib/config.production.js","webpack:///./src/extension/lib/web-ext/runtime.js","webpack:///./src/extension/lib/shared/messages.js","webpack:///./src/extension/lib/shared/get-browser-name.js","webpack:///./src/extension/searchengine-content.js","webpack:///./src/extension/lib/shared/message.js","webpack:///./src/extension/lib/shared/get-mobile-os.js","webpack:///./src/extension/lib/config.common.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","r","value","n","__esModule","object","property","prototype","hasOwnProperty","p","s","Config","getBrowserName","getMobileOs","isArray","obj","toString","isSerp","url","patterns","length","match","isGiveasyouLive","test","dom","tagName","classNames","textContent","el","document","createElement","forEach","className","classList","add","contentScriptInitialise","contentScriptConstructor","condition","window","top","createError","type","err","Error","findParentWithClassName","currElement","element","contains","parentNode","arr","callback","getTimestamp","Date","now","getDayAndYear","getDay","getYear","getGaylUrl","path","gaylUrl","hasLeadingSlash","indexOf","getLastItem","hasProperties","props","prop","img","src","alt","insertAfter","newNode","referenceNode","insertBefore","nextSibling","isAndroidApp","isClickthrough","isGiveasyouLiveEmail","isMajorVersionUpdate","previousVersion","newVersion","previousVersionParts","split","newVersionParts","isString","isRetailerPage","isUndefined","input","undefined","logObject","out","key","markFavourites","stores","userFavourites","favouriteStoreIds","map","favourite","id","store","isFavourite","includes","removeChildren","node","hasChildNodes","firstChild","removeChild","text","createTextNode","toBoolean","str","truncateCauseName","cause","limit","len","truncatedName","substring","svgDom","createElementNS","whenDocumentReady","readyState","addEventListener","CommonConfig","assign","apiBase","apiBaseV2","env","gaylDomain","runtime","chrome","browser","POPUP_LOADING_ACCOUNT_OPTIONS","POPUP_LOADING_CAUSE_INFO","POPUP_LOADING_FAVOURITES","POPUP_LOADING_GLOBAL","POPUP_LOADING_SIMILAR_STORES","POPUP_LOADING_POPULAR_STORES","POPUP_LOADING_STORE_SEARCH","POPUP_NO_FAVOURITES","POPUP_NO_SIMILAR_STORES","POPUP_NO_SEARCH_RESULTS","ERROR_TIMEOUT_POPUP","ERROR_ACCOUNT_OPTION_LOAD","STORE_CONFIRMATION_DIALOG_QUESTION","STORE_CONFIRMATION_DIALOG_EARN_NEW_CUSTOMERS","STORE_CONFIRMATION_DIALOG_EARN","STORE_CONFIRMATION_DIALOG_YES","STORE_THANK_YOU_OK","STORE_THANK_YOU_INTRO","STORE_THANK_YOU_BODY_NEW_CUSTOMERS","STORE_THANK_YOU_BODY","SERP_BUTTON_TEXT","SERP_LINK_TEXT","API_ERROR_MESSAGES","InvalidCredentials","REQUEST_ERROR_MESSAGES","0","GENERIC_ERROR_MESSAGE","userAgentStr","ua","navigator","userAgent","Message","MessageSubject","debugEnabled","location","href","SerpContentScript","[object Object]","this","rules","host","hostname","extracted","domParser","DOMParser","bindEventHandlers","requestRules","onMessage","addListener","bind","visibleLink","title","console","log","sendMessage","GET_SERP_RULES","message","sender","sendResponse","payload","subject","GET_SERP_RULES_RESPONSE","onRulesReceived","CHECK_SERP_URLS_RESPONSE","onUrlsChecked","warn","addSerpClassToBodyElement","extractDelayMs","serpProvider","setTimeout","extract","e","CHECK_SERP_URLS","body","urls","injectGlobalCss","injectUi","containers","querySelectorAll","containerSelector","self","searchResult","donationRateTarget","querySelector","donationRateSelector","titleSelector","visibleLinkSelector","urlSelector","highlight","push","container","urlContainer","styleEl","appendChild","additionalCss","head","response","previouslyExtracted","merchant","resultContainer","notification","injectLogoAndStoreRate","injectTurnOnButton","logo","rate","rateText","replace","getStoreRateText","clickthroughUrl","createButton","max","parseFromString","documentElement","buttonText","button","colour","style","backgroundColor","RETAILER_CONFIRMATION","RETAILER_THANKYOU","HIDE_CONFIRMATION","REMOVE_ALL","RETAILER_CONFIRM","RETAILER_REJECT","isValidSubject","BROWSER_AUTH_HEADERS","Chrome","Firefox","Edge","Safari","apiAuthHeader","browserName","authHeader","extensionId","safari","ignoredSchemes","ignoredUrls","permissionsUrl","processingDelayMs","requestTimeoutMs","sentryDsn","thankYouDialogVisibleMs","uninstallUrl","version","getManifest"],"mappings":"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","file":"searchEngineContent.bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 43);\n","/**\n * \tUtility functions for various parts of the extension.\n *\n * \t@author Daniel Moffat\n */\n\nvar Config = require('../config.development.js');\nvar getBrowserName = require('./get-browser-name.js');\nvar getMobileOs = require('./get-mobile-os.js');\n\n/**\n * @return true if the given object has all of the properties specified in the props array.\n */\nfunction hasProperties(object, props) {\n\tif(!props || !props.length) {\n\t\treturn true;\n\t}\n\tprops.forEach(function(prop) {\n\t\tif(!object.hasOwnProperty(prop)) {\n\t\t\treturn false;\n\t\t}\n\t});\n\treturn true;\n}\n\n/**\n * @return True if the given string equals \"true\"\n */\nfunction toBoolean(str) {\n\treturn str === 'true'\n}\n\n/**\n * @return True if the given input is undefined. (Declared, but not defined.)\n */\nfunction isUndefined(input) {\n\treturn input === undefined;\n}\n\n/**\n * @return True if the given 'obj' is an array.\n */\nfunction isArray(obj) {\n\treturn Object.prototype.toString.call(obj) === '[object Array]';\n}\n\n/**\n * @return True if the given 'obj' is a string.\n */\nfunction isString(obj) {\n\treturn Object.prototype.toString.call(obj) === '[object String]';\n}\n\n/**\n *\tHelper method for iterating NodeList objects (or other objects that pretend to be arrays).\n *\tIn Chrome NodeList.prototype.forEach exists, but not in other browsers.\n *\n * \tInvokes 'callback' for each item in 'arr'.\n *\n */\nfunction forEach(arr, callback) {\n\tfor (var i = 0; i < arr.length; i++) {\n\t\tcallback(arr[i]);\n\t}\n}\n\n/**\n *  @return The first parent node which has the given 'className', or null if no parent is found.\n */\nfunction findParentWithClassName(currElement, className) {\n\tvar element = currElement;\n\twhile(!element.classList.contains(className)) {\n\t\telement = element.parentNode;\n\t\tif(element === null) { // No parent node, can't go any further.\n\t\t\treturn null;\n\t\t}\n\t}\n\treturn element;\n}\n\n/**\n * \tGiven a list of stores, will set the 'isFavourite' property on each store if they are also in\n * \t'userFavourites' (which is also a list of stores.).\n */\nfunction markFavourites(stores, userFavourites) {\n\tvar stores = stores || [];\n\tvar userFavourites = userFavourites || [];\n\tvar favouriteStoreIds = userFavourites.map(function(favourite) { return favourite.id } );\n\tstores.forEach(function(store) {\n\t\tstore.isFavourite = favouriteStoreIds.includes(store.id);\n\t});\n\treturn stores;\n}\n\n/**\n *\tWill invoke 'callback' when the document is ready.\n *\n * \tThis might be invoked when the document is still in a 'loading' state, so we need to check the ready state\n *  and either bind the callback to the 'DOMContentLoaded' event or just execute it straight away.\n */\nfunction whenDocumentReady(callback) {\n\tif(document.readyState === 'loading') { // Document not loaded yet.\n\t\tdocument.addEventListener('DOMContentLoaded', function() {\n\t\t\tcallback();\n\t\t});\n\t\treturn;\n\t}\n\n\t// Document already interactive\n\tcallback();\n}\n\n/**\n * @return An error object, with the given type as the 'type' property.\n */\nfunction createError(type) {\n\tvar err = new Error();\n\terr.type = type;\n\treturn err;\n}\n\n/**\n * @return True if the given 'url' matches that of a SERP (e.g. Google, Bing, Yahoo etc.)\n */\nfunction isSerp(url) {\n\tif(!url) return false;\n\n\tvar patterns = [\n\t\t/^(http|https):\\/\\/www.google.(co.uk|com)/g,\n\t\t/^(http|https):\\/\\/www.bing.com\\/search/g,\n\t\t/^(http|https):\\/\\/uk.search.yahoo.com\\/search/g\n\t];\n\n\tfor (var i = 0; i < patterns.length; i++) {\n\t\tif(url.match(patterns[i])) {\n\t\t\treturn true;\n\t\t}\n\t}\n\n\treturn false;\n}\n\n/**\n * @return True if the given url is a clickthrough URL\n */\nfunction isClickthrough(url) {\n\tif(!url) return false;\n\treturn url.indexOf('statistics/gayl/clickthrough') > 0;\n}\n\n/**\n * @return True if the given url is the GAYL website.\n */\nfunction isGiveasyouLive(url) {\n\tvar re = /https?:\\/\\/(.*)giveasyoulive.(com|uk)/g;\n\treturn re.test(url);\n}\n\n/**\n * @return True if the given url is a GAYL email URL.\n */\nfunction isGiveasyouLiveEmail(url) {\n\tif(!url) return false;\n\treturn url.indexOf('giveasyoulive-emails.com') > 0;\n}\n\n/**\n * @return True if the given URL is a retailer page, which is assumed\n * if !isGiveasyouLive and !isSerp, we don't have a more reliable (and quick)\n * method to test if a URL is a retailers.\n */\nfunction isRetailerPage(url) {\n\treturn !isGiveasyouLive(url) && !isSerp(url);\n}\n\n/**\n *\tIntialises a content script.\n *\n *  If the browser is Safari, the content script will only be initialised if condition is true.\n *  For all other browsers, the content script will be intialised straight away.\n *\n *  'condition' is needed because Safari doesn't support the whitelist/blocklist in their manifest file yet.\n */\nfunction contentScriptInitialise(contentScriptConstructor, condition) {\n\tif(window.top === window) {\n\t\tif(getBrowserName() === \"Safari\") {\n\t\t\tif(condition) {\n\t\t\t\tnew contentScriptConstructor();\n\t\t\t}\n\t\t} else {\n\t\t\tnew contentScriptConstructor();\n\t\t}\n\t}\n}\n\n/**\n * Helper function for creating DOM nodes in a non-verbose way.\n * @param  tagName, the name of the tag to create\n * @param  classNames, a single class name, or an array of class names to add to the node\n * @param  textContent The text content of the node.\n *\n * e.g.\n * dom('div', ['foo', 'bar'], 'Hello world!')\n * => <div class=\"foo bar\">Hello world!</div>\n */\nfunction dom(tagName, classNames, textContent) {\n\tvar el = document.createElement(tagName);\n\tif(isArray(classNames)) {\n\t\tclassNames.forEach(function(className) {\n\t\t\tif(className) {\n\t\t\t\tel.classList.add(className);\n\t\t\t}\n\t\t});\n\t} else {\n\t\tif(classNames) {\n\t\t\tel.classList.add(classNames);\n\t\t}\n\t}\n\n\tif(textContent) {\n\t\tel.textContent = textContent;\n\t}\n\n\treturn el;\n}\n\n/**\n * Helper function for creating <svg> elements (and their children, e.g. <path>, <circle>...).\n * You cannot just use dom for this. The resulting elements don't get rendered by the browser.\n */\nfunction svgDom(tagName, classNames) {\n\tvar el = document.createElementNS('http://www.w3.org/2000/svg', tagName);\n\tif(!classNames) return el;\n\n\tif(isArray(classNames)) {\n\t\tclassNames.forEach(function(className) {\n\t\t\tif(className) {\n\t\t\t\tel.classList.add(className);\n\t\t\t}\n\t\t})\n\t} else {\n\t\tel.classList.add(className);\n\t}\n\treturn el;\n}\n\n/**\n * Helper function for creating <img> elements\n * @param  src The image source\n * @param  alt The alt text\n */\nfunction img(src, alt, classNames) {\n\tvar i = dom('img', classNames);\n\ti.src = src;\n\ti.alt = alt;\n\treturn i;\n}\n\nfunction removeChildren(node) {\n\t// Make sure we have a valid node reference and it has children\n\tif(!node || !node.hasChildNodes()) {\n\t\treturn;\n\t}\n\n\twhile(node.firstChild) {\n\t\tnode.removeChild(node.firstChild);\n\t}\n}\n\n/**\n * Helper function for creating text nodes.\n */\nfunction text(text) {\n\treturn document.createTextNode(text);\n}\n\n/**\n * @return True if the new version is a major version upgrade from the previous version. A major\n * version upgrade is when any of the first two version numbers are greater than the previous version\n *\n * e.g:\n * isMajorVersionUpdate(\"6.0.0.0\", \"7.0.0.0\")\n * => true\n *\n * isMajorVersionUpdate(\"6.0.0.0\", \"6.1.0.0\")\n * => true\n *\n * isMajorVersionUpdate(\"6.0.0.0\", \"6.0.1.0\")\n * => false\n */\nfunction isMajorVersionUpdate(previousVersion, newVersion) {\n\tif(!newVersion) { return false; }\n\tif(!previousVersion && newVersion) { return true; }\n\tvar previousVersionParts = previousVersion.split(\".\");\n\tvar newVersionParts = newVersion.split(\".\");\n\n\tfor(var i = 0; i < previousVersionParts.length; i++) {\n\t\tif(newVersionParts[i] > previousVersionParts[i]) {\n\t\t\treturn true;\n\t\t}\n\n\t\t// Only check the first two numbers, the last two are minor versions\n\t\tif(i === 1) {\n\t\t\treturn false;\n\t\t}\n\t}\n}\n\n/**\n * @return UNIX timestamp for the current date.\n */\nfunction getTimestamp() {\n\treturn Date.now();\n}\n\n/**\n * @return The current day and year joined with a '-', e.g. For 1st Jan 2018, you'd get '1-2018'\n */\nfunction getDayAndYear() {\n\tvar d = new Date();\n\n\treturn (d.getDay() + 1) + '-' + (d.getYear() + 1900);\n}\n\n/**\n * Given an object, will return its string representation. Doesn't work very well if the value is an object / array.\n * e.g. logObject({foo: 'bar', baz: 'boo'})\n * => 'foo:bar,baz:boo'\n */\nfunction logObject(obj) {\n\tif(!obj) return '';\n\tvar out = '';\n\n\tfor(var key in obj) {\n\t\tif(obj.hasOwnProperty(key)) {\n\t\t\tout += (key + ':' + obj[key] + ',')\n\t\t}\n\t}\n\n\treturn out;\n}\n\n/**\n * Given an array, will return last item\n * @return The last item, or null if the given array is not an actual array or doesn't\n * contain any items.\n */\nfunction getLastItem(arr) {\n\tif(!isArray(arr)) {\n\t\treturn null;\n\t}\n\n\tif(arr.length == 0) {\n\t\treturn null;\n\t}\n\n\treturn arr[arr.length - 1];\n}\n\n/**\n * @param path Path to the resource on the GAYL website. A leading slash will be added if not already present.\n * @return The absolute URL to the path\n * e.g.\tgetGaylUrl('/foo/bar')\n * => 'https://www.giveasyoulive.com/foo/bar' for prod\n * => 'https://www.giveasyoulive.uk/foo/bar' for test\n */\nfunction getGaylUrl(path) {\n\tif(!path) return Config.gaylUrl;\n\tvar hasLeadingSlash = path.indexOf('/') === 0;\n\n\treturn Config.gaylUrl + (hasLeadingSlash ? '' : '/') + path;\n}\n\n/**\n * Inserts the given newNode after the given referenceNode\n */\nfunction insertAfter(newNode, referenceNode) {\n    referenceNode.parentNode.insertBefore(newNode, referenceNode.nextSibling);\n}\n\n// Given a cause object, will add a \"truncatedName\" property\nfunction truncateCauseName(cause, limit) {\n\tvar len = cause.name.length;\n\tvar suffix = '...';\n\n\tif(len < limit) {\n\t\tcause.truncatedName = cause.name;\n\t} else {\n\t\tcause.truncatedName = cause.name.substring(0, limit - suffix.length) + suffix;\n\t}\n\n\treturn cause;\n}\n\nfunction isAndroidApp() {\n\treturn getBrowserName() === 'Firefox' && getMobileOs() === 'Android';\n}\n\nmodule.exports = {\n\tcontentScriptInitialise,\n\tcreateError,\n\tdom,\n\tfindParentWithClassName,\n\tforEach,\n\tgetTimestamp,\n\tgetDayAndYear,\n\tgetGaylUrl,\n\tgetLastItem,\n\thasProperties,\n\timg,\n\tinsertAfter,\n\tisAndroidApp,\n\tisArray,\n\tisClickthrough,\n\tisGiveasyouLive,\n\tisGiveasyouLiveEmail,\n\tisMajorVersionUpdate,\n\tisSerp,\n\tisString,\n\tisRetailerPage,\n\tisUndefined,\n\tlogObject,\n\tmarkFavourites,\n\tremoveChildren,\n\ttext,\n\ttoBoolean,\n\ttruncateCauseName,\n\tsvgDom,\n\twhenDocumentReady\n};","/**\n * \tProduction configuration\n *\n * \t@author Daniel Moffat\n */\n\nconst CommonConfig = require('./config.common.js');\nconst GAYL_DOMAIN = \"giveasyoulive.com\";\n\nmodule.exports = Object.assign({ ...CommonConfig }, {\n\tapiBase: `https://www.${GAYL_DOMAIN}/api/v1/`,\n\tapiBaseV2: `https://www.${GAYL_DOMAIN}/api/v2/`,\n\tenv: 'production',\n\tgaylDomain: GAYL_DOMAIN,\n\tgaylUrl: `https://www.${GAYL_DOMAIN}`,\n});","/**\n *\tWebExtensions runtime API polyfill.\n *\n * \t@author Daniel Moffat\n */\nvar runtime;\n\n// Firefox / Chrome\nif('undefined' !== typeof chrome && chrome.runtime) {\n\truntime = chrome.runtime;\n}\n\n// Microsoft Edge\nif('undefined' !== typeof browser && browser.runtime) {\n\truntime = browser.runtime;\n}\n\nmodule.exports = runtime;","/**\n * \tExtension messages.\n *\n * \tThese are generally added to the DOM using element.textContent = message, so you can't use\n * \tHTML in them - if you need to use HTML, code will need to written for the template the text is used in.\n *\n * \tSome of them also have placeholders available, e.g. $$causeName$$\n *\n *  @author Daniel Moffat\n */\n\nmodule.exports = {\n\t/**\n\t * General popup messages\n\t */\n\tPOPUP_LOADING_ACCOUNT_OPTIONS: 'Loading account...',\n\tPOPUP_LOADING_CAUSE_INFO: 'Loading cause...',\n\tPOPUP_LOADING_FAVOURITES: 'Loading favourites...',\n\tPOPUP_LOADING_GLOBAL: 'Loading...please wait.',\n\tPOPUP_LOADING_SIMILAR_STORES: 'Loading similar stores...',\n\tPOPUP_LOADING_POPULAR_STORES: 'Loading popular stores...',\n\tPOPUP_LOADING_STORE_SEARCH: 'Searching...',\n\tPOPUP_NO_FAVOURITES: 'No favourite stores yet. Why not try adding some?',\n\tPOPUP_NO_SIMILAR_STORES: 'No similar stores were found for this retailer.',\n\t// $$query$$ will be replaced with the users search query and wrapped in a <strong> tag.\n\tPOPUP_NO_SEARCH_RESULTS: 'No results found for $$query$$.',\n\n\t/**\n\t * Popup error messages\n\t */\n\n\tERROR_TIMEOUT_POPUP: 'An error occured, please close, and re-open this popup. If the problem persists, please let us know @ help@everyclick.com',\n\tERROR_ACCOUNT_OPTION_LOAD: 'Failed to load, please re-open to try again.',\n\n\t/**\n\t * Retailer page (aka retailer content script) messages\n\t */\n\t// $$causeName$$ will be replaced with the users current cause name\n\tSTORE_CONFIRMATION_DIALOG_QUESTION: 'Would you like your purchase to raise a donation for $$causeName$$?',\n\tSTORE_CONFIRMATION_DIALOG_EARN_NEW_CUSTOMERS: 'Earn up to $$maxStoreRate$$ with $$storeName$$ if you\\'re a new customer',\n\tSTORE_CONFIRMATION_DIALOG_EARN: 'Earn up to $$maxStoreRate$$ with $$storeName$$',\n\tSTORE_CONFIRMATION_DIALOG_YES: 'Raise a donation',\n\tSTORE_THANK_YOU_OK: 'OK, got it',\n\tSTORE_THANK_YOU_INTRO: 'Thank you.',\n\n\t// Thank you message for retailers which only pay commission for new customers only\n\tSTORE_THANK_YOU_BODY_NEW_CUSTOMERS: 'If you\\'re a new customer, purchases can raise up to $$maxStoreRate$$ of your total purchase for $$causeName$$.',\n\n\t// Thank you message for the other retailers\n\tSTORE_THANK_YOU_BODY: 'Purchases can raise up to $$maxStoreRate$$ of your total purchase for $$causeName$$.',\n\n\t/**\n\t * SERP messages\n\t */\n\tSERP_BUTTON_TEXT: 'Shop & raise up to $$maxStoreRate$$ >',\n\tSERP_LINK_TEXT: 'Donates up to $$maxStoreRate$$',\n\n\t/**\n\t * Custom API error messages\n\t */\n\tAPI_ERROR_MESSAGES: {\n\t\t'InvalidCredentials': 'Invalid email or password.'\n\t},\n\n\t/**\n\t * XmlHttpRequest status code error messages.\n\t */\n\n\tREQUEST_ERROR_MESSAGES: {\n\t\t// This happens when:\n\t\t// - User has dodgy / slow internet connection\n\t\t// - Our API took way too long to respond\n\t\t0: 'The request timed out, please try again.'\n\n\t},\n\n\t/**\n\t * Everything else\n\t */\n\n\t// Generic error message that's used when a more appropriate message isn't available. This should only ever be seen\n\t// for errors which haven't been catered for / expected - which explains why it's so unhelpful.\n\tGENERIC_ERROR_MESSAGE: 'An error occurred.'\n};","/**\n * \tDetects which browser the extension is currently running in.\n *\n * \tCode is pretty much directly lifted from the 'bowser' lib: https://github.com/lancedikson/bowser/blob/master/src/bowser.js\n *\n * \t@author Daniel Moffat\n */\n\nfunction getBrowserName(userAgentStr) {\n\tvar ua = userAgentStr || navigator.userAgent;\n\n\tif(/edg([ea]|ios)/i.test(ua)) {\n\t\treturn 'Edge';\n\t} else if(/chrome|crios|crmo/i.test(ua)) {\n\t\treturn 'Chrome';\n\t} else if(/safari|applewebkit/i.test(ua)) {\n\t\treturn 'Safari';\n\t} else if(/firefox|iceweasel|fxios/i.test(ua)) {\n\t\treturn 'Firefox';\n\t} else {\n\t\t// No match\n\t\treturn null;\n\t}\n}\n\nmodule.exports = getBrowserName;","/**\n * \tContent script for the search engine pages.\n *\n * \tThis script is responsible for augmenting the SERP it executes on by adding our logo / rate alongside\n * \tall stores which are supported on our website.\n *\n * \tIt follows the rules specified @ https://www.giveasyoulive.[tld]/api/v1/serp/rules\n *\n * \tHow it works:\n * \t1. Loads the SERP rules when the extension is first loaded\n * \t2. When on a search engine page...\n * \t\t- Extracts all search engine result URLs, as well as keeping a copy of where these URLs live in the DOM\n * \t\t- Calls the API with the collected URLs checking if they're supported\n * \t\t- If the store is supported, we add our own elements to the page using the previously kept references.\n *\n * \t@author Daniel Moffat\n */\n\nvar styles = require('./styles/less/serp.less');\n\nvar { Message, MessageSubject } = require('./lib/shared/message.js');\nvar { SERP_BUTTON_TEXT, SERP_LINK_TEXT } = require('./lib/shared/messages.js');\nvar { \n\tcontentScriptInitialise,\n\tdom,\n\tforEach,\n\tinsertAfter,\n\tisSerp,\n\ttext,\n\twhenDocumentReady\n} = require('./lib/shared/util.js');\nvar Config = require('./lib/config.development.js');\nvar runtime = require('./lib/web-ext/runtime.js');\n\n\n\n// Allow this content script to be debugged using a query param.\nvar debugEnabled = window.location.href.indexOf('debug=true') > -1;\n\nclass SerpContentScript {\n\tconstructor() {\n\t\t// The rules for this host, the rules specify which things should be extracted from the page.\n\t\tthis.rules = null;\n\n\t\t// The host we're currently on\n\t\tthis.host = window.location.hostname;\n\n\t\t// A list of extracted items, each entry has the following structure:\n\t\t// {\n\t    //  \t\"title\": <title DOM element>,\n\t    //  \t\"visibleLink\": <visible link DOM element>,\n\t    //  \t\"url\": 'http://the-extracted-url.com'\n\t\t// }\n\t\tthis.extracted = [];\n\n\t\t// Used to unescape HTML entities\n\t\tthis.domParser = new DOMParser();\n\n\t\tthis.bindEventHandlers();\n\n\t\t// Request the extraction rules from the background page.\n\t\tthis.requestRules();\n\t}\n\n\t/**\n\t * Listen for messages from the background page.\n\t */\n\tbindEventHandlers() {\n\t\truntime.onMessage.addListener(this.onMessage.bind(this));\n\t}\n\n\t/**\n\t * Logs the extracted URLs / visible links / titles in a human-readable way\n\t */\n\tlog() {\n\t\tfor (var i = 0; i < this.extracted.length; i++) {\n\t\t\tvar { url, visibleLink, title } = this.extracted[i];\n\t\t\tconsole.log((i + 1), title.textContent, url);\n\t\t}\n\t}\n\n\t/**\n\t * Requests the SERP extraction rules from the background page.\n\t */\n\trequestRules() {\n\t\truntime.sendMessage(new Message(MessageSubject.GET_SERP_RULES));\n\t}\n\n\t/**\n\t * Fired when a messages is received from the background page.\n\t */\n\tonMessage(message, sender, sendResponse) {\n\t\tvar { payload, subject } = message;\n\t\tconsole.log('SERP content script received message', message);\n\t\tswitch(subject) {\n\t\t\tcase MessageSubject.GET_SERP_RULES_RESPONSE:\n\t\t\t\tthis.onRulesReceived(message);\n\t\t\t\tbreak;\n\t\t\tcase MessageSubject.CHECK_SERP_URLS_RESPONSE:\n\t\t\t\tthis.onUrlsChecked(payload);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tconsole.warn('Unable to handle event - ' + subject);\n\t\t\t\tbreak;\n\t\t}\n\t\treturn true;\n\t}\n\n\t/**\n\t * Fired when the rulesh have been received from the background page.\n\t * @param A message whose 'payload' property contains the SERP rules.\n\t */\n\tonRulesReceived(message) {\n\t\t// Extract the specific ruleset for this host from the message (i.e. On Google, pull out the Google rules, on Bing, the bing rules etc.)\n\t\tthis.rules = message.payload[this.host] || null;\n\t\tif(this.rules === null) {\n\t\t\tconsole.log('No rules found for host:', this.host);\n\t\t\treturn;\n\t\t}\n\n\n\t\tthis.addSerpClassToBodyElement();\n\n\t\tvar extractDelayMs = (this.rules.serpProvider === 'YAHOO' ? 100 : this.rules.serpProvider === 'DUCKDUCKGO' ? 800 : 0);\n\n\t\t// After a delay, extract the URLs from the page and send them to the background page for analysis.\n\t\t// Note: Yahoo change their URLs on page load, so a small delay has been added to ensure the URLs have been changed\n\t\t// before this script runs, otherwise we end up with a bunch of URLs we cannot process.\n\t\tsetTimeout(function() {\n\n\t\t\t// Using the ruleset, extract the URLs from the page\n\t\t\tif(!this.extract()) {\n\t\t\t\tif(debugEnabled) {\n\t\t\t\t\tconsole.log('Failed to extract URLs from SERP', this.rules, this.host)\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Send another message to the background page with the URLs we just extracted\n\t\t\tvar payload = this.extracted.map(function(e) { return {url: e.url} });\n\t\t\truntime.sendMessage(new Message(MessageSubject.CHECK_SERP_URLS, payload));\n\n\t\t}.bind(this), extractDelayMs)\n\t}\n\n\taddSerpClassToBodyElement() {\n\t\tdocument.body.classList.add('gayl-serp-' + this.rules.serpProvider);\n\t}\n\n\t/**\n\t * Fired when the extracted URLs have been checked by the background page.\n\t */\n\tonUrlsChecked(urls) {\n\t\tthis.injectGlobalCss();\n\t\tthis.injectUi(urls);\n\t}\n\n\t/**\n\t * Uses a ruleset to extract metadata from the page.\n\t * @return True if something was extracted, or false if nothing was extracted\n\t */\n\textract() {\n\t\tconsole.log('Extracting URLs from:', this.host, 'using rules:', this.rules);\n\n\t\t// First select the result elements\n\t\tvar containers = document.querySelectorAll(this.rules.containerSelector);\n\n\t\tvar self = this;\n\n\t\t// For each one, pull out the data we need\n\t\tforEach(containers, function(searchResult) {\n\n\t\t\t// These selectors are relative to searchResult, so can be very broad\n\t\t\tvar donationRateTarget = searchResult.querySelector(self.rules.donationRateSelector);\n\t\t\tvar title = searchResult.querySelector(self.rules.titleSelector);\n\t\t\tvar visibleLink = searchResult.querySelector(self.rules.visibleLinkSelector);\n\t\t\tvar url = searchResult.querySelector(self.rules.urlSelector);\n\n            // Only process items that have a title and visible link.\n            if(title && visibleLink) {\n\n                highlight(url, '#ff919154');\n                highlight(visibleLink, '#91ffb454');\n                highlight(title, '#ff919154');\n                highlight(searchResult, '#ccc');\n\n                self.extracted.push({\n                    container: searchResult,\n                    title: title,\n                    visibleLink: visibleLink,\n                    url: url.href,\n                    urlContainer: url,\n                    donationRateTarget: donationRateTarget\n                });\n            }\n\t\t});\n\n\t\tif(debugEnabled) {\n\t\t\tconsole.log('Extracted:');\n\t\t\tthis.log();\n\t\t}\n\n\t\t// Only return true if we actually found URLs, there's no point calling the API otherwise.\n\t\treturn this.extracted.length > 0;\n\t}\n\n\tinjectGlobalCss() {\n\t\tvar styleEl = dom('style');\n\t\tstyleEl.type = 'text/css';\n\t\tstyleEl.appendChild(text(this.rules.additionalCss));\n\t\tdocument.head.appendChild(styleEl);\n\t}\n\n\t/**\n\t *\t@param urls, a list of URLs + their associated store / merchant object. Structure looks like this:\n\t *\t[\n\t *\t\t{\n\t *\t\t\turl: \"the url\",\n\t *\t\t\tmerchant: {\n\t *\t\t\t\t...\n\t *\t\t\t}\n\t *\t\t}\n\t *\t]\n\t */\n\tinjectUi(urls) {\n\t\tfor(var i = 0; i < urls.length; i++) {\n\t\t\tvar response = urls[i];\n\t\t\tvar previouslyExtracted = this.extracted[i];\n\t\t\tvar store = response.merchant;\n\n\t\t\t// Grab the DOM elements we extracted previously to insert the GAYL stuff\n\t\t\tvar title = previouslyExtracted.title;\n\t\t\tvar visibleLink = previouslyExtracted.visibleLink;\n\t\t\tvar resultContainer = previouslyExtracted.container;\n\t\t\tvar urlContainer = previouslyExtracted.urlContainer;\n\t\t\tvar donationRateTarget = previouslyExtracted.donationRateTarget;\n\n\t\t\t// Bail out if we couldn't match an item from the response to something we previously extracted.\n\t\t\tif(!title || !visibleLink) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Are we allowed to inject for this store?\n\t\t\tvar canInject = store && store.notification === 'Y';\n\n\t\t\tif(canInject) {\n\t\t\t\tthis.injectLogoAndStoreRate(donationRateTarget, store);\n\t\t\t\tthis.injectTurnOnButton(resultContainer, store);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Injects the logo/store rate elements into the page.\n\t */\n\tinjectLogoAndStoreRate(donationRateTarget, store) {\n\t\tvar logo = dom('span', 'gayl-logo');\n\t\tvar rate = dom('span', 'gayl-store-rate');\n\t\tvar rateText = SERP_LINK_TEXT.replace('$$maxStoreRate$$', this.getStoreRateText(store));\n\t\trate.appendChild(text(rateText));\n\n\t\t// MUST be an 'a' element (or anything not a div/span) because bing have overridden document.createElement which\n\t\t// causes some strange behaviour where the element never gets appended to the document...spent over an hour trying to\n\t\t// figure out why and work around it, but couldn't figure it out.\n\t\tvar container = dom('a', 'gayl-container')\n\t\tcontainer.href = store.clickthroughUrl;\n\t\tcontainer.appendChild(logo);\n\t\tcontainer.appendChild(rate);\n\n\t\tinsertAfter(container, donationRateTarget);\n\t}\n\n\t/**\n\t * @param  resultContainer The individual search engine result container\n\t * @param  store The retailer being injected\n\t */\n\tinjectTurnOnButton(resultContainer, store) {\n\t\tinsertAfter(this.createButton(store), resultContainer);\n\t}\n\n\t/**\n\t * Given a store object, will return the rate. This is only necessary because £ is sent through as &pound;\n\t */\n\tgetStoreRateText(store) {\n\t\tif(!store || !store.max) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.domParser.parseFromString(store.max, 'text/html').documentElement.textContent;\n\t}\n\n\tcreateButton(store) {\n\t\tif(!store || !store.max) {\n\t\t\treturn;\n\t\t}\n\t\tvar buttonText = SERP_BUTTON_TEXT.replace('$$maxStoreRate$$', this.getStoreRateText(store));\n\t\tvar button = dom('a', ['btn', 'btn-success', 'gayl-button'], buttonText);\n\t\tbutton.href = store.clickthroughUrl;\n\n\t\treturn button;\n\t}\n}\n\nfunction highlight(element, colour) {\n\tif(debugEnabled && element != null && element.style) {\n\t\telement.style.backgroundColor = colour;\n\t}\n}\n\n// Chrome / FF / Edge execute the content script at 'document_end', which is defined as:\n// \"Scripts are injected immediately after the DOM is complete, but before subresources like images and frames have loaded.\"\n// but Safari doesn't have this mechanism, so we have to manually check ourselves.\nwhenDocumentReady(function() {\n\tcontentScriptInitialise(SerpContentScript, isSerp(window.location.href));\n});","/**\n * \tModel for messages that are sent between extension components (i.e. background page, content scripts, etc).\n *\n * \t@author Daniel Moffat\n */\n\n/**\n * Defines the various message subjects and what they mean.\n */\nvar MessageSubject = {\n\t/**\n\t * Background page => Content script\n\t */\n\n\t// Inject the confirmation UI into the retailer page\n\tRETAILER_CONFIRMATION: 'RETAILER_CONFIRMATION',\n\n\t// Inject the thank you UI into the retailer page\n\tRETAILER_THANKYOU: 'RETAILER_THANKYOU',\n\n\t// Hide the confirmation UI\n\tHIDE_CONFIRMATION: 'HIDE_CONFIRMATION',\n\n\t// Remove all injected dialogs from the page\n\tREMOVE_ALL: 'REMOVE_ALL',\n\n\t// Contains the SERP rules\n\tGET_SERP_RULES_RESPONSE: 'GET_SERP_RULES_RESPONSE',\n\n\t// Contains the extracted SERP URLs and whether they are supported on our site or not.\n\tCHECK_SERP_URLS_RESPONSE: 'CHECK_SERP_URLS_RESPONSE',\n\n\t/**\n\t *\tContent script => Background page\n\t */\n\n\t// User wants to activate this retailer\n\tRETAILER_CONFIRM: 'RETAILER_CONFIRM',\n\n\t// User doesn't want to activate this retailer\n\tRETAILER_REJECT: 'RETAILER_REJECT',\n\n\t// Request SERP rules\n\tGET_SERP_RULES: 'GET_SERP_RULES',\n\n\t// Check extracted SERP URLs\n\tCHECK_SERP_URLS: 'CHECK_SERP_URLS'\n};\n\nfunction Message(subject, payload) {\n\tvar payload = payload || {};\n\t// Only allows certain messages that we're certain can be handled.\n\tif(this.isValidSubject(subject)) {\n\t\t// Tells the other end what this message is for.\n\t\tthis.subject = subject;\n\t}\n\n\t// Some data sent with this message\n\tthis.payload = payload;\n}\n\nMessage.prototype.isValidSubject = function(subject) {\n\tif(!MessageSubject[subject]) {\n\t\tthrow new Error(\"Unknown message subject: \" + subject);\n\t}\n\treturn true;\n}\n\nmodule.exports = {\n\tMessage,\n\tMessageSubject\n};","/**\n * \tDetects which mobile operating system is used\n *\n * \t@author Gareth Evans\n */\n\nfunction getMobileOS(userAgentStr) {\n\tvar ua = userAgentStr || navigator.userAgent;\n\n    if(/windows phone/i.test(ua)) {\n\t\treturn 'Windows';\n\t} else if(/android/i.test(ua)) {\n\t\treturn 'Android';\n\t} else if(/iPad|iPhone|iPod/i.test(ua)) {\n\t\treturn 'iOS';\n\t} else {\n\t\t// No match\n\t\treturn null;\n\t}\n}\n\nmodule.exports = getMobileOS;","/**\n * \tCommon extension configuration, shared between both production / development builds.\n *\n * \t@author Daniel Moffat.\n */\n\nvar getBrowserName = require('./shared/get-browser-name.js');\nvar runtime = require('./web-ext/runtime.js');\n\n // Map of browser name => auth header\n var BROWSER_AUTH_HEADERS = {\n \t'Chrome': 'R0FZTF9CUk9XU0VSX0VYVF9DSFJPTUU6MnZMTG4qSkpyX3ZEOT1hKg==',\n \t'Firefox': 'R0FZTF9CUk9XU0VSX0VYVF9GSVJFRk9YOnRBM3lOWEJQWmR1YyVHTG0=',\n \t'Edge': 'R0FZTF9CUk9XU0VSX0VYVF9FREdFOmZ2Qmg4VHdMUDRHelNTQFI=',\n \t'Safari': 'R0FZTF9CUk9XU0VSX0VYVF9TQUZBUkk6LTZyRHZBJGREeHFHOW45Pw==',\n };\n\nmodule.exports = {\n\t// Auth header used for API calls\n\tapiAuthHeader: function() {\n\t\tvar browserName = getBrowserName();\n\t\tvar authHeader = BROWSER_AUTH_HEADERS[browserName];\n\t\tif(!authHeader) {\n\t\t\tthrow new Error('Cannot find auth header for ' + browserName);\n\t\t}\n\t\treturn 'Basic ' + authHeader;\n\t},\n\textensionId: function(){\n\t\t// Edge actually has this property on their window object, so we need\n\t\t// to check if 'runtime' property exists to see if it's actually Chrome...\n\t\tif(typeof chrome !== 'undefined' && chrome.runtime) {\n\t\t\treturn chrome.runtime.id;\n\t\t}\n\n\t\t// Safari doesn't have it's own extension ID, so we have to create a fake one.\n\t\tif(typeof safari !== 'undefined') {\n\t\t\treturn 'synthetic';\n\t\t}\n\n\t\treturn browser.runtime.id\n\t},\n\n\t// Schemes that shouldn't be processed by the extension\n\tignoredSchemes: [\n\t\t'about',\n\t\t'chrome',\n\t\t'chrome-extension',\n\t\t'file',\n\t\t'view-source',\n\t\t'wyciwyg',\n\t\t'favorites'\n\t],\n\n\t// URLs that shouldn't be processed by the extension\n\tignoredUrls: '(?:shareasale.com|paypal.(?:co.uk|com)|successfultogether.co.uk|tradedoubler.com|clkuk.pvnsolutions.com|paidonresults.net|linksynergy.com|doubleclick.net|affiliatefuture.com|omguk.com|healthtrader.com|digitalriver.com|veinteractive.com|track.webgains.com|jdoqocy.com)',\n\n\t// Where the instructions live for changing your browser extension permissions.\n\tpermissionsUrl: 'https://help.giveasyoulive.com/hc/en-us/articles/360017448352-New-Chrome-update-Donation-Reminder',\n\n\t// How long to wait (ms) before processing the navigation committed event.\n\tprocessingDelayMs: 1000,\n\n\t// How long to wait (ms) before cancelling pending HTTP requests\n\trequestTimeoutMs: 7000,\n\n\t// Sentry DSN (Data Source Name) - https://docs.sentry.io/quickstart/#configure-the-dsn\n\tsentryDsn: 'https://7a19d517524a4954bb10e4bc21e4a4a9@sentry.io/1270266',\n\n\t// How long to show the thank you dialog (ms) before hiding.\n\tthankYouDialogVisibleMs: 7000,\n\n\t// The webpage a user is sent to after uninstalling\n\tuninstallUrl: 'https://r1.dotmailer-surveys.com/7e21zb6c-623a1ufe',\n\n\t// Function that returns the currently installed version of the Donation Reminder.\n\tversion: function() {\n\t\treturn runtime.getManifest().version;\n\t}\n};"],"sourceRoot":""}