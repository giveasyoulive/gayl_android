{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/extension/lib/shared/util.js","webpack:///./src/extension/lib/config.production.js","webpack:///./src/extension/lib/web-ext/runtime.js","webpack:///./src/extension/lib/templates/icons/right-arrow.js","webpack:///./src/extension/lib/shared/extension-source.js","webpack:///./src/extension/lib/shared/messages.js","webpack:///./src/extension/lib/shared/get-browser-name.js","webpack:///./src/extension/lib/templates/retailer/thank-you.js","webpack:///./src/extension/lib/templates/retailer/confirmation-prompt.js","webpack:///./src/extension/retailer-content.js","webpack:///./src/extension/lib/shared/message.js","webpack:///./src/extension/lib/shared/get-mobile-os.js","webpack:///./src/extension/lib/config.common.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","r","value","n","__esModule","object","property","prototype","hasOwnProperty","p","s","Config","getBrowserName","getMobileOs","isArray","obj","toString","isSerp","url","patterns","length","match","isGiveasyouLive","test","dom","tagName","classNames","textContent","el","document","createElement","forEach","className","classList","add","contentScriptInitialise","contentScriptConstructor","condition","window","top","createError","type","err","Error","findParentWithClassName","currElement","element","contains","parentNode","arr","callback","getTimestamp","Date","now","getDayAndYear","getDay","getYear","getGaylUrl","path","gaylUrl","hasLeadingSlash","indexOf","getLastItem","hasProperties","props","prop","img","src","alt","insertAfter","newNode","referenceNode","insertBefore","nextSibling","isAndroidApp","isClickthrough","isGiveasyouLiveEmail","isMajorVersionUpdate","previousVersion","newVersion","previousVersionParts","split","newVersionParts","isString","isRetailerPage","isUndefined","input","undefined","logObject","out","key","markFavourites","stores","userFavourites","favouriteStoreIds","map","favourite","id","store","isFavourite","includes","removeChildren","node","hasChildNodes","firstChild","removeChild","text","createTextNode","toBoolean","str","truncateCauseName","cause","limit","len","truncatedName","substring","svgDom","createElementNS","whenDocumentReady","readyState","addEventListener","CommonConfig","assign","apiBase","apiBaseV2","env","gaylDomain","runtime","chrome","browser","svg","setAttribute","appendChild","SIDEBAR","SIDEBAR_TURNON","SIDEBAR_FAVOURITE","RETAILER","POPUP_LOADING_ACCOUNT_OPTIONS","POPUP_LOADING_CAUSE_INFO","POPUP_LOADING_FAVOURITES","POPUP_LOADING_GLOBAL","POPUP_LOADING_SIMILAR_STORES","POPUP_LOADING_POPULAR_STORES","POPUP_LOADING_STORE_SEARCH","POPUP_NO_FAVOURITES","POPUP_NO_SIMILAR_STORES","POPUP_NO_SEARCH_RESULTS","ERROR_TIMEOUT_POPUP","ERROR_ACCOUNT_OPTION_LOAD","STORE_CONFIRMATION_DIALOG_QUESTION","STORE_CONFIRMATION_DIALOG_EARN_NEW_CUSTOMERS","STORE_CONFIRMATION_DIALOG_EARN","STORE_CONFIRMATION_DIALOG_YES","STORE_THANK_YOU_OK","STORE_THANK_YOU_INTRO","STORE_THANK_YOU_BODY_NEW_CUSTOMERS","STORE_THANK_YOU_BODY","SERP_BUTTON_TEXT","SERP_LINK_TEXT","API_ERROR_MESSAGES","InvalidCredentials","REQUEST_ERROR_MESSAGES","0","GENERIC_ERROR_MESSAGE","userAgentStr","ua","navigator","userAgent","Messages","rightArrowIcon","data","causeName","wrapper","logo","getURL","head","body","message","maxStoreRate","parts","startText","endText","thankYouMessage","newCustomersOnly","okButton","question","questionMessage","earning","replace","storeName","confirm","close","Message","MessageSubject","confirmationTemplate","ExtensionSource","thankYouTemplate","CONFIRMATION_DIALOG_SELECTOR","INJECTED_SELECTOR","THANK_YOU_SELECTOR","removeNode","selector","querySelector","parent","[object Object]","this","autoInjectedThankYou","bindEvents","autoInjectConfirmation","location","href","autoInjectThankyou","injectConfirmationDialog","max","injectThankYou","onMessage","addListener","bind","ui","confirmButton","declineButton","onConfirmation","onDecline","onClickOk","sender","sendResponse","payload","subject","RETAILER_CONFIRMATION","RETAILER_THANKYOU","HIDE_CONFIRMATION","removeConfirmationDialog","REMOVE_ALL","removeAllDialogs","console","warn","e","hideThankYou","self","isInjected","template","bindConfirmationDialogEvents","isThankYouInjected","isConfirmationInjected","log","model","bindThankYouEventHandlers","delayMs","thankYouDialogVisibleMs","setTimeout","sendMessageToBackground","RETAILER_REJECT","RETAILER_CONFIRM","extensionSource","sendMessage","GET_SERP_RULES_RESPONSE","CHECK_SERP_URLS_RESPONSE","GET_SERP_RULES","CHECK_SERP_URLS","isValidSubject","BROWSER_AUTH_HEADERS","Chrome","Firefox","Edge","Safari","apiAuthHeader","browserName","authHeader","extensionId","safari","ignoredSchemes","ignoredUrls","permissionsUrl","processingDelayMs","requestTimeoutMs","sentryDsn","uninstallUrl","version","getManifest"],"mappings":"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","file":"retailerContent.bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 42);\n","/**\n * \tUtility functions for various parts of the extension.\n *\n * \t@author Daniel Moffat\n */\n\nvar Config = require('../config.development.js');\nvar getBrowserName = require('./get-browser-name.js');\nvar getMobileOs = require('./get-mobile-os.js');\n\n/**\n * @return true if the given object has all of the properties specified in the props array.\n */\nfunction hasProperties(object, props) {\n\tif(!props || !props.length) {\n\t\treturn true;\n\t}\n\tprops.forEach(function(prop) {\n\t\tif(!object.hasOwnProperty(prop)) {\n\t\t\treturn false;\n\t\t}\n\t});\n\treturn true;\n}\n\n/**\n * @return True if the given string equals \"true\"\n */\nfunction toBoolean(str) {\n\treturn str === 'true'\n}\n\n/**\n * @return True if the given input is undefined. (Declared, but not defined.)\n */\nfunction isUndefined(input) {\n\treturn input === undefined;\n}\n\n/**\n * @return True if the given 'obj' is an array.\n */\nfunction isArray(obj) {\n\treturn Object.prototype.toString.call(obj) === '[object Array]';\n}\n\n/**\n * @return True if the given 'obj' is a string.\n */\nfunction isString(obj) {\n\treturn Object.prototype.toString.call(obj) === '[object String]';\n}\n\n/**\n *\tHelper method for iterating NodeList objects (or other objects that pretend to be arrays).\n *\tIn Chrome NodeList.prototype.forEach exists, but not in other browsers.\n *\n * \tInvokes 'callback' for each item in 'arr'.\n *\n */\nfunction forEach(arr, callback) {\n\tfor (var i = 0; i < arr.length; i++) {\n\t\tcallback(arr[i]);\n\t}\n}\n\n/**\n *  @return The first parent node which has the given 'className', or null if no parent is found.\n */\nfunction findParentWithClassName(currElement, className) {\n\tvar element = currElement;\n\twhile(!element.classList.contains(className)) {\n\t\telement = element.parentNode;\n\t\tif(element === null) { // No parent node, can't go any further.\n\t\t\treturn null;\n\t\t}\n\t}\n\treturn element;\n}\n\n/**\n * \tGiven a list of stores, will set the 'isFavourite' property on each store if they are also in\n * \t'userFavourites' (which is also a list of stores.).\n */\nfunction markFavourites(stores, userFavourites) {\n\tvar stores = stores || [];\n\tvar userFavourites = userFavourites || [];\n\tvar favouriteStoreIds = userFavourites.map(function(favourite) { return favourite.id } );\n\tstores.forEach(function(store) {\n\t\tstore.isFavourite = favouriteStoreIds.includes(store.id);\n\t});\n\treturn stores;\n}\n\n/**\n *\tWill invoke 'callback' when the document is ready.\n *\n * \tThis might be invoked when the document is still in a 'loading' state, so we need to check the ready state\n *  and either bind the callback to the 'DOMContentLoaded' event or just execute it straight away.\n */\nfunction whenDocumentReady(callback) {\n\tif(document.readyState === 'loading') { // Document not loaded yet.\n\t\tdocument.addEventListener('DOMContentLoaded', function() {\n\t\t\tcallback();\n\t\t});\n\t\treturn;\n\t}\n\n\t// Document already interactive\n\tcallback();\n}\n\n/**\n * @return An error object, with the given type as the 'type' property.\n */\nfunction createError(type) {\n\tvar err = new Error();\n\terr.type = type;\n\treturn err;\n}\n\n/**\n * @return True if the given 'url' matches that of a SERP (e.g. Google, Bing, Yahoo etc.)\n */\nfunction isSerp(url) {\n\tif(!url) return false;\n\n\tvar patterns = [\n\t\t/^(http|https):\\/\\/www.google.(co.uk|com)/g,\n\t\t/^(http|https):\\/\\/www.bing.com\\/search/g,\n\t\t/^(http|https):\\/\\/uk.search.yahoo.com\\/search/g\n\t];\n\n\tfor (var i = 0; i < patterns.length; i++) {\n\t\tif(url.match(patterns[i])) {\n\t\t\treturn true;\n\t\t}\n\t}\n\n\treturn false;\n}\n\n/**\n * @return True if the given url is a clickthrough URL\n */\nfunction isClickthrough(url) {\n\tif(!url) return false;\n\treturn url.indexOf('statistics/gayl/clickthrough') > 0;\n}\n\n/**\n * @return True if the given url is the GAYL website.\n */\nfunction isGiveasyouLive(url) {\n\tvar re = /https?:\\/\\/(.*)giveasyoulive.(com|uk)/g;\n\treturn re.test(url);\n}\n\n/**\n * @return True if the given url is a GAYL email URL.\n */\nfunction isGiveasyouLiveEmail(url) {\n\tif(!url) return false;\n\treturn url.indexOf('giveasyoulive-emails.com') > 0;\n}\n\n/**\n * @return True if the given URL is a retailer page, which is assumed\n * if !isGiveasyouLive and !isSerp, we don't have a more reliable (and quick)\n * method to test if a URL is a retailers.\n */\nfunction isRetailerPage(url) {\n\treturn !isGiveasyouLive(url) && !isSerp(url);\n}\n\n/**\n *\tIntialises a content script.\n *\n *  If the browser is Safari, the content script will only be initialised if condition is true.\n *  For all other browsers, the content script will be intialised straight away.\n *\n *  'condition' is needed because Safari doesn't support the whitelist/blocklist in their manifest file yet.\n */\nfunction contentScriptInitialise(contentScriptConstructor, condition) {\n\tif(window.top === window) {\n\t\tif(getBrowserName() === \"Safari\") {\n\t\t\tif(condition) {\n\t\t\t\tnew contentScriptConstructor();\n\t\t\t}\n\t\t} else {\n\t\t\tnew contentScriptConstructor();\n\t\t}\n\t}\n}\n\n/**\n * Helper function for creating DOM nodes in a non-verbose way.\n * @param  tagName, the name of the tag to create\n * @param  classNames, a single class name, or an array of class names to add to the node\n * @param  textContent The text content of the node.\n *\n * e.g.\n * dom('div', ['foo', 'bar'], 'Hello world!')\n * => <div class=\"foo bar\">Hello world!</div>\n */\nfunction dom(tagName, classNames, textContent) {\n\tvar el = document.createElement(tagName);\n\tif(isArray(classNames)) {\n\t\tclassNames.forEach(function(className) {\n\t\t\tif(className) {\n\t\t\t\tel.classList.add(className);\n\t\t\t}\n\t\t});\n\t} else {\n\t\tif(classNames) {\n\t\t\tel.classList.add(classNames);\n\t\t}\n\t}\n\n\tif(textContent) {\n\t\tel.textContent = textContent;\n\t}\n\n\treturn el;\n}\n\n/**\n * Helper function for creating <svg> elements (and their children, e.g. <path>, <circle>...).\n * You cannot just use dom for this. The resulting elements don't get rendered by the browser.\n */\nfunction svgDom(tagName, classNames) {\n\tvar el = document.createElementNS('http://www.w3.org/2000/svg', tagName);\n\tif(!classNames) return el;\n\n\tif(isArray(classNames)) {\n\t\tclassNames.forEach(function(className) {\n\t\t\tif(className) {\n\t\t\t\tel.classList.add(className);\n\t\t\t}\n\t\t})\n\t} else {\n\t\tel.classList.add(className);\n\t}\n\treturn el;\n}\n\n/**\n * Helper function for creating <img> elements\n * @param  src The image source\n * @param  alt The alt text\n */\nfunction img(src, alt, classNames) {\n\tvar i = dom('img', classNames);\n\ti.src = src;\n\ti.alt = alt;\n\treturn i;\n}\n\nfunction removeChildren(node) {\n\t// Make sure we have a valid node reference and it has children\n\tif(!node || !node.hasChildNodes()) {\n\t\treturn;\n\t}\n\n\twhile(node.firstChild) {\n\t\tnode.removeChild(node.firstChild);\n\t}\n}\n\n/**\n * Helper function for creating text nodes.\n */\nfunction text(text) {\n\treturn document.createTextNode(text);\n}\n\n/**\n * @return True if the new version is a major version upgrade from the previous version. A major\n * version upgrade is when any of the first two version numbers are greater than the previous version\n *\n * e.g:\n * isMajorVersionUpdate(\"6.0.0.0\", \"7.0.0.0\")\n * => true\n *\n * isMajorVersionUpdate(\"6.0.0.0\", \"6.1.0.0\")\n * => true\n *\n * isMajorVersionUpdate(\"6.0.0.0\", \"6.0.1.0\")\n * => false\n */\nfunction isMajorVersionUpdate(previousVersion, newVersion) {\n\tif(!newVersion) { return false; }\n\tif(!previousVersion && newVersion) { return true; }\n\tvar previousVersionParts = previousVersion.split(\".\");\n\tvar newVersionParts = newVersion.split(\".\");\n\n\tfor(var i = 0; i < previousVersionParts.length; i++) {\n\t\tif(newVersionParts[i] > previousVersionParts[i]) {\n\t\t\treturn true;\n\t\t}\n\n\t\t// Only check the first two numbers, the last two are minor versions\n\t\tif(i === 1) {\n\t\t\treturn false;\n\t\t}\n\t}\n}\n\n/**\n * @return UNIX timestamp for the current date.\n */\nfunction getTimestamp() {\n\treturn Date.now();\n}\n\n/**\n * @return The current day and year joined with a '-', e.g. For 1st Jan 2018, you'd get '1-2018'\n */\nfunction getDayAndYear() {\n\tvar d = new Date();\n\n\treturn (d.getDay() + 1) + '-' + (d.getYear() + 1900);\n}\n\n/**\n * Given an object, will return its string representation. Doesn't work very well if the value is an object / array.\n * e.g. logObject({foo: 'bar', baz: 'boo'})\n * => 'foo:bar,baz:boo'\n */\nfunction logObject(obj) {\n\tif(!obj) return '';\n\tvar out = '';\n\n\tfor(var key in obj) {\n\t\tif(obj.hasOwnProperty(key)) {\n\t\t\tout += (key + ':' + obj[key] + ',')\n\t\t}\n\t}\n\n\treturn out;\n}\n\n/**\n * Given an array, will return last item\n * @return The last item, or null if the given array is not an actual array or doesn't\n * contain any items.\n */\nfunction getLastItem(arr) {\n\tif(!isArray(arr)) {\n\t\treturn null;\n\t}\n\n\tif(arr.length == 0) {\n\t\treturn null;\n\t}\n\n\treturn arr[arr.length - 1];\n}\n\n/**\n * @param path Path to the resource on the GAYL website. A leading slash will be added if not already present.\n * @return The absolute URL to the path\n * e.g.\tgetGaylUrl('/foo/bar')\n * => 'https://www.giveasyoulive.com/foo/bar' for prod\n * => 'https://www.giveasyoulive.uk/foo/bar' for test\n */\nfunction getGaylUrl(path) {\n\tif(!path) return Config.gaylUrl;\n\tvar hasLeadingSlash = path.indexOf('/') === 0;\n\n\treturn Config.gaylUrl + (hasLeadingSlash ? '' : '/') + path;\n}\n\n/**\n * Inserts the given newNode after the given referenceNode\n */\nfunction insertAfter(newNode, referenceNode) {\n    referenceNode.parentNode.insertBefore(newNode, referenceNode.nextSibling);\n}\n\n// Given a cause object, will add a \"truncatedName\" property\nfunction truncateCauseName(cause, limit) {\n\tvar len = cause.name.length;\n\tvar suffix = '...';\n\n\tif(len < limit) {\n\t\tcause.truncatedName = cause.name;\n\t} else {\n\t\tcause.truncatedName = cause.name.substring(0, limit - suffix.length) + suffix;\n\t}\n\n\treturn cause;\n}\n\nfunction isAndroidApp() {\n\treturn getBrowserName() === 'Firefox' && getMobileOs() === 'Android';\n}\n\nmodule.exports = {\n\tcontentScriptInitialise,\n\tcreateError,\n\tdom,\n\tfindParentWithClassName,\n\tforEach,\n\tgetTimestamp,\n\tgetDayAndYear,\n\tgetGaylUrl,\n\tgetLastItem,\n\thasProperties,\n\timg,\n\tinsertAfter,\n\tisAndroidApp,\n\tisArray,\n\tisClickthrough,\n\tisGiveasyouLive,\n\tisGiveasyouLiveEmail,\n\tisMajorVersionUpdate,\n\tisSerp,\n\tisString,\n\tisRetailerPage,\n\tisUndefined,\n\tlogObject,\n\tmarkFavourites,\n\tremoveChildren,\n\ttext,\n\ttoBoolean,\n\ttruncateCauseName,\n\tsvgDom,\n\twhenDocumentReady\n};","/**\n * \tProduction configuration\n *\n * \t@author Daniel Moffat\n */\n\nconst CommonConfig = require('./config.common.js');\nconst GAYL_DOMAIN = \"giveasyoulive.com\";\n\nmodule.exports = Object.assign({ ...CommonConfig }, {\n\tapiBase: `https://www.${GAYL_DOMAIN}/api/v1/`,\n\tapiBaseV2: `https://www.${GAYL_DOMAIN}/api/v2/`,\n\tenv: 'production',\n\tgaylDomain: GAYL_DOMAIN,\n\tgaylUrl: `https://www.${GAYL_DOMAIN}`,\n});","/**\n *\tWebExtensions runtime API polyfill.\n *\n * \t@author Daniel Moffat\n */\nvar runtime;\n\n// Firefox / Chrome\nif('undefined' !== typeof chrome && chrome.runtime) {\n\truntime = chrome.runtime;\n}\n\n// Microsoft Edge\nif('undefined' !== typeof browser && browser.runtime) {\n\truntime = browser.runtime;\n}\n\nmodule.exports = runtime;","/**\n * Right arrow icon template.\n * @author Daniel Moffat\n */\n\nvar { svgDom } = require('../../shared/util.js');\n\nfunction rightArrowIcon() {\n\tvar svg = svgDom('svg', ['svg-inline--fa', 'fa-angle-right', 'fa-w-8', 'fa-fw']);\n\tsvg.setAttribute('role', 'img');\n\tsvg.setAttribute('aria-hidden', true);\n\tsvg.setAttribute('viewBox', '0 0 256 512');\n\n\tvar path = svgDom('path');\n\tpath.setAttribute('fill', 'currentColor');\n\tpath.setAttribute('d', 'M224.3 273l-136 136c-9.4 9.4-24.6 9.4-33.9 0l-22.6-22.6c-9.4-9.4-9.4-24.6 0-33.9l96.4-96.4-96.4-96.4c-9.4-9.4-9.4-24.6 0-33.9L54.3 103c9.4-9.4 24.6-9.4 33.9 0l136 136c9.5 9.4 9.5 24.6.1 34z');\n\n\tsvg.appendChild(path);\n\treturn svg;\n}\n\nmodule.exports = rightArrowIcon;","/**\n * These are used to specify where the click came from in the extension. It's used by the clickthrough to determine how the extension\n * was activated.\n * @author Daniel Moffat\n */\n\nmodule.exports = {\n\t// Clicked a store search result / popular store\n\tSIDEBAR: 'SIDEBAR',\n\t// Clicked the \"Turn on\" button\n\tSIDEBAR_TURNON: 'SIDEBAR_TURNON',\n\t// Clicked from the favourites tab.\n\tSIDEBAR_FAVOURITE: 'SIDEBAR_FAVOURITE',\n\t// Clicked from the retailer website\n\tRETAILER: 'RETAILER'\n};","/**\n * \tExtension messages.\n *\n * \tThese are generally added to the DOM using element.textContent = message, so you can't use\n * \tHTML in them - if you need to use HTML, code will need to written for the template the text is used in.\n *\n * \tSome of them also have placeholders available, e.g. $$causeName$$\n *\n *  @author Daniel Moffat\n */\n\nmodule.exports = {\n\t/**\n\t * General popup messages\n\t */\n\tPOPUP_LOADING_ACCOUNT_OPTIONS: 'Loading account...',\n\tPOPUP_LOADING_CAUSE_INFO: 'Loading cause...',\n\tPOPUP_LOADING_FAVOURITES: 'Loading favourites...',\n\tPOPUP_LOADING_GLOBAL: 'Loading...please wait.',\n\tPOPUP_LOADING_SIMILAR_STORES: 'Loading similar stores...',\n\tPOPUP_LOADING_POPULAR_STORES: 'Loading popular stores...',\n\tPOPUP_LOADING_STORE_SEARCH: 'Searching...',\n\tPOPUP_NO_FAVOURITES: 'No favourite stores yet. Why not try adding some?',\n\tPOPUP_NO_SIMILAR_STORES: 'No similar stores were found for this retailer.',\n\t// $$query$$ will be replaced with the users search query and wrapped in a <strong> tag.\n\tPOPUP_NO_SEARCH_RESULTS: 'No results found for $$query$$.',\n\n\t/**\n\t * Popup error messages\n\t */\n\n\tERROR_TIMEOUT_POPUP: 'An error occured, please close, and re-open this popup. If the problem persists, please let us know @ help@everyclick.com',\n\tERROR_ACCOUNT_OPTION_LOAD: 'Failed to load, please re-open to try again.',\n\n\t/**\n\t * Retailer page (aka retailer content script) messages\n\t */\n\t// $$causeName$$ will be replaced with the users current cause name\n\tSTORE_CONFIRMATION_DIALOG_QUESTION: 'Would you like your purchase to raise a donation for $$causeName$$?',\n\tSTORE_CONFIRMATION_DIALOG_EARN_NEW_CUSTOMERS: 'Earn up to $$maxStoreRate$$ with $$storeName$$ if you\\'re a new customer',\n\tSTORE_CONFIRMATION_DIALOG_EARN: 'Earn up to $$maxStoreRate$$ with $$storeName$$',\n\tSTORE_CONFIRMATION_DIALOG_YES: 'Raise a donation',\n\tSTORE_THANK_YOU_OK: 'OK, got it',\n\tSTORE_THANK_YOU_INTRO: 'Thank you.',\n\n\t// Thank you message for retailers which only pay commission for new customers only\n\tSTORE_THANK_YOU_BODY_NEW_CUSTOMERS: 'If you\\'re a new customer, purchases can raise up to $$maxStoreRate$$ of your total purchase for $$causeName$$.',\n\n\t// Thank you message for the other retailers\n\tSTORE_THANK_YOU_BODY: 'Purchases can raise up to $$maxStoreRate$$ of your total purchase for $$causeName$$.',\n\n\t/**\n\t * SERP messages\n\t */\n\tSERP_BUTTON_TEXT: 'Shop & raise up to $$maxStoreRate$$ >',\n\tSERP_LINK_TEXT: 'Donates up to $$maxStoreRate$$',\n\n\t/**\n\t * Custom API error messages\n\t */\n\tAPI_ERROR_MESSAGES: {\n\t\t'InvalidCredentials': 'Invalid email or password.'\n\t},\n\n\t/**\n\t * XmlHttpRequest status code error messages.\n\t */\n\n\tREQUEST_ERROR_MESSAGES: {\n\t\t// This happens when:\n\t\t// - User has dodgy / slow internet connection\n\t\t// - Our API took way too long to respond\n\t\t0: 'The request timed out, please try again.'\n\n\t},\n\n\t/**\n\t * Everything else\n\t */\n\n\t// Generic error message that's used when a more appropriate message isn't available. This should only ever be seen\n\t// for errors which haven't been catered for / expected - which explains why it's so unhelpful.\n\tGENERIC_ERROR_MESSAGE: 'An error occurred.'\n};","/**\n * \tDetects which browser the extension is currently running in.\n *\n * \tCode is pretty much directly lifted from the 'bowser' lib: https://github.com/lancedikson/bowser/blob/master/src/bowser.js\n *\n * \t@author Daniel Moffat\n */\n\nfunction getBrowserName(userAgentStr) {\n\tvar ua = userAgentStr || navigator.userAgent;\n\n\tif(/edg([ea]|ios)/i.test(ua)) {\n\t\treturn 'Edge';\n\t} else if(/chrome|crios|crmo/i.test(ua)) {\n\t\treturn 'Chrome';\n\t} else if(/safari|applewebkit/i.test(ua)) {\n\t\treturn 'Safari';\n\t} else if(/firefox|iceweasel|fxios/i.test(ua)) {\n\t\treturn 'Firefox';\n\t} else {\n\t\t// No match\n\t\treturn null;\n\t}\n}\n\nmodule.exports = getBrowserName;","/**\n * \tTemplate for the Donation Reminder thank you message on the retailer page. It thanks them for activating.\n *\n *  Model:\n *  {\n\t\tcauseName: <name of users current cause>,\n\t\tmaxStoreRate: <maximum rate the current store gives>,\n\t\tnewCustomersOnly: <whether this retailer only pays commission for new customers>\n \t}\n \tIf a user is logged out, causeName will be undefined.\n *\n * \t@author Daniel Moffat\n */\n\nvar { dom, text } = require('../../shared/util.js');\nvar Messages = require('../../shared/messages.js');\nvar rightArrowIcon = require('../icons/right-arrow.js');\nvar runtime = require('../../web-ext/runtime.js');\n\n// Replaces placeholders inside 'message' with the data in the next 2 arguments and wraps them in <strong> tags.\nfunction thankYouMessage(message, causeName, maxStoreRate) {\n\t// If more placeholders are added, we could write a method to replace arbitrary placeholders in strings (and wrap them in tags)...this is\n\t// a bit gross.\n\tvar wrapper = dom('p', ['thank-you-dialog__message', 'reset-this']);\n\n\tvar parts = message.split('$$maxStoreRate$$')\n\tvar startText = parts[0];\n\twrapper.appendChild(text(startText));\n\twrapper.appendChild(dom('strong', ['reset-this'], maxStoreRate));\n\n\tvar endText = parts[1]; // This contains the second placeholder\n\tparts = endText.split('$$causeName$$');\n\tstartText = parts[0];\n\tendText = parts[1];\n\twrapper.appendChild(text(startText));\n\twrapper.appendChild(dom('strong', ['reset-this'], causeName));\n\n\tif(endText) {\n\t\twrapper.appendChild(text(endText));\n\t}\n\treturn wrapper;\n}\n\nfunction thankYou(data) {\n\tvar causeName = data.causeName || 'your charity';\n\tvar wrapper = dom('div', ['thank-you-dialog', 'reset-this']);\n\twrapper.setAttribute('id', 'gayl-donation-reminder-root');\n\n\t// Top part\n\tvar logo = dom('img', ['thank-you-dialog__logo', 'reset-this']);\n\tlogo.src = runtime.getURL('/images/online-lw.svg');\n\tvar head = dom('p', ['thank-you-dialog__message', 'reset-this']);\n\thead.appendChild(dom('strong', ['reset-this'], Messages.STORE_THANK_YOU_INTRO));\n\n\t// Body\n\tvar bodyMessage = data.newCustomersOnly ? Messages.STORE_THANK_YOU_BODY_NEW_CUSTOMERS : Messages.STORE_THANK_YOU_BODY;\n\tvar body = thankYouMessage(bodyMessage, causeName, data.maxStoreRate);\n\tvar okButton = dom('a', ['thank-you-dialog__action', 'btn', 'btn-default', 'btn-lg', 'js-thankyou-ok', 'reset-this'], Messages.STORE_THANK_YOU_OK);\n\tokButton.appendChild(text(' '));\n\tokButton.appendChild(rightArrowIcon());\n\n\twrapper.appendChild(logo);\n\twrapper.appendChild(head);\n\twrapper.appendChild(body);\n\twrapper.appendChild(okButton);\n\n\treturn wrapper;\n}\n\nmodule.exports = thankYou;","/**\n * \tTemplate for the Donation Reminder prompt on the retailer page (the thing that asks the user whether they want\n * \t to turn the bar off or not.)\n *\n *  Model:\n *  {\n\t\tcauseName: <name of users current cause>,\n\t\tstoreName: <name of the current store>,\n\t\tmaxStoreRate: <maximum rate the current store gives>,\n\t\tnewCustomersOnly: <whether this retailer only pays commission for new customers>\n \t}\n \tIf a user is logged out 'causeName' will be undefined.\n *\n * \t@author Daniel Moffat\n */\n\nvar { dom, text } = require('../../shared/util.js');\nvar Messages = require('../../shared/messages.js');\nvar rightArrowIcon = require('../icons/right-arrow.js');\nvar runtime = require('../../web-ext/runtime.js');\n\nfunction confirmationPrompt(data) {\n\tvar causeName = data.causeName || 'your charity';\n\tvar wrapper = dom('div', ['reset-this', 'confirmation-dialog']);\n\twrapper.setAttribute('id', 'gayl-donation-reminder-root');\n\n\t// Logo\n\tvar logo = dom('img', ['confirmation-dialog__logo', 'reset-this']);\n\tlogo.src = runtime.getURL('/images/online.svg');\n\n\t// Question\n\tvar question = questionMessage(Messages.STORE_CONFIRMATION_DIALOG_QUESTION, causeName);\n\n\t// Earning statement\n\tvar earning = dom('p', ['confirmation-dialog__earn', 'reset-this'])\n\tvar message = data.newCustomersOnly ? \n\t\tMessages.STORE_CONFIRMATION_DIALOG_EARN_NEW_CUSTOMERS : \n\t\tMessages.STORE_CONFIRMATION_DIALOG_EARN;\n\t// Replace the dynamic parts\n\tmessage = message\n\t\t.replace('$$storeName$$', data.storeName)\n\t\t.replace('$$maxStoreRate$$', data.maxStoreRate);\n\tearning.appendChild(text(message));\n\n\t// Confirm button\n\tvar confirm = dom('a', ['btn', 'btn-primary', 'btn-lg', 'js-retailer-confirm', 'reset-this'], Messages.STORE_CONFIRMATION_DIALOG_YES);\n\tconfirm.appendChild(text(' '));\n\tconfirm.appendChild(rightArrowIcon());\n\n\t// Close button\n\tvar close = dom('img', ['js-retailer-decline', 'confirmation-dialog__close', 'reset-this']);\n\tclose.src = runtime.getURL('/images/close-icon.svg');\n\n\t// Assemble\n\twrapper.appendChild(logo);\n\twrapper.appendChild(question);\n\twrapper.appendChild(earning);\n\twrapper.appendChild(confirm);\n\twrapper.appendChild(close);\n\n\treturn wrapper;\n}\n\n// Given a message, and a cause name, will return the message, with the causeName wrapped in a <strong> tag.\nfunction questionMessage(message, causeName) {\n\tvar wrapper = dom('p', ['confirmation-dialog__question', 'reset-this']);\n\tvar parts = message.split('$$causeName$$');\n\tvar startText = parts[0];\n\tvar endText = parts[1];\n\tif(startText) {\n\t\twrapper.appendChild(text(startText));\n\t}\n\twrapper.appendChild(dom('strong', ['reset-this'], causeName));\n\tif(endText) {\n\t\twrapper.appendChild(text(endText))\n\t}\n\n\treturn wrapper;\n}\n\nmodule.exports = confirmationPrompt;","/**\n * \tContent script for retailer pages.\n *\n * \tAll actions this script performs are based on messages receieved by the background script.\n *\n * \tIf the user is not logged in, none of the messages will ever be sent from the background script, meaning\n * \tyou can assume the user is logged in and all required data is available.\n *\n * \t@author Daniel Moffat.\n */\n\nvar styles = require('./styles/less/retailer.less');\n\nvar { contentScriptInitialise, isRetailerPage, whenDocumentReady } = require('./lib/shared/util.js');\nvar { Message, MessageSubject }  = require('./lib/shared/message.js');\nvar Config = require('./lib/config.development.js');\nvar confirmationTemplate = require('./lib/templates/retailer/confirmation-prompt.js');\nvar ExtensionSource = require('./lib/shared/extension-source.js');\nvar runtime = require('./lib/web-ext/runtime.js');\nvar thankYouTemplate = require('./lib/templates/retailer/thank-you.js');\n\nvar CONFIRMATION_DIALOG_SELECTOR = '#gayl-donation-reminder-root.confirmation-dialog';\nvar INJECTED_SELECTOR = '#gayl-donation-reminder-root';\nvar THANK_YOU_SELECTOR = '#gayl-donation-reminder-root.thank-you-dialog';\n\nclass RetailerContentScript {\n\tconstructor() {\n\t\tthis.autoInjectedThankYou = false;\n\t\tthis.bindEvents();\n\n\t\t// Support injecting dialogs via URL parameter - useful for development as you don't need to click \"Yes\" to see\n\t\t// the \"Thank you\" message\n\t\tvar autoInjectConfirmation = window.location.href.indexOf('inject=confirmation') > -1;\n\t\tvar autoInjectThankyou = window.location.href.indexOf('inject=thankyou') > -1;\n\n\t\tif(autoInjectConfirmation) {\n\t\t\tthis.injectConfirmationDialog(\n\t\t\t\t{name: 'Totally not Starlight'},\n\t\t\t\t{ max: '£10.00', name: 'Amazon', newCustomersOnly: true}\n\t\t\t);\n\t\t}\n\n\t\tif(autoInjectThankyou) {\n\t\t\tthis.autoInjectedThankYou = true;\n\t\t\tthis.injectThankYou({name: 'Totally not Starlight'}, {max: '100%', newCustomersOnly: true});\n\t\t}\n\t}\n\n\t// Bind events handlers for non-document events\n\tbindEvents() {\n\t\truntime.onMessage.addListener(this.onMessage.bind(this));\n\t}\n\n\t// Bind event handlers for the confirmation dialog\n\tbindConfirmationDialogEvents() {\n\t\tthis.ui = {\n\t\t\tconfirmButton: document.querySelector('.js-retailer-confirm'),\n\t\t\tdeclineButton: document.querySelector('.js-retailer-decline'),\n\t\t};\n\n\t\tthis.ui.confirmButton.addEventListener('click', this.onConfirmation.bind(this));\n\t\tthis.ui.declineButton.addEventListener('click', this.onDecline.bind(this));\n\t}\n\n\t// Bind event handlers for the thank you message\n\tbindThankYouEventHandlers() {\n\t\tthis.ui = {\n\t\t\tokButton: document.querySelector('.js-thankyou-ok')\n\t\t};\n\n\t\tthis.ui.okButton.addEventListener('click', this.onClickOk.bind(this));\n\t}\n\n\t// Fired when a message is received from the background script.\n\tonMessage(message, sender, sendResponse) {\n\t\tvar { payload, subject } = message;\n\t\tswitch(subject) {\n\t\t\tcase MessageSubject.RETAILER_CONFIRMATION:\n\t\t\t\tthis.injectConfirmationDialog(payload.cause, payload.store);\n\t\t\t\tbreak;\n\t\t\tcase MessageSubject.RETAILER_THANKYOU:\n\t\t\t\tthis.injectThankYou(payload.cause, payload.store);\n\t\t\t\tbreak;\n\t\t\tcase MessageSubject.HIDE_CONFIRMATION:\n\t\t\t\tthis.removeConfirmationDialog();\n\t\t\t\tbreak;\n\t\t\tcase MessageSubject.REMOVE_ALL:\n\t\t\t\tthis.removeAllDialogs();\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tconsole.warn('Unable to handle event - ' + subject);\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tonClickOk(e) {\n\t\tthis.hideThankYou();\n\t}\n\n\t// Remove all injected dialogs on the page\n\tremoveAllDialogs() {\n\t\tremoveNode(INJECTED_SELECTOR);\n\t}\n\n\t// Injects our UI into the retailer's website.\n\t// @param cause The cause object for the current user. If the user is logged out, cause will be NULL.\n\t// @param store The store object for the current store\n\tinjectConfirmationDialog(cause, store) {\n\t\tvar self = this;\n\t\twhenDocumentReady(function() {\n\t\t\tif(self.isInjected()) { // Prevent duplicate injections.\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar template = confirmationTemplate({\n\t\t\t\tcauseName: (cause && cause.name) || null, // todo: might need to truncate this a little bit, or use some CSS magic,\n\t\t\t\tstoreName: store.name,\n\t\t\t\tmaxStoreRate: store.max,\n\t\t\t\tnewCustomersOnly: store.newCustomersOnly\n\t\t\t});\n\t\t\tdocument.body.insertBefore(template, document.body.firstChild);\n\t\t\tself.bindConfirmationDialogEvents();\n\t\t});\n\t}\n\n\t/**\n\t * @param cause The cause object for the currently logged-in user.\n\t * @param store The store object for the currently tracked store.\n\t */\n\tinjectThankYou(cause, store) {\n\t\tvar self = this;\n\t\twhenDocumentReady(() => {\n\t\t\tif(self.isThankYouInjected()) { // Prevent duplicate injections of the same dialog.\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// There exists a point where we activate non-active tabs, in this situation there may be a confirmation dialog visible, so we need to remove it.\n\t\t\tif(self.isConfirmationInjected()) {\n\t\t\t\tconsole.log('Found an existing confirmation dialog, removing all dialogs.');\n\t\t\t\tself.removeAllDialogs();\n\t\t\t}\n\n\t\t\tvar model = {\n\t\t\t\tcauseName: (cause && cause.name) || null,\n\t\t\t\tmaxStoreRate: store.max,\n\t\t\t\tnewCustomersOnly: store.newCustomersOnly\n\t\t\t};\n\t\t\tvar template = thankYouTemplate(model);\n\t\t\tdocument.body.insertBefore(template, document.body.firstChild);\n\t\t\tself.bindThankYouEventHandlers();\n\n\t\t\t// Hide the message after a delay\n\t\t\tlet delayMs = this.autoInjectedThankYou ? 60000 : Config.thankYouDialogVisibleMs;\n\t\t\tsetTimeout(function() {\n\t\t\t\tself.hideThankYou();\n\t\t\t}, delayMs);\n\t\t});\n\t}\n\n\thideThankYou() {\n\t\tdocument.querySelector(THANK_YOU_SELECTOR).classList.add('is-hidden');\n\t}\n\n\tremoveConfirmationDialog() {\n\t\tremoveNode(CONFIRMATION_DIALOG_SELECTOR);\n\t}\n\n\t// User doesn't want to activate the donation reminder\n\tonDecline() {\n\t\tthis.sendMessageToBackground(new Message(MessageSubject.RETAILER_REJECT))\n\t}\n\n\t// User confirmed they want to activate the donation reminder\n\tonConfirmation() {\n\t\tthis.sendMessageToBackground(new Message(MessageSubject.RETAILER_CONFIRM, {\n\t\t\textensionSource: ExtensionSource.RETAILER\n\t\t}));\n\t}\n\n\tsendMessageToBackground(message) {\n\t\truntime.sendMessage(message);\n\t}\n\n\t/**\n\t * \tHelpers to determine which things we've already injected into the page.\n\t */\n\n\t// Have ANY of the dialogs been injected?\n\tisInjected() {\n\t\treturn document.querySelector(INJECTED_SELECTOR) !== null;\n\t}\n\n\t// Has this specific dialog been injected?\n\tisThankYouInjected() {\n\t\treturn document.querySelector(THANK_YOU_SELECTOR) !== null;\n\t}\n\n\t// Has this specific dialog been injected?\n\tisConfirmationInjected() {\n\t\treturn document.querySelector(CONFIRMATION_DIALOG_SELECTOR) !== null;\n\t}\n}\n\n/**\n * Given a selector, will remove the first match of that selector from the DOM.\n */\nfunction removeNode(selector) {\n\tvar el = document.querySelector(selector);\n\tif(el === null) return;\n\tvar parent = el.parentNode;\n\n\tif(parent !== null) {\n\t\tparent.removeChild(el);\n\t}\n}\n\ncontentScriptInitialise(RetailerContentScript, isRetailerPage(window.location.href));","/**\n * \tModel for messages that are sent between extension components (i.e. background page, content scripts, etc).\n *\n * \t@author Daniel Moffat\n */\n\n/**\n * Defines the various message subjects and what they mean.\n */\nvar MessageSubject = {\n\t/**\n\t * Background page => Content script\n\t */\n\n\t// Inject the confirmation UI into the retailer page\n\tRETAILER_CONFIRMATION: 'RETAILER_CONFIRMATION',\n\n\t// Inject the thank you UI into the retailer page\n\tRETAILER_THANKYOU: 'RETAILER_THANKYOU',\n\n\t// Hide the confirmation UI\n\tHIDE_CONFIRMATION: 'HIDE_CONFIRMATION',\n\n\t// Remove all injected dialogs from the page\n\tREMOVE_ALL: 'REMOVE_ALL',\n\n\t// Contains the SERP rules\n\tGET_SERP_RULES_RESPONSE: 'GET_SERP_RULES_RESPONSE',\n\n\t// Contains the extracted SERP URLs and whether they are supported on our site or not.\n\tCHECK_SERP_URLS_RESPONSE: 'CHECK_SERP_URLS_RESPONSE',\n\n\t/**\n\t *\tContent script => Background page\n\t */\n\n\t// User wants to activate this retailer\n\tRETAILER_CONFIRM: 'RETAILER_CONFIRM',\n\n\t// User doesn't want to activate this retailer\n\tRETAILER_REJECT: 'RETAILER_REJECT',\n\n\t// Request SERP rules\n\tGET_SERP_RULES: 'GET_SERP_RULES',\n\n\t// Check extracted SERP URLs\n\tCHECK_SERP_URLS: 'CHECK_SERP_URLS'\n};\n\nfunction Message(subject, payload) {\n\tvar payload = payload || {};\n\t// Only allows certain messages that we're certain can be handled.\n\tif(this.isValidSubject(subject)) {\n\t\t// Tells the other end what this message is for.\n\t\tthis.subject = subject;\n\t}\n\n\t// Some data sent with this message\n\tthis.payload = payload;\n}\n\nMessage.prototype.isValidSubject = function(subject) {\n\tif(!MessageSubject[subject]) {\n\t\tthrow new Error(\"Unknown message subject: \" + subject);\n\t}\n\treturn true;\n}\n\nmodule.exports = {\n\tMessage,\n\tMessageSubject\n};","/**\n * \tDetects which mobile operating system is used\n *\n * \t@author Gareth Evans\n */\n\nfunction getMobileOS(userAgentStr) {\n\tvar ua = userAgentStr || navigator.userAgent;\n\n    if(/windows phone/i.test(ua)) {\n\t\treturn 'Windows';\n\t} else if(/android/i.test(ua)) {\n\t\treturn 'Android';\n\t} else if(/iPad|iPhone|iPod/i.test(ua)) {\n\t\treturn 'iOS';\n\t} else {\n\t\t// No match\n\t\treturn null;\n\t}\n}\n\nmodule.exports = getMobileOS;","/**\n * \tCommon extension configuration, shared between both production / development builds.\n *\n * \t@author Daniel Moffat.\n */\n\nvar getBrowserName = require('./shared/get-browser-name.js');\nvar runtime = require('./web-ext/runtime.js');\n\n // Map of browser name => auth header\n var BROWSER_AUTH_HEADERS = {\n \t'Chrome': 'R0FZTF9CUk9XU0VSX0VYVF9DSFJPTUU6MnZMTG4qSkpyX3ZEOT1hKg==',\n \t'Firefox': 'R0FZTF9CUk9XU0VSX0VYVF9GSVJFRk9YOnRBM3lOWEJQWmR1YyVHTG0=',\n \t'Edge': 'R0FZTF9CUk9XU0VSX0VYVF9FREdFOmZ2Qmg4VHdMUDRHelNTQFI=',\n \t'Safari': 'R0FZTF9CUk9XU0VSX0VYVF9TQUZBUkk6LTZyRHZBJGREeHFHOW45Pw==',\n };\n\nmodule.exports = {\n\t// Auth header used for API calls\n\tapiAuthHeader: function() {\n\t\tvar browserName = getBrowserName();\n\t\tvar authHeader = BROWSER_AUTH_HEADERS[browserName];\n\t\tif(!authHeader) {\n\t\t\tthrow new Error('Cannot find auth header for ' + browserName);\n\t\t}\n\t\treturn 'Basic ' + authHeader;\n\t},\n\textensionId: function(){\n\t\t// Edge actually has this property on their window object, so we need\n\t\t// to check if 'runtime' property exists to see if it's actually Chrome...\n\t\tif(typeof chrome !== 'undefined' && chrome.runtime) {\n\t\t\treturn chrome.runtime.id;\n\t\t}\n\n\t\t// Safari doesn't have it's own extension ID, so we have to create a fake one.\n\t\tif(typeof safari !== 'undefined') {\n\t\t\treturn 'synthetic';\n\t\t}\n\n\t\treturn browser.runtime.id\n\t},\n\n\t// Schemes that shouldn't be processed by the extension\n\tignoredSchemes: [\n\t\t'about',\n\t\t'chrome',\n\t\t'chrome-extension',\n\t\t'file',\n\t\t'view-source',\n\t\t'wyciwyg',\n\t\t'favorites'\n\t],\n\n\t// URLs that shouldn't be processed by the extension\n\tignoredUrls: '(?:shareasale.com|paypal.(?:co.uk|com)|successfultogether.co.uk|tradedoubler.com|clkuk.pvnsolutions.com|paidonresults.net|linksynergy.com|doubleclick.net|affiliatefuture.com|omguk.com|healthtrader.com|digitalriver.com|veinteractive.com|track.webgains.com|jdoqocy.com)',\n\n\t// Where the instructions live for changing your browser extension permissions.\n\tpermissionsUrl: 'https://help.giveasyoulive.com/hc/en-us/articles/360017448352-New-Chrome-update-Donation-Reminder',\n\n\t// How long to wait (ms) before processing the navigation committed event.\n\tprocessingDelayMs: 1000,\n\n\t// How long to wait (ms) before cancelling pending HTTP requests\n\trequestTimeoutMs: 7000,\n\n\t// Sentry DSN (Data Source Name) - https://docs.sentry.io/quickstart/#configure-the-dsn\n\tsentryDsn: 'https://7a19d517524a4954bb10e4bc21e4a4a9@sentry.io/1270266',\n\n\t// How long to show the thank you dialog (ms) before hiding.\n\tthankYouDialogVisibleMs: 7000,\n\n\t// The webpage a user is sent to after uninstalling\n\tuninstallUrl: 'https://r1.dotmailer-surveys.com/7e21zb6c-623a1ufe',\n\n\t// Function that returns the currently installed version of the Donation Reminder.\n\tversion: function() {\n\t\treturn runtime.getManifest().version;\n\t}\n};"],"sourceRoot":""}